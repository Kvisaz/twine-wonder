var SOURCE = '<!DOCTYPE html>\n' +
    '    <html>\n' +
    '        <head>\n' +
    '            <meta name="viewport" content="width=device-width, initial-scale=1">\n' +
    '            <meta charset="utf-8">\n' +
    '            <title>{{STORY_NAME}}</title>\n' +
    '            <style></style>\n' +
    '        </head>\n' +
    '        <body>\n' +
    '            <tw-story tags></tw-story>\n' +
    '            {{STORY_DATA}}\n' +
    '            <script>' + "!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=5)}([function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.STORY_SELECTOR=\"tw-storydata\",t.PASSAGE_SELECTOR=\"tw-passagedata\",t.COMMON_CSS={displayNone:\"displayNone\",pointerOver:\"pointerOver\",visited:\"visited\",back:\"back\"},t.WONDER={contentId:\"wonder-content\",pageClass:\"page\",pageContentClass:\"page-content\",textClass:\"text\",choiceClass:\"choice\",linkClass:\"link\",linkAloneClass:\"link-alone\",newLineClass:\"newLine\",linkInlineClass:\"inline\",noSelectClass:\"noselect\",selectClass:\"select\",paramClass:\"params\",visitedClass:t.COMMON_CSS.visited,backClass:t.COMMON_CSS.back,invisibleClass:t.COMMON_CSS.displayNone,template:{text:\"<text/>\",choices:\"<choices/>\",choiceStart:\"<choice>\",choiceEnd:\"</choice>\",choiceText:\"<choice-text/>\",choiceId:\"<choice-id/>\"},passages:{config:\"wonder.config\",pageFormat:\"wonder.format.page\",choiceFormat:\"wonder.format.choice\",textFormat:\"wonder.format.text\"},markLang:{varStart:\"var\",commandSplitter:\":\"},inlineStart:\"=\"};t.REGEXP={exeScript:new RegExp(\"{{([\\\\s\\\\S]*?)}}\",\"g\"),twineLink:new RegExp(\"\\\\[\\\\[([\\\\s\\\\S]*?)\\\\]\\\\]\",\"g\")},t.PAGE_TEMPLATE='<div class=\"'+t.WONDER.noSelectClass+\" \"+t.WONDER.pageClass+'\"></div>',t.LINK_TEMPLATE='<span class=\"'+t.WONDER.linkClass+\"  \"+t.WONDER.linkAloneClass+'\" data-id=\"'+t.WONDER.template.choiceId+'\">'+t.WONDER.template.choiceText+\"</span>\",t.LINK_INLINE_TEMPLATE='<span class=\"'+t.WONDER.linkClass+'\" data-id=\"'+t.WONDER.template.choiceId+'\">'+t.WONDER.template.choiceText+\"</span>\",t.BACK_TEMPLATE='<div class=\"'+t.WONDER.backClass+'\">Назад</div>',t.PASSAGE_TEMPLATE='<div class=\"'+t.WONDER.pageContentClass+'\">\\n'+t.BACK_TEMPLATE+'\\n<div class=\"'+t.WONDER.paramClass+'\" ><div id=\"gold\"></div></div>\\n<div class=\"'+t.WONDER.textClass+'\"><text/></div>\\n</div>',t.DEFAULT_STYLE='\\n\\n    .noselect {\\n    -webkit-touch-callout: none; /* iOS Safari */\\n        -webkit-user-select: none; /* Safari */\\n        -khtml-user-select: none; /* Konqueror HTML */\\n        -moz-user-select: none; /* Old versions of Firefox */\\n            -ms-user-select: none; /* Internet Explorer/Edge */\\n                user-select: none; /* Non-prefixed version, currently\\n                                  supported by Chrome, Opera and Firefox */\\n    }\\n    \\n    .select {\\n        -webkit-touch-callout: default; /* iOS Safari */\\n        -webkit-user-select: text; /* Safari */\\n        -khtml-user-select: text; /* Konqueror HTML */\\n        -moz-user-select: text; /* Old versions of Firefox */\\n            -ms-user-select: text; /* Internet Explorer/Edge */\\n                user-select: text; /* Non-prefixed version, currently\\n                                  supported by Chrome, Opera and Firefox */\\n    }\\n    \\n    .page .displayNone, .displayNone {\\n        display: none; \\n    }\\n    \\n    .pointerOver {\\n        cursor: pointer;\\n    }\\n    \\n    ul, li {\\n        margin: 0;\\n        padding: 0;\\n        list-style: none;\\n    }\\n    \\n    body {\\n        margin: 0;\\n        padding: 0;\\n        background: #ceceb7;\\n        font-family: \"Verdana\", \"Roboto\", \"Open Sans\", sans-serif;\\n        \\n        display: flex;\\n        justify-content: center;\\n        align-items: center;\\n    }\\n    \\n    .'+t.WONDER.newLineClass+\" {\\n        display: block;\\n    }\\n    \\n   /* #goldMine1 {\\n        background: black;\\n    }\\n    \\n    #goldMine1 .text {\\n        background: beige;\\n        padding: 12px;\\n        margin-top: 400px;\\n    }\\n    \\n    #goldMine1 .page {\\n        font-family: monospace;\\n        background: url(img/image-castle-web.jpg) no-repeat;\\n        background-size: cover;\\n    }*/\\n    \\n    #\"+t.WONDER.contentId+\" {\\n        width: 800px;\\n        border-radius: 0 0 8px 8px;\\n        overflow: hidden;\\n    }\\n    \\n    .\"+t.WONDER.pageClass+\" {\\n          background: beige;          \\n     }\\n     \\n     .\"+t.WONDER.pageContentClass+\" {\\n          display: flex;\\n          flex-direction: column;\\n          padding: 12px;\\n     }\\n        \\n    .\"+t.WONDER.paramClass+\"{\\n        margin-bottom: 12px;\\n    }\\n        \\n        \\n    .\"+t.WONDER.textClass+\" {\\n        margin: 0;\\n        font-size: 18px;\\n        line-height: 26px;\\n    }\\n    \\n    .\"+t.WONDER.linkClass+\"{\\n        display: block;\\n        cursor: pointer;\\n        padding: 5px 35px;\\n        border-radius: 5px;\\n        background: #d5c695;\\n    }\\n        \\n    .\"+t.WONDER.linkClass+\":hover, .\"+t.WONDER.backClass+\":hover{\\n        color: #4b0d1e;\\n        background: #d5b562;       \\n    }\\n    \\n    .\"+t.WONDER.visitedClass+\":after {\\n        content: '  (прочитано)';\\n        font-size: smaller;\\n     }\\n     \\n     .\"+t.WONDER.visitedClass+\" {\\n        opacity: 0.65;\\n        font-size: smaller;\\n     }\\n    \\n    .\"+t.WONDER.backClass+\" {\\n        cursor: pointer;\\n        display: inline-block;\\n        margin-left: 0;\\n        margin-right: auto;\\n        margin-bottom: 4px;\\n        padding: 4px;\\n        border-radius: 5px;\\n        background: #eae2c5;\\n        color: #6c6c6c;\\n    }\\n    \\n     .\"+t.WONDER.backClass+\":before {\\n        content: '<';\\n     }\\n   \\n    \\n    .\"+t.WONDER.linkAloneClass+\"{\\n        margin-top: 0px;\\n    }\\n    \\n    .\"+t.WONDER.linkAloneClass+\":hover{\\n        margin-top: -2px;\\n        margin-bottom: 2px;\\n        box-shadow: 2px 2px 1px #414141;\\n    }\\n    \\n    @media screen and (max-width: 800px){\\n        .\"+t.WONDER.contentId+\" {\\n             width: 100%;\\n             margin: 0;\\n             border-radius: 0;\\n        }\\n    }\\n\"},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(8),r=n(3),o=function(){function e(){this.listeners={}}return e.prototype.getListeners=function(e){return this.listeners[e]},e.prototype.initListeners=function(e){return this.listeners[e]=[],this.listeners[e]},e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.addListener=function(t,n){(e.getInstance().getListeners(t)||e.getInstance().initListeners(t)).push(n)},e.prototype.sub=function(e,t){return(this.getListeners(e)||this.initListeners(e)).push(t),this},e.prototype.unsub=function(e,t){var n=this.getListeners(e);if(null!=n)return r.ArrayUtils.removeChild(n,t),this},e.emit=function(t,n){var r=e.getInstance().getListeners(t);r&&r.forEach((function(e){i.Task.order((function(){e(t,n)}))}))},e}();t.EventBus=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(){}return e.divWith=function(e){var t=document.createElement(\"div\");return t.innerHTML=e,t},e.elementFromTemplate=function(t){return e.divWith(t).firstChild},e.addChildBefore=function(e,t,n){var i,r=!0,o=e.children;if(null!=n&&0!=n.length){for(var a=0;a<o.length;a++)if((i=o[a]).id==n)return e.insertBefore(t,i),void(r=!1);r&&e.appendChild(t)}else e.appendChild(t)},e.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},e.addChildIfNot=function(e,t){t.parentNode!=e&&e.appendChild(t)},e.bringToTop=function(e){e.parentNode&&e.parentNode.appendChild(e)},e.matches=function(e,t){return r.call(e,t)},e.copyToClipboard=function(e){var t=document.createElement(\"textarea\");t.value=e,document.body.appendChild(t),t.select(),document.execCommand(\"copy\"),document.body.removeChild(t)},e.getBlobURL=function(e,t){var n=new Blob([e],{type:t});return URL.createObjectURL(n)},e.getHtmlBlobUrl=function(t){return e.getBlobURL(t,\"text/html\")},e.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.getTextMetrics=function(t,n){null==e.canvas&&(e.canvas=document.createElement(\"canvas\"));var i=e.canvas.getContext(\"2d\");return i.font=n,i.measureText(t)},e.getTextWidth=function(t,n){return e.getTextMetrics(t,n).width},e.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},e.closest=function(t,n){var i=t,r=0;do{if(null==i)return null;if(e.matches(i,n))return i;i=i.parentElement}while(r++<1e4)},e.prepend=function(e,t){e.insertBefore(t,e.firstChild)},e}();t.DomUtils=i;var r=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i,r=function(){function e(){}return e.getRandom=function(e,t){void 0===t&&(t=1);var n=new Array(t),i=e.length,r=new Array(i);if(t>i)throw new RangeError(\"getRandom: more elements taken than available\");for(;t--;){var o=Math.floor(Math.random()*i);n[t]=e[o in r?r[o]:o],r[o]=--i in r?r[i]:i}return n},e.pushUnique=function(e,t){return e.indexOf(t)<0&&e.push(t),e},e.removeChild=function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},e.remove=function(e,t){return t>-1?e.splice(t,1)[0]:null},e.removeLast=function(e,t){for(;t-- >0;)e.pop()},e.shuffleWithSeed=function(e,t){var n,i;void 0===t&&(t=17);var r,o=e.length;for(n=0;n<o;n++)i=e[r=(t*n+31)%o],e[r]=e[n],e[n]=i;return e},e.shuffle=function(t,n){switch(void 0===n&&(n=i.random),n){case i.same:return t;case i.chaos:return t.sort((function(e,t){return Math.random()-.5}));case i.random:return e.shuffleWithSeed(t,13)}},e.updateArray=function(e,t,n,i){var r,o;(void 0===i&&(i=!0),null!=e&&null!=t&&0!=t.length)&&e.forEach((function(e,i){r=i<t.length?t[i]:o,n(e,r),o=r}))},e}();t.ArrayUtils=r,function(e){e.random=\"random\",e.same=\"same\",e.chaos=\"chaos\"}(i=t.ArrayShuffleOrder||(t.ArrayShuffleOrder={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){};t.GameState=i;var r=function(){this.uiParams=[]};t.GameConfig=r;var o=function(e,t){this.name=e,this.label=t};t.VisibleParameter=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(6),r=n(7),o=n(13),a=n(0),s=i.parseTwineData(),c=new r.GameLogic,u=new o.GameView;u.injectStyle(a.DEFAULT_STYLE),u.injectStyle(s.style),c.loadStory(s)},function(e,t,n){\"use strict\";function i(e){for(var t,n,i,r,o={},a=0,s=e.attributes,c=s.length;a<c;a++)o[(t=s[a].name,n=void 0,i=void 0,r=void 0,n=t.split(\"-\"),i=n.map((function(e,t){return t?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e})),r=i.join(\"\"),r)]=s[a].value;return o}Object.defineProperty(t,\"__esModule\",{value:!0}),t.parseTwineData=function(){var e=document.body.querySelector(\"tw-storydata\"),t=i(e);t.style=document.querySelector(\"#twine-user-stylesheet\").innerHTML.trim(),t.script=document.querySelector(\"#twine-user-script\").innerHTML.trim();var n=Array.prototype.slice.call(e.querySelectorAll(\"tw-passagedata\"));return t.passageHash={},t.passages=n.map((function(e){var n,r,o=i(e);return t.passageHash[o.pid],t.passageHash[o.name]=o,t.startnode==o.pid&&(t.startPassageName=o.name),o.content=(n=e.innerHTML.trim(),(r=document.createElement(\"textarea\")).innerHTML=n,0===r.childNodes.length?\"\":r.childNodes[0].nodeValue),o})),t}},function(e,t,n){\"use strict\";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(1),o=n(9),a=n(0),s=n(4),c=n(10),u=n(11),l=n(12),p=function(){function e(){var e=this;this.gameConfig=new s.GameConfig,this.gameState={},this.history=new l.WonderHistory,this.runTime=new u.RunTime,window.w=this.runTime,window.Wonder=window.w,r.EventBus.getInstance().sub(\"onPassagePrepared\",(function(t,n){return e.onPassagePrepared(n)})).sub(\"onLinkClick\",(function(t,n){return e.onLinkClick(n)})).sub(\"onBackClick\",(function(t){return e.onBackClick()}))}return e.prototype.loadStory=function(e){this.story=e,this.exeScript(e.script),c.WonderStoryParser.parse(e,this.gameState,this.gameConfig),r.EventBus.emit(\"onStoryLoaded\",e),this.onLinkClick(this.story.startPassageName)},e.prototype.onPassagePrepared=function(e){this.showPassage(e),this.runTime.onLocation(e)},e.prototype.showPassage=function(e){r.EventBus.emit(\"showPassage\",e)},e.prototype.onLinkClick=function(e){this.history.add(e),r.EventBus.emit(\"preparePassage\",this.getViewPassage(e))},e.prototype.onBackClick=function(){this.history.pop();var e=this.history.getLast();r.EventBus.emit(\"preparePassage\",this.getViewPassage(e))},e.prototype.exeScript=function(e){var t=null;try{t=new Function(e).bind(this.gameState)()}catch(e){}return t},e.prototype.getViewPassage=function(e){var t=i({},this.story.passageHash[e]);return this.execScripts(t),new o.PageViewData(t,this.gameState,this.gameConfig,this.history,this.history)},e.prototype.execScripts=function(e){var t=this;e.content=e.content.replace(a.REGEXP.exeScript,(function(e,n){var i=n.trim(),r=i[0]==a.WONDER.inlineStart;r&&(i=\"return \"+i.substring(1));var o=t.exeScript(i);return r?o:\"\"}))},e}();t.GameLogic=p},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,0)};t.Task={order:i}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(e,t,n,i,r){this.passage=e,this.state=t,this.config=n,this.viewChecker=i,this.pageCanGoBack=r};t.PageViewData=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(4),r=n(0),o=function(){function e(){}return e.parse=function(e,t,n){!function(e,t,n){if(null==e)return;(o=e.content,o.split(\"\\n\")).forEach((function(e){0!=(e=e.trim()).length&&function(e,t,n){if(0==function(e,t){return 0==e.indexOf(t)}(e,r.WONDER.markLang.varStart))return;var o=e.split(r.WONDER.markLang.commandSplitter);var a=o[1].trim(),s=o[2]||\"0\",c=o[3];t[a]=parseFloat(s),c&&n.uiParams.push(new i.VisibleParameter(a,c))}(e,t,n)}));var o}(e.passageHash[r.WONDER.passages.config],t,n)},e}();t.WonderStoryParser=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(){this.audioPlayer=new r}return e.prototype.styleUrl=function(e){var t=document.createElement(\"link\");t.setAttribute(\"rel\",\"stylesheet\"),t.setAttribute(\"href\",e),document.head.appendChild(t)},e.prototype.music=function(e,t){void 0===t&&(t=1),this.audioPlayer.music(e,t)},e.prototype.musicFor=function(e,t,n){void 0===n&&(n=1),this.audioPlayer.musicFor(e,t,n)},e.prototype.sound=function(e,t){void 0===t&&(t=1),this.audioPlayer.sound(e,t)},e.prototype.musicStop=function(){this.audioPlayer.stop()},e.prototype.onLocation=function(e){this.audioPlayer.musicCheck(e.name)},e}();t.RunTime=i;var r=function(){function e(){this.musicHash={},this.audioElement=new Audio}return e.prototype.music=function(e,t){this.audioElement.loop=!0,this.play(e,t)},e.prototype.sound=function(e,t){this.audioElement.loop=!1,this.play(e,t)},e.prototype.musicFor=function(e,t,n){this.musicHash[e]={url:t,volume:n}},e.prototype.musicCheck=function(e){var t=this.musicHash[e];null!=t&&this.music(t.url,t.volume)},e.prototype.play=function(e,t){var n=e.trim();this.lastUrl=n,this.audioElement.src=this.lastUrl,this.audioElement.volume=t,(this.audioElement.paused||n!=this.lastUrl)&&this.audioElement.play().then((function(e){}))},e.prototype.stop=function(){this.audioElement.pause()},e}()},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(){this.clear()}return e.prototype.clear=function(){this.pages=[],this.pagesHash={}},e.prototype.add=function(e){this.pages.push(e),this.pagesHash[e]=!0},e.prototype.isViewed=function(e){return 1==this.pagesHash[e]},e.prototype.pop=function(){return this.pages.pop()},e.prototype.canGoBack=function(e){if(!(this.pages.length>0))return!1;var t=1==this.pages.length,n=this.pages[0]&&this.pages[0]==e;return!(t&&n)},e.prototype.getLast=function(){return this.pages[this.pages.length-1]},e}();t.WonderHistory=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(1),r=n(0),o=n(14),a=n(2),s=function(){function e(){var e=this;this.el=document.createElement(\"div\"),this.el.id=r.WONDER.contentId,document.body.appendChild(this.el),this.el.addEventListener(\"click\",this),this.pageView=new o.WonderPageView(this.el),i.EventBus.getInstance().sub(\"onStoryLoaded\",(function(t,n){return e.onStoryLoaded(n)})).sub(\"preparePassage\",(function(t,n){return e.preparePassage(n)})).sub(\"showPassage\",(function(t,n){return e.showPassage(n)}))}return e.prototype.handleEvent=function(e){this.checkLinkClick(e)||this.checkBackClick(e)},e.prototype.checkClick=function(e,t,n){var i=a.DomUtils.closest(e.target,t);return i&&n(i,e),null!=i},e.prototype.checkLinkClick=function(e){return this.checkClick(e,\".\"+r.WONDER.linkClass,(function(e,t){var n=e.dataset.id;i.EventBus.emit(\"onLinkClick\",n)}))},e.prototype.checkBackClick=function(e){return this.checkClick(e,\".\"+r.WONDER.backClass,(function(e,t){i.EventBus.emit(\"onBackClick\",null)}))},e.prototype.injectStyle=function(e){if(0!=e.length){var t=document.createElement(\"style\");t.innerHTML=e,document.getElementsByTagName(\"head\")[0].appendChild(t)}},e.prototype.onStoryLoaded=function(e){},e.prototype.preparePassage=function(e){var t=e.passage,n=this.pageView.addNextPage(t);this.setPageNameAsBodyId(e),this.markVisitedLinks(n,e.viewChecker),this.showBackLink(n,e.pageCanGoBack,t),this.injectParams(n,e.config.uiParams,e.state),i.EventBus.emit(\"onPassagePrepared\",t)},e.prototype.setPageNameAsBodyId=function(e){document.body.id=e.passage.name},e.prototype.showPassage=function(e){this.pageView.showNextPage()},e.prototype.injectParams=function(e,t,n){t.forEach((function(t){var i=t.name,r=n[t.name],o=e.querySelector(t.name);o&&(o.innerHTML=i+\":\"+r)}))},e.prototype.markVisitedLinks=function(e,t){for(var n,i,o=e.querySelectorAll(\".\"+r.WONDER.linkClass),a=0;a<o.length;a++)i=(n=o[a]).dataset.id,t.isViewed(i)&&n.classList.add(r.WONDER.visitedClass)},e.prototype.showBackLink=function(e,t,n){var i=e.querySelector(\".\"+r.WONDER.backClass);null!=i&&(t.canGoBack(n.name)?i.classList.remove(r.WONDER.invisibleClass):i.classList.add(r.WONDER.invisibleClass))},e}();t.GameView=s},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(15),r=n(1),o=n(18),a=n(0),s=n(19),c=function(){function e(e){var t=this;this.parent=e,this.pageView=new i.PagePairView,this.pageBuilder=new o.ViewBuilder(a.PAGE_TEMPLATE),this.contentBuilder=new o.ViewBuilder(a.PASSAGE_TEMPLATE),this.contentBuilder.setContentFormatter(s.twinePassageFormatter),r.EventBus.getInstance().sub(\"onPageFormatLoaded\",(function(e,n){return t.pageBuilder.setTemplate(n)})).sub(\"onPassageFormatLoaded\",(function(e,n){return t.contentBuilder.setTemplate(n)}))}return e.prototype.addNextPage=function(e){var t=this.buildPageView(e);return this.pageView.addPage(t),t},e.prototype.showNextPage=function(){this.pageView.next()},e.prototype.buildPageView=function(e){var t=e.content,n=this.contentBuilder.build(t),i=this.pageBuilder.build();return i.classList.add(a.COMMON_CSS.displayNone),i.appendChild(n),this.parent.appendChild(i),i},e}();t.WonderPageView=c},function(e,t,n){\"use strict\";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,\"__esModule\",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.limit=2,t}return r(t,e),t.prototype.addPage=function(t){e.prototype.addPage.call(this,t),this.pages.length>this.limit&&(this.currentPage--,this.dropPage(0))},t}(n(16).PageView);t.PagePairView=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(17),r=n(3),o=n(2),a=function(){function e(){this.pages=[],this.currentPage=-1,this.animator=new i.PageAnimator}return e.prototype.setAnimator=function(e){this.animator=e},e.prototype.addPage=function(e){this.pages.push(e)},e.prototype.next=function(){var e=this.getCurrent();this.currentPage++,this.setCurrent(this.currentPage);var t=this.getCurrent();this.switch(e,t)},e.prototype.previous=function(){var e=this.getCurrent();this.currentPage--,this.setCurrent(this.currentPage);var t=this.getCurrent();this.switch(e,t)},e.prototype.switch=function(e,t){e&&this.animator.hide(e),this.animator.show(t)},e.prototype.getCurrent=function(){return this.pages[this.currentPage]},e.prototype.setCurrent=function(e){if(0==this.pages.length)throw\"setCurrent error - void pages\";var t=this.pages.length-1;e>t?e=0:e<0&&(e=t),this.currentPage=e},e.prototype.dropPage=function(e){var t=r.ArrayUtils.remove(this.pages,e);null!=t&&o.DomUtils.remove(t)},e}();t.PageView=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),r=function(){function e(){}return e.prototype.show=function(e,t){void 0===t&&(t=0),e.classList.remove(i.COMMON_CSS.displayNone)},e.prototype.hide=function(e,t){void 0===t&&(t=0),e.classList.add(i.COMMON_CSS.displayNone)},e}();t.PageAnimator=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(2),r=function(){function e(e){this.template=e,this.contentFormatter=function(e,t){return t}}return e.prototype.setTemplate=function(e){this.template=e},e.prototype.setContentFormatter=function(e){this.contentFormatter=e},e.prototype.build=function(e){void 0===e&&(e=\"\");var t=this.contentFormatter(e,this.template);return i.DomUtils.elementFromTemplate(t)},e}();t.ViewBuilder=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0);t.twinePassageFormatter=function(e,t){var n=i.WONDER.template,o=function(e,t,n){var i,r,o=[],a=0;for(;a<e.length;){if(-1===(i=e.indexOf(t,a)))return o;-1===(r=e.indexOf(n,i))&&(r=void 0),o.push(e.substring(i+t.length,r)),a=r+n.length}return o}(t,n.choiceStart,n.choiceEnd)[0];t=t.replace(o,n.choiceText).replace(n.choiceStart,\"\").replace(n.choiceEnd,\"\"),e=(e=e.replace(i.REGEXP.twineLink,(function(e,t){var n=(t=t.trim())[0]==i.WONDER.inlineStart;n&&(t=t.substring(1));var o=n?i.LINK_INLINE_TEMPLATE:i.LINK_TEMPLATE;return function(e,t){return t.replace(i.WONDER.template.choiceId,e.id).replace(i.WONDER.template.choiceText,e.text)}(function(e){var t=e.split(\"|\");t[0]=t[0].trim(),null==t[1]&&(t[1]=t[0]);return new r(t[0],t[1])}(t),o)})).trim()).replace(/(?:\\r\\n|\\r|\\n)/g,\"<br>\");var a=t;return a=a.replace(n.text,e.trim())};var r=function(e,t){this.text=e,this.id=t}}]);"+ '</script>' +
    '        </body>\n' +
    '    </html>';


window.storyFormat({
    name: 'twine-wonder',
    version: '0.6.12',
    author: 'Kvisaz [Sergey Tokarev]',
    description: 'Twine Wonder Format',
    proofing: false,
    url: 'https://github.com/Kvisaz/twine-wonder',
    image: 'icon.svg',
    source: SOURCE,
});
