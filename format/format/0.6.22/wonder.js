var SOURCE = '<!DOCTYPE html>\n' +
    '    <html>\n' +
    '        <head>\n' +
    '            <meta name="viewport" content="width=device-width, initial-scale=1">\n' +
    '            <meta charset="utf-8">\n' +
    '            <title>{{STORY_NAME}}</title>\n' +
    '            <style></style>\n' +
    '        </head>\n' +
    '        <body>\n' +
    '            <tw-story tags></tw-story>\n' +
    '            {{STORY_DATA}}\n' +
    '            <script>' + "/*! For license information please see index.js.LICENSE.txt */\n!function(n){var e={};function r(t){if(e[t])return e[t].exports;var a=e[t]={i:t,l:!1,exports:{}};return n[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=n,r.c=e,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(n,\"__esModule\",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&\"object\"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:n}),2&e&&\"string\"!=typeof n)for(var a in n)r.d(t,a,function(e){return n[e]}.bind(null,a));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,\"a\",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p=\"\",r(r.s=\"./wonder-format/start.ts\")}({\"../node_modules/kvisaz-dialog/src/kvisaz.js\":function(module,exports){eval(\"const libraryName = 'Kvisaz';\\r\\n\\r\\n// мгновенно исполняемая функция, которая наполняет передаваемый ей объект\\r\\n(function (moduleName) {\\r\\n    const module = {};\\r\\n    window[moduleName] = module;\\r\\n\\r\\n    module.moduleName = moduleName;\\r\\n    module.dialog = dialog;\\r\\n\\r\\n    /**************\\r\\n     *  CSS\\r\\n     **************/\\r\\n    const CSS = {\\r\\n        wrapperClass: 'kvisaz-dialog-wrapper',\\r\\n        shadowClass: 'kvisaz-shadow',\\r\\n        winId: 'kvisaz-dialog',\\r\\n        warningClass: 'kvisaz-dialog-warning',\\r\\n        winClass: 'kvisaz-dialog',\\r\\n        winClassShow: 'kvisaz-dialog-show',\\r\\n        winContentClass: 'kvisaz-dialog-content',\\r\\n        titleClass: 'kvisaz-dialog-title',\\r\\n        textClass: 'kvisaz-dialog-text',\\r\\n        buttonClass: 'kvisaz-dialog-button',\\r\\n        buttonWrapClass: 'kvisaz-button-wrap',\\r\\n        styleId: 'kvisaz-dialog-style'\\r\\n\\r\\n    }\\r\\n    //language=CSS\\r\\n    const CSSinnerHTML = `\\r\\n        .${CSS.wrapperClass} {\\r\\n            position: fixed;\\r\\n            width: 100%;\\r\\n            height: 100%;\\r\\n            top: 0;\\r\\n            left: 0;\\r\\n            display: flex;\\r\\n            align-items: center;\\r\\n            justify-content: center;\\r\\n        }\\r\\n\\r\\n        .${CSS.shadowClass} {\\r\\n            background: rgba(0,0,0,0.75);\\r\\n        }\\r\\n        \\r\\n        .${CSS.winId} {\\r\\n            user-select: none;\\r\\n            font-family: Roboto, Verdana, Arial, sans-serif;\\r\\n        }        \\r\\n        .${CSS.winClass} {\\r\\n            opacity: 1;\\r\\n            transition: all 0.2s ease-in;\\r\\n            width: 35%;\\r\\n            background: beige;\\r\\n            margin-top: 100%;\\r\\n        }        \\r\\n        \\r\\n        .${CSS.winClassShow} {  \\r\\n          margin: 0;    \\r\\n        }\\r\\n        \\r\\n        .${CSS.winContentClass} {}\\r\\n        \\r\\n        .${CSS.titleClass} {\\r\\n            background: bisque;\\r\\n            text-align: center;\\r\\n            padding: 1em;\\r\\n        }\\r\\n        .${CSS.textClass} {\\r\\n            text-align: center;\\r\\n            padding: 1em;\\r\\n        }\\r\\n        \\r\\n        .${CSS.buttonWrapClass} {\\r\\n            display: flex;\\r\\n            flex-wrap: wrap;\\r\\n            justify-content: center;\\r\\n            margin-bottom: 1em;\\r\\n        }\\r\\n        .${CSS.buttonClass} {\\r\\n            display: flex;\\r\\n            justify-items: center;\\r\\n            align-content: center;\\r\\n            align-items: center;\\r\\n            justify-content: center;\\r\\n            background: #dedede;\\r\\n            cursor: pointer;\\r\\n            padding: 1em;\\r\\n            margin: 1em;\\r\\n            width: 6em;\\r\\n            text-align: center;\\r\\n            height: 2em;\\r\\n            border: 2px outset #c4c0c0;\\r\\n            transform: scale(1);\\r\\n        }\\r\\n        \\r\\n        .${CSS.buttonClass}:active {\\r\\n            transform: translateY(0.15em);\\r\\n            border: 2px solid #c4c0c0;\\r\\n        }\\r\\n    `;\\r\\n\\r\\n    injectStyle(CSSinnerHTML);\\r\\n\\r\\n    /******\\r\\n     *  Главная функция модуля\\r\\n     * @param options\\r\\n     */\\r\\n    function dialog(options) {\\r\\n        const wrapper = createWrapper(options);\\r\\n        wrapper.classList.add(CSS.shadowClass);\\r\\n        // const shadow = createShadow(options);\\r\\n        const win = createWindow(options);\\r\\n        //  wrapper.appendChild(shadow);\\r\\n        wrapper.appendChild(win);\\r\\n\\r\\n        wrapper.addEventListener('click', onWrapperClick);\\r\\n        document.body.appendChild(wrapper);\\r\\n    }\\r\\n\\r\\n    /**************************************\\r\\n     *  utils\\r\\n     *************************************/\\r\\n    function div(className) {\\r\\n        const el = document.createElement('div');\\r\\n        if (className) el.className = className;\\r\\n        return el;\\r\\n    }\\r\\n\\r\\n    function divCode(content, className) {\\r\\n        return `<div class=\\\"${className}\\\">${content}</div>`\\r\\n    }\\r\\n\\r\\n    function injectStyle(styleText) {\\r\\n        const el = document.createElement('style');\\r\\n        el.innerHTML = styleText;\\r\\n        el.id = CSS.styleId;\\r\\n        document.head.appendChild(el);\\r\\n    }\\r\\n\\r\\n\\r\\n    /**************************************\\r\\n     *  wrapper is shadow (rgba) and click interceptor\\r\\n     *************************************/\\r\\n    function createWrapper(options) {\\r\\n        return div(CSS.wrapperClass);\\r\\n    }\\r\\n\\r\\n    function onWrapperClick(e) {\\r\\n        e.stopImmediatePropagation();\\r\\n        if (e.target.classList.contains(CSS.buttonClass)) {\\r\\n            onButtonClick(e.target);\\r\\n            return;\\r\\n        }\\r\\n    }\\r\\n\\r\\n    function removeWrapper(buttonEl) {\\r\\n        const el = buttonEl.closest(`.${CSS.wrapperClass}`);\\r\\n        if (el == null) {\\r\\n            console.warn('no wrapper window');\\r\\n            return;\\r\\n        }\\r\\n        el.removeEventListener('click', onWrapperClick);\\r\\n        if (el.parentNode != null) el.parentNode.removeChild(el);\\r\\n    }\\r\\n\\r\\n    /**************************************\\r\\n     *  window\\r\\n     *************************************/\\r\\n\\r\\n    function createWindow(options) {\\r\\n        const winEl = createWindowEl();\\r\\n        if (options.addClass != null) {\\r\\n            winEl.classList.add(options.addClass)\\r\\n        }\\r\\n\\r\\n        const titleCode = getTitleHtml(options);\\r\\n        const textCode = getTextHtml(options);\\r\\n        const buttonsCode = getButtonsHTML(options);\\r\\n\\r\\n        const content = titleCode + textCode + buttonsCode;\\r\\n        const winContent = `<div class=\\\"${CSS.winContentClass}\\\">${content}</div>`\\r\\n        winEl.innerHTML = winContent;\\r\\n\\r\\n        // winEl.addEventListener('click', onWindowClick)\\r\\n\\r\\n        module.options = options;\\r\\n\\r\\n        setTimeout(() => {\\r\\n            winEl.classList.add(CSS.winClassShow);\\r\\n        }, 0)\\r\\n\\r\\n        return winEl;\\r\\n\\r\\n    }\\r\\n\\r\\n    function onButtonClick(buttonEl) {\\r\\n        try {\\r\\n            const btIndex = buttonEl.dataset.index;\\r\\n            const warning = buttonEl.dataset.warning;\\r\\n            const callback = module.options.buttons[btIndex].callback;\\r\\n\\r\\n            if (warning != null) onWarningClick(buttonEl, warning, ()=>{\\r\\n                onSimpleClick(buttonEl, callback)\\r\\n            })\\r\\n            else onSimpleClick(buttonEl, callback);\\r\\n\\r\\n        } catch (e) {\\r\\n            console.warn(e)\\r\\n        }\\r\\n    }\\r\\n\\r\\n    function onSimpleClick(buttonEl, callback) {\\r\\n        setTimeout(() => {\\r\\n            removeWrapper(buttonEl);\\r\\n        }, 0);\\r\\n\\r\\n        setTimeout(() => {\\r\\n            if (callback) callback();\\r\\n        }, 0);\\r\\n    }\\r\\n\\r\\n    function onWarningClick(buttonEl, warning, callback) {\\r\\n        dialog({\\r\\n            addClass: CSS.warningClass,\\r\\n            text: warning,\\r\\n            buttons: [\\r\\n                {\\r\\n                    text: 'OK',\\r\\n                    callback: callback\\r\\n                },\\r\\n                {\\r\\n                    text: 'Cancel',\\r\\n                    callback: ()=> {}\\r\\n                }\\r\\n            ]\\r\\n        })\\r\\n    }\\r\\n\\r\\n    /**************************************\\r\\n     *  window events\\r\\n     *************************************/\\r\\n\\r\\n    /**************************************\\r\\n     *  window utils\\r\\n     *************************************/\\r\\n\\r\\n    function createWindowEl() {\\r\\n        const winEl = div(CSS.winClass);\\r\\n        winEl.id = CSS.winId;\\r\\n        return winEl;\\r\\n    }\\r\\n\\r\\n    function divCodeOptions(options, name, className) {\\r\\n        if (options[name] == null) return '';\\r\\n        return divCode(options[name], className);\\r\\n    }\\r\\n\\r\\n    function getTitleHtml(options) {\\r\\n        return divCodeOptions(options, 'title', CSS.titleClass);\\r\\n    }\\r\\n\\r\\n    function getTextHtml(options) {\\r\\n        return divCodeOptions(options, 'text', CSS.textClass);\\r\\n    }\\r\\n\\r\\n    function getButtonHtml(btOptions, index) {\\r\\n        const warningAttr = btOptions.warning != null\\r\\n            ? `data-warning=\\\"${btOptions.warning}\\\"`\\r\\n            : '';\\r\\n\\r\\n        return `<div class=\\\"${CSS.buttonClass}\\\" ${warningAttr} data-index=\\\"${index}\\\">${btOptions.text}</div>`;\\r\\n    }\\r\\n\\r\\n    function getButtonsHTML(options) {\\r\\n        if (options.buttons == null || options.buttons.length == 0) {\\r\\n            console.warn('NO buttons in dialog');\\r\\n            return;\\r\\n        }\\r\\n\\r\\n        const buttonsCode = options.buttons\\r\\n            .map(getButtonHtml)\\r\\n            .join('\\\\n');\\r\\n\\r\\n        const buttonWrapper = divCode(buttonsCode, CSS.buttonWrapClass);\\r\\n\\r\\n        return buttonWrapper;\\r\\n    }\\r\\n\\r\\n})(libraryName)\\r\\n\\n\\n//# sourceURL=webpack:///../node_modules/kvisaz-dialog/src/kvisaz.js?\")},\"./wonder-format/start.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar GameLogic_1 = __webpack_require__(/*! ./ts/twine-game/GameLogic */ \"./wonder-format/ts/twine-game/GameLogic.ts\");\\r\\nvar GameView_1 = __webpack_require__(/*! ./ts/twine-game/GameView */ \"./wonder-format/ts/twine-game/GameView.ts\");\\r\\nvar TwineParser_1 = __webpack_require__(/*! ./ts/parser/TwineParser */ \"./wonder-format/ts/parser/TwineParser.ts\");\\r\\n__webpack_require__(/*! kvisaz-dialog/src/kvisaz.js */ \"../node_modules/kvisaz-dialog/src/kvisaz.js\");\\r\\nconsole.log(\\'Kvisaz lib check ::\\', window[\\'Kvisaz\\']);\\r\\n// @ts-ignore from webpack\\r\\nvar VERSION = \"game version 0.6.22\";\\r\\nconsole.log(\"..............................\");\\r\\nconsole.log(\"Twine Wonder parser \" + VERSION);\\r\\nconsole.log(\"..............................\");\\r\\n// быстро берем стиль из ноды\\r\\n// чтобы добавить его к прелоадеру\\r\\nvar storyStyle = TwineParser_1.getTwineStoryStyle();\\r\\nvar view = new GameView_1.GameView(storyStyle);\\r\\nvar logic = new GameLogic_1.GameLogic();\\r\\nlogic.start();\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/start.ts?')},\"./wonder-format/ts/Constants.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\n// twine tags\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nexports.STORY_SELECTOR = \"tw-storydata\";\\r\\nexports.PASSAGE_SELECTOR = \"tw-passagedata\";\\r\\nexports.COMMON_CSS = {\\r\\n    displayNone: \"displayNone\",\\r\\n    pointerOver: \"pointerOver\",\\r\\n    visited: \"visited\",\\r\\n    back: \"back\"\\r\\n};\\r\\n// wonder selector\\r\\nexports.WONDER = {\\r\\n    shadowScreenClass: \\'scr-shadow\\',\\r\\n    preloadId: \\'preload\\',\\r\\n    preloadAnchorId: \\'preload-anchor\\',\\r\\n    startScreenId: \\'start-screen\\',\\r\\n    newGameBtId: \\'new-game-button\\',\\r\\n    continueBtId: \\'continue-button\\',\\r\\n    buttonClass: \\'w-button\\',\\r\\n    contentId: \"wonder-content\",\\r\\n    pageClass: \"page\",\\r\\n    pageContentClass: \"page-content\",\\r\\n    textClass: \"text\",\\r\\n    choiceClass: \"choice\",\\r\\n    inlineClass: \"inline\",\\r\\n    linkClass: \"link\",\\r\\n    pressedClass: \"pressed\",\\r\\n    linkAloneClass: \"link-alone\",\\r\\n    newLineClass: \"newLine\",\\r\\n    linkInlineClass: \"inline\",\\r\\n    noSelectClass: \"noselect\",\\r\\n    selectClass: \"select\",\\r\\n    paramClass: \\'params\\',\\r\\n    visitedClass: exports.COMMON_CSS.visited,\\r\\n    backClass: exports.COMMON_CSS.back,\\r\\n    invisibleClass: exports.COMMON_CSS.displayNone,\\r\\n    template: {\\r\\n        text: \"<text/>\",\\r\\n        choices: \"<choices/>\",\\r\\n        choiceStart: \"<choice>\",\\r\\n        choiceEnd: \"</choice>\",\\r\\n        choiceText: \"<choice-text/>\",\\r\\n        choiceId: \"<choice-id/>\",\\r\\n    },\\r\\n    passages: {\\r\\n        config: \"wonder.config\",\\r\\n        // todo\\r\\n        pageFormat: \"wonder.format.page\",\\r\\n        choiceFormat: \"wonder.format.choice\",\\r\\n        textFormat: \"wonder.format.text\",\\r\\n    },\\r\\n    markLang: {\\r\\n        varStart: \"var\",\\r\\n        commandSplitter: \":\",\\r\\n    },\\r\\n    inlineStart: \"=\",\\r\\n};\\r\\nvar REGEXP_ANY = \\'([\\\\\\\\s\\\\\\\\S]*?)\\';\\r\\n// regexps\\r\\nexports.REGEXP = {\\r\\n    exeScript: new RegExp(\\'{{\\' + REGEXP_ANY + \\'}}\\', \"g\"),\\r\\n    // /\\\\[\\\\[(.*?)\\\\]\\\\]/g - при переводе в строку удваивем  \\\\\\r\\n    twineLink: new RegExp(\\'\\\\\\\\[\\\\\\\\[\\' + REGEXP_ANY + \\'\\\\\\\\]\\\\\\\\]\\', \"g\"),\\r\\n};\\r\\n// templates\\r\\nexports.PRELOAD_PAGE_TEMPLATE = \"<div id=\" + exports.WONDER.preloadAnchorId + \"></div>\";\\r\\nexports.PAGE_TEMPLATE = \"<div class=\\\\\"\" + exports.WONDER.noSelectClass + \" \" + exports.WONDER.pageClass + \"\\\\\"></div>\";\\r\\nexports.LINK_TEMPLATE = \"<span class=\\\\\"\" + exports.WONDER.linkClass + \"  \" + exports.WONDER.linkAloneClass + \"\\\\\" data-id=\\\\\"\" + exports.WONDER.template.choiceId + \"\\\\\">\" + exports.WONDER.template.choiceText + \"</span>\";\\r\\nexports.LINK_INLINE_TEMPLATE = \"<span class=\\\\\"\" + exports.WONDER.linkClass + \"\\\\\" data-id=\\\\\"\" + exports.WONDER.template.choiceId + \"\\\\\">\" + exports.WONDER.template.choiceText + \"</span>\";\\r\\nexports.BACK_TEMPLATE = \"<div class=\\\\\"\" + exports.WONDER.backClass + \"\\\\\">\\\\u041D\\\\u0430\\\\u0437\\\\u0430\\\\u0434</div>\";\\r\\n// done 0 скрипты через {{}}\\r\\n// todo 1 произвольное создание параметров, инжектирование в params\\r\\n// rejected 2 общий шаблон Passage-Template - конфликт display: none с flex\\r\\n// done 3 flex css для page\\r\\nexports.PASSAGE_TEMPLATE = \"<div class=\\\\\"\" + exports.WONDER.pageContentClass + \"\\\\\">\\\\n\" + exports.BACK_TEMPLATE + \"\\\\n<div class=\\\\\"\" + exports.WONDER.paramClass + \"\\\\\" ><div id=\\\\\"gold\\\\\"></div></div>\\\\n<div class=\\\\\"\" + exports.WONDER.textClass + \"\\\\\"><text/></div>\\\\n</div>\";\\r\\n//language=CSS\\r\\nexports.DEFAULT_STYLE = \"\\\\n     * {user-select: none;}\\\\n    .noselect { user-select: none; }    \\\\n    .select {  user-select: text; }\\\\n    .page .displayNone, .displayNone {\\\\n        display: none; \\\\n    }\\\\n    html, body{height: 100%}\\\\n    .pointerOver {\\\\n        cursor: pointer;\\\\n    }\\\\n    \\\\n    ul, li {\\\\n        margin: 0;\\\\n        padding: 0;\\\\n        list-style: none;\\\\n    }\\\\n    \\\\n    body {\\\\n        margin: 0;\\\\n        padding: 0;\\\\n        background: #ceceb7;\\\\n        font-family: \\\\\"Verdana\\\\\", \\\\\"Roboto\\\\\", \\\\\"Open Sans\\\\\", sans-serif;\\\\n        position: relative;\\\\n        display: flex;\\\\n        justify-content: center;\\\\n        align-items: start;\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.shadowScreenClass + \" {\\\\n       position: absolute;\\\\n        width: 100%;\\\\n        height: 100%;\\\\n        background: #000;\\\\n        opacity: 0.3;\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.newLineClass + \" {\\\\n        display: block;\\\\n    }\\\\n    \\\\n    #\" + exports.WONDER.contentId + \" {\\\\n        width: 800px;\\\\n        border-radius: 0 0 8px 8px;\\\\n        overflow: hidden;\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.pageClass + \" {\\\\n          background: beige;          \\\\n     }\\\\n     \\\\n     #\" + exports.WONDER.preloadId + \" .\" + exports.WONDER.pageClass + \" {\\\\n        background: none;\\\\n     }\\\\n     \\\\n     .\" + exports.WONDER.pageContentClass + \" {\\\\n          display: flex;\\\\n          flex-direction: column;\\\\n          padding: 12px;\\\\n     }\\\\n        \\\\n    .\" + exports.WONDER.paramClass + \"{\\\\n        margin-bottom: 12px;\\\\n    }\\\\n        \\\\n        \\\\n    .\" + exports.WONDER.textClass + \" {\\\\n        margin: 0;\\\\n        font-size: 18px;\\\\n        line-height: 26px;\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.linkClass + \"{\\\\n        display: block;\\\\n        cursor: pointer;\\\\n        padding: 5px 35px;\\\\n        border-radius: 5px;\\\\n        background: #d5c695;\\\\n    }   \\\\n    \\\\n    .\" + exports.WONDER.inlineClass + \" .\" + exports.WONDER.linkClass + \"{\\\\n        display: inline;\\\\n        cursor: pointer;\\\\n        padding: 5px 35px;\\\\n        border-radius: 5px;\\\\n        background: #d5c695;\\\\n    }  \\\\n    \\\\n        \\\\n    .\" + exports.WONDER.linkClass + \":hover, .\" + exports.WONDER.backClass + \":hover{\\\\n        color: #4b0d1e;\\\\n        background: #d5b562;       \\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.visitedClass + \":after {\\\\n        content: \\'  (\\\\u043F\\\\u0440\\\\u043E\\\\u0447\\\\u0438\\\\u0442\\\\u0430\\\\u043D\\\\u043E)\\';\\\\n        font-size: smaller;\\\\n     }\\\\n     \\\\n     .\" + exports.WONDER.visitedClass + \" {\\\\n        opacity: 0.65;\\\\n        font-size: smaller;\\\\n     }\\\\n    \\\\n    .\" + exports.WONDER.backClass + \" {\\\\n        cursor: pointer;\\\\n        display: inline-block;\\\\n        margin-left: 0;\\\\n        margin-right: auto;\\\\n        margin-bottom: 4px;\\\\n        padding: 4px;\\\\n        border-radius: 5px;\\\\n        background: #eae2c5;\\\\n        color: #6c6c6c;\\\\n    }\\\\n    \\\\n     .\" + exports.WONDER.backClass + \":before {\\\\n        content: \\'<\\';\\\\n     }\\\\n     \\\\n     .\" + exports.WONDER.buttonClass + \" {\\\\n        cursor: pointer;\\\\n        display: block;\\\\n        margin: 4px auto 0.65em;\\\\n        width: 8em;\\\\n        text-align: center;\\\\n        background: #c6c3b2;\\\\n        padding: 12px;\\\\n        text-transform: uppercase;\\\\n        transition:all 0.21s ease-out;\\\\n     }\\\\n     \\\\n     .\" + exports.WONDER.pressedClass + \"{\\\\n        opacity: 0.55;\\\\n        cursor: auto;\\\\n     }\\\\n    \\\\n    .\" + exports.WONDER.buttonClass + \":not(.\" + exports.WONDER.pressedClass + \"):active {\\\\n        transform: translateY(0.15em);\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.linkAloneClass + \"{\\\\n        margin-top: 0px;\\\\n    }\\\\n    \\\\n    .\" + exports.WONDER.linkAloneClass + \":hover{\\\\n        margin-top: -2px;\\\\n        margin-bottom: 2px;\\\\n        box-shadow: 2px 2px 1px #414141;\\\\n    }\\\\n    \\\\n    #\" + \"c-wrapper\" /* wrapperId */ + \"{\\\\n        position: absolute;\\\\n        display: flex;\\\\n        flex-direction: column;\\\\n        top: 0;\\\\n        left: 0;\\\\n    }\\\\n    \\\\n    .\" + \"c-button\" /* button */ + \"{\\\\n        width: 96px;     \\\\n        line-height: 1em;\\\\n        background: antiquewhite;\\\\n        margin-top: 24px;\\\\n        text-align: center;\\\\n        cursor: pointer;\\\\n        box-shadow: 1px 2px 6px black;\\\\n    }\\\\n    \\\\n    .\" + \"c-button\" /* button */ + \":hover {\\\\n        transform: scale(1.09) translateX(4px);\\\\n        box-shadow: 1px 2px 6px black;\\\\n    }\\\\n    \\\\n    .\" + \"c-bt-title\" /* buttonTitle */ + \"{\\\\n        font-size: 16px;\\\\n        text-align: center;\\\\n        height: 1em;\\\\n        line-height: 1em;\\\\n        background: #b66e13;\\\\n        margin-bottom: 12px;\\\\n        padding: 2px;\\\\n    }\\\\n    \\\\n    .\" + \"c-bt-content\" /* buttonContent */ + \"{\\\\n        font-size: 24px;\\\\n        text-align: center;\\\\n        height: 1em;\\\\n        line-height: 1em;\\\\n        margin-bottom: 12px;\\\\n    }\\\\n    \\\\n    .\" + \"c-list\" /* list */ + \"{\\\\n        position: absolute;\\\\n        height: 89%;\\\\n        width: 800px;        \\\\n        top: 10%;\\\\n        left: 0;\\\\n        transform: translate(-100%, 0);\\\\n        background: #876b38;\\\\n        transition-duration: 0.45s;\\\\n        animation-timing-function: ease-out;\\\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\\\n    }\\\\n    \\\\n    .\" + \"c-list-show\" /* listShow */ + \"{\\\\n        left: 50%;\\\\n        transform: translate(-49%, 0);\\\\n    }\\\\n    \\\\n    .\" + \"c-list-title\" /* listTitle */ + \"{\\\\n        font-size: 32px;    \\\\n         color: antiquewhite;   \\\\n        margin: 12px;\\\\n     }\\\\n        \\\\n    .\" + \"c-list-content\" /* listContent */ + \"{\\\\n        font-size: 24px;\\\\n        overflow: auto;\\\\n        padding: 12px;\\\\n        background: #d7d7c5;\\\\n        border: 1px solid #afafaf;\\\\n        height: 90%;\\\\n    }\\\\n    .\" + \"c-item\" /* listItem */ + \"{ \\\\n         padding: 12px;\\\\n         border: 1px solid #afafaf;\\\\n         cursor: pointer;\\\\n         background: beige;\\\\n         border-radius: 4px;\\\\n         margin-top: 6px;\\\\n    }\\\\n    \\\\n    .\" + \"c-item\" /* listItem */ + \":hover {\\\\n        transform: scale(1.01);\\\\n        background: #fffffc;\\\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\\\n    }   \\\\n    \\\\n    .\" + \"c-list-content\" /* listContent */ + \"::-webkit-scrollbar { width: 32px; }\\\\n        \\\\n    .\" + \"c-list-content\" /* listContent */ + \"::-webkit-scrollbar-track {\\\\n        background: #d0ac75;\\\\n        border-radius: 16px;    \\\\n    }\\\\n    .\" + \"c-list-content\" /* listContent */ + \"::-webkit-scrollbar-thumb {\\\\n          background-color: #f1760c;   \\\\n          border-radius: 20px;       \\\\n          border: 2px solid #6f3909; \\\\n    }\\\\n    \\\\n    .\" + \"c-page\" /* page */ + \"{\\\\n        position: absolute;\\\\n        height: 95%;\\\\n        width: 800px;        \\\\n        top: 3%;\\\\n        left: 0;\\\\n        transform: translate(-100%, 0);        \\\\n        background: beige;\\\\n        overflow: auto;\\\\n        transition-duration: 0.45s;\\\\n        animation-timing-function: ease-out;\\\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\\\n    }\\\\n    \\\\n    .\" + \"c-page-content\" /* pageContent */ + \"{\\\\n        margin: 12px 12px 16px;\\\\n    }\\\\n    \\\\n    .\" + \"c-page-show\" /* pageShow */ + \"{\\\\n        left: 50%;\\\\n        transform: translate(-47%, 0);\\\\n    }\\\\n    \\\\n    .\" + \"c-page\" /* page */ + \"::-webkit-scrollbar { width: 32px; }\\\\n        \\\\n    .\" + \"c-page\" /* page */ + \"::-webkit-scrollbar-track {\\\\n        background: #d0ac75;\\\\n        border-radius: 16px;    \\\\n    }\\\\n    .\" + \"c-page\" /* page */ + \"::-webkit-scrollbar-thumb {\\\\n          background-color: #ce9643;   \\\\n          border-radius: 20px;       \\\\n          border: 2px solid #efd0a6; \\\\n    }\\\\n    \\\\n    .\" + \"menu-main-button\" /* mainButtonClass */ + \"{\\\\n        font-size: 24px;\\\\n        position: absolute;\\\\n        background: #c6c3b2;\\\\n        cursor: pointer;    \\\\n        top: -132px;\\\\n        right: -132px;\\\\n        transform: scale(0.1);\\\\n        transition:all 0.21s ease-out;\\\\n        width: 132px;\\\\n        height: 132px;\\\\n        box-shadow: -2px 2px 6px rgba(0,0,0,0.5);   \\\\n        border-radius: 0px 0px 0px 128px;\\\\n    }\\\\n    \\\\n    .\" + \"menu-main-button-visible\" /* mainButtonVisibleClass */ + \"{\\\\n        top: -4px;\\\\n        right: -4px;\\\\n        transform: scale(1);\\\\n    }\\\\n    \\\\n    .\" + \"menu-main-button\" /* mainButtonClass */ + \" svg{\\\\n        position: absolute;\\\\n        left: 44px;\\\\n        bottom: 44px;\\\\n        width: 64px;\\\\n        height: 64px;\\\\n    }\\\\n    \\\\n    .\" + \"menu-main-button\" /* mainButtonClass */ + \" svg path{\\\\n        stroke: #534633;\\\\n        stroke-width: 2px;\\\\n        fill: #362e23;\\\\n        stroke-opacity: 0.5;\\\\n    }\\\\n    \\\\n    .\" + \"menu-main-button\" /* mainButtonClass */ + \" svg circle{\\\\n        fill: beige;\\\\n    }\\\\n    \\\\n    \\\\n    \\\\n    .\" + \"menu-main-button-visible\" /* mainButtonVisibleClass */ + \":active{\\\\n         box-shadow:none;\\\\n         transform: translateY(2px);   \\\\n    }\\\\n    \\\\n    \\\\n    .\" + \"menu-main-button-content\" /* mainButtonClassContent */ + \"{\\\\n    }\\\\n    \\\\n    .\" + \"menu-win\" /* winClass */ + \"{\\\\n        position: absolute;\\\\n        height: 95%;\\\\n        width: 800px;        \\\\n        top: 3%;\\\\n        right: 0;\\\\n        transform: translate(-100%, 0);        \\\\n        background: beige;\\\\n        overflow: auto;\\\\n        transition-duration: 0.45s;\\\\n        animation-timing-function: ease-out;\\\\n        box-shadow: 1px 2px 6px rgba(0,0,0,0.65);\\\\n    }\\\\n    \\\\n    .\" + \"menu-win-visible\" /* winVisibleClass */ + \"{\\\\n        left: 50%;\\\\n        transform: translate(-52%, 0);\\\\n    }\\\\n    \\\\n    .\" + \"menu-win-button\" /* winButtonClass */ + \"{\\\\n        cursor: pointer;    \\\\n        background: #5D7CC8;\\\\n        width: 300px;\\\\n        height: 125px;\\\\n    }\\\\n    \\\\n    @media screen and (max-width: 800px){\\\\n        .\" + exports.WONDER.contentId + \" {\\\\n             width: 100%;\\\\n             margin: 0;\\\\n             border-radius: 0;\\\\n        }\\\\n    }\\\\n\";\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/Constants.ts?')},\"./wonder-format/ts/ConstantsSvg.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nexports.IcSvgSettings = \\'<svg class=\"svg-settings\" viewBox=\"0 0 32 32\" fill=\"none\" stroke=\"#dedede\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path d=\"M13 2 L13 6 11 7 8 4 4 8 7 11 6 13 2 13 2 19 6 19 7 21 4 24 8 28 11 25 13 26 13 30 19 30 19 26 21 25 24 28 28 24 25 21 26 19 30 19 30 13 26 13 25 11 28 8 24 4 21 7 19 6 19 2 Z\"></path><circle cx=\"16\" cy=\"16\" r=\"4\"></circle></svg>\\';\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/ConstantsSvg.ts?')},\"./wonder-format/ts/app-core/ArrayUtils.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar ArrayUtils = /** @class */ (function () {\\r\\n    function ArrayUtils() {\\r\\n    }\\r\\n    /**\\r\\n     * getRandom - взять n рандомных элементов из массива\\r\\n     * исходный массив не меняется\\r\\n     * @param arr\\r\\n     * @param n\\r\\n     */\\r\\n    ArrayUtils.getRandom = function (arr, n) {\\r\\n        if (n === void 0) { n = 1; }\\r\\n        var result = new Array(n), len = arr.length, taken = new Array(len);\\r\\n        if (n > len)\\r\\n            throw new RangeError(\"getRandom: more elements taken than available\");\\r\\n        while (n--) {\\r\\n            var x = Math.floor(Math.random() * len);\\r\\n            result[n] = arr[x in taken ? taken[x] : x];\\r\\n            taken[x] = --len in taken ? taken[len] : len;\\r\\n        }\\r\\n        return result;\\r\\n    };\\r\\n    /**\\r\\n     * pushUnique - поместить элемент в массив, только если его там нет\\r\\n     */\\r\\n    ArrayUtils.pushUnique = function (arr, el) {\\r\\n        if (arr.indexOf(el) < 0)\\r\\n            arr.push(el);\\r\\n        return arr;\\r\\n    };\\r\\n    ArrayUtils.removeChild = function (arr, el) {\\r\\n        var index = arr.indexOf(el);\\r\\n        if (index > -1) {\\r\\n            arr.splice(index, 1);\\r\\n        }\\r\\n    };\\r\\n    ArrayUtils.remove = function (arr, index) {\\r\\n        if (index > -1) {\\r\\n            return arr.splice(index, 1)[0];\\r\\n        }\\r\\n        else\\r\\n            return null;\\r\\n    };\\r\\n    ArrayUtils.removeLast = function (arr, amount) {\\r\\n        while (amount-- > 0)\\r\\n            arr.pop();\\r\\n    };\\r\\n    /**\\r\\n     * Перемешать массив, результат повторяется при каждом seed\\r\\n     * @param arr\\r\\n     * @param seed -\\r\\n     */\\r\\n    ArrayUtils.shuffleWithSeed = function (arr, seed) {\\r\\n        if (seed === void 0) { seed = 17; }\\r\\n        var i, next, tmp;\\r\\n        var length = arr.length;\\r\\n        var seed2 = 31; // оба сида должны быть простыми числами\\r\\n        var randomI;\\r\\n        for (i = 0; i < length; i++) {\\r\\n            randomI = (seed * i + seed2) % length;\\r\\n            tmp = arr[randomI];\\r\\n            arr[randomI] = arr[i];\\r\\n            arr[i] = tmp;\\r\\n        }\\r\\n        return arr;\\r\\n    };\\r\\n    /**\\r\\n     *  перемешать массив, мутабельно\\r\\n     */\\r\\n    ArrayUtils.shuffle = function (arr, order) {\\r\\n        if (order === void 0) { order = ArrayShuffleOrder.random; }\\r\\n        switch (order) {\\r\\n            case ArrayShuffleOrder.same:\\r\\n                return arr;\\r\\n            case ArrayShuffleOrder.chaos:\\r\\n                return arr.sort(function (a, b) { return Math.random() - 0.5; });\\r\\n            case ArrayShuffleOrder.random:\\r\\n                return ArrayUtils.shuffleWithSeed(arr, 13);\\r\\n        }\\r\\n    };\\r\\n    /**\\r\\n     *  применить массив args к arr с помощью applyFn\\r\\n     * @param arr\\r\\n     * @param args\\r\\n     * @param applyFn\\r\\n     * @param useLast - если true, то последний из args используется для всех оставшихся элементов массива,\\r\\n     *          если аргументов меньше по длине, чем arr - последний args используется до конца\\r\\n     *          если false - обработка заканчивается с последним указанным из args\\r\\n     */\\r\\n    ArrayUtils.updateArray = function (arr, args, applyFn, useLast) {\\r\\n        if (useLast === void 0) { useLast = true; }\\r\\n        if (arr == null || args == null || args.length == 0)\\r\\n            return;\\r\\n        var next;\\r\\n        var last;\\r\\n        arr.forEach(function (el, i) {\\r\\n            next = i < args.length ? args[i] : last;\\r\\n            applyFn(el, next);\\r\\n            last = next;\\r\\n        });\\r\\n    };\\r\\n    return ArrayUtils;\\r\\n}());\\r\\nexports.ArrayUtils = ArrayUtils;\\r\\n// порядок карт в колоде\\r\\nvar ArrayShuffleOrder;\\r\\n(function (ArrayShuffleOrder) {\\r\\n    ArrayShuffleOrder[\"random\"] = \"random\";\\r\\n    ArrayShuffleOrder[\"same\"] = \"same\";\\r\\n    ArrayShuffleOrder[\"chaos\"] = \"chaos\";\\r\\n})(ArrayShuffleOrder = exports.ArrayShuffleOrder || (exports.ArrayShuffleOrder = {}));\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/app-core/ArrayUtils.ts?')},\"./wonder-format/ts/app-core/DomUtils.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar DomUtils = /** @class */ (function () {\\r\\n    function DomUtils() {\\r\\n    }\\r\\n    DomUtils.divWith = function (content) {\\r\\n        var div = document.createElement(\"div\");\\r\\n        div.innerHTML = content;\\r\\n        return div;\\r\\n    };\\r\\n    DomUtils.elementFromTemplate = function (template) {\\r\\n        var div = DomUtils.divWith(template);\\r\\n        return div.firstChild;\\r\\n    };\\r\\n    // добавить child в parent под child с заданным id (если такой существует)\\r\\n    DomUtils.addChildBefore = function (parent, newChild, id) {\\r\\n        var child;\\r\\n        var notAdded = true;\\r\\n        var children = parent.children;\\r\\n        // если id не задан - добавляем последним\\r\\n        if (id == null || id.length == 0) {\\r\\n            parent.appendChild(newChild);\\r\\n            return;\\r\\n        }\\r\\n        // иначе пробуем найти и вставить перед элементом с id\\r\\n        for (var i = 0; i < children.length; i++) {\\r\\n            child = children[i];\\r\\n            if (child.id == id) {\\r\\n                parent.insertBefore(newChild, child);\\r\\n                notAdded = false;\\r\\n                return;\\r\\n            }\\r\\n        }\\r\\n        // если не нашли - добавляем последнием\\r\\n        if (notAdded) {\\r\\n            parent.appendChild(newChild);\\r\\n        }\\r\\n    };\\r\\n    DomUtils.remove = function (el) {\\r\\n        if (el.parentNode)\\r\\n            el.parentNode.removeChild(el);\\r\\n    };\\r\\n    // добавить, только если ребенка нет\\r\\n    DomUtils.addChildIfNot = function (parent, el) {\\r\\n        if (el.parentNode != parent)\\r\\n            parent.appendChild(el);\\r\\n    };\\r\\n    DomUtils.bringToTop = function (el) {\\r\\n        if (el.parentNode)\\r\\n            el.parentNode.appendChild(el);\\r\\n    };\\r\\n    DomUtils.matches = function (el, selector) {\\r\\n        return matches.call(el, selector);\\r\\n    };\\r\\n    DomUtils.copyToClipboard = function (str) {\\r\\n        var el = document.createElement(\\'textarea\\');\\r\\n        el.value = str;\\r\\n        document.body.appendChild(el);\\r\\n        el.select();\\r\\n        document.execCommand(\\'copy\\');\\r\\n        document.body.removeChild(el);\\r\\n    };\\r\\n    DomUtils.getBlobURL = function (code, type) {\\r\\n        var blob = new Blob([code], { type: type });\\r\\n        return URL.createObjectURL(blob);\\r\\n    };\\r\\n    DomUtils.getHtmlBlobUrl = function (code) {\\r\\n        return DomUtils.getBlobURL(code, \"text/html\");\\r\\n    };\\r\\n    DomUtils.removeAllChildren = function (el) {\\r\\n        while (el.firstChild) {\\r\\n            el.removeChild(el.firstChild);\\r\\n        }\\r\\n    };\\r\\n    /**\\r\\n     * Uses canvas.measureText to compute and return the width of the given text of given font in pixels.\\r\\n     *\\r\\n     * @param {String} text The text to be rendered.\\r\\n     * @param {String} fontCss The css font descriptor that text is to be rendered with (e.g. \"bold 14px verdana\").\\r\\n     *\\r\\n     * @see https://stackoverflow.com/questions/118241/calculate-text-width-with-javascript/21015393#21015393\\r\\n     */\\r\\n    DomUtils.getTextMetrics = function (text, fontCss) {\\r\\n        // re-use canvas object for better performance\\r\\n        if (DomUtils.canvas == null) {\\r\\n            DomUtils.canvas = document.createElement(\"canvas\");\\r\\n        }\\r\\n        var context = DomUtils.canvas.getContext(\"2d\");\\r\\n        context.font = fontCss;\\r\\n        return context.measureText(text);\\r\\n    };\\r\\n    DomUtils.getTextWidth = function (text, fontCss) {\\r\\n        return DomUtils.getTextMetrics(text, fontCss).width;\\r\\n    };\\r\\n    DomUtils.isFullScreenEnabled = function () {\\r\\n        return document.fullscreenEnabled ||\\r\\n            // @ts-ignore\\r\\n            document.webkitFullscreenEnabled ||\\r\\n            // @ts-ignore\\r\\n            document.mozFullScreenEnabled ||\\r\\n            // @ts-ignore\\r\\n            document.msFullscreenEnabled;\\r\\n    };\\r\\n    DomUtils.closest = function (child, selector) {\\r\\n        var next = child;\\r\\n        var i = 0;\\r\\n        do {\\r\\n            if (next == null)\\r\\n                return null;\\r\\n            if (DomUtils.matches(next, selector))\\r\\n                return next;\\r\\n            next = next.parentElement;\\r\\n        } while (i++ < 10000);\\r\\n        console.warn(\" \" + i + \" loops - check code for errors!\");\\r\\n    };\\r\\n    DomUtils.prepend = function (parent, child) {\\r\\n        parent.insertBefore(child, parent.firstChild);\\r\\n    };\\r\\n    return DomUtils;\\r\\n}());\\r\\nexports.DomUtils = DomUtils;\\r\\n/******\\r\\n *  Polyfills\\r\\n *****/\\r\\nvar matches = Element.prototype.matches ||\\r\\n    // @ts-ignore\\r\\n    Element.prototype.matchesSelector ||\\r\\n    Element.prototype.webkitMatchesSelector ||\\r\\n    // @ts-ignore\\r\\n    Element.prototype.mozMatchesSelector ||\\r\\n    // @ts-ignore\\r\\n    Element.prototype.msMatchesSelector;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/app-core/DomUtils.ts?')},\"./wonder-format/ts/app-core/EventBus.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar Task_1 = __webpack_require__(/*! ./Task */ \"./wonder-format/ts/app-core/Task.ts\");\\r\\nvar ArrayUtils_1 = __webpack_require__(/*! ./ArrayUtils */ \"./wonder-format/ts/app-core/ArrayUtils.ts\");\\r\\n/***\\r\\n *  Использование\\r\\n *  подписаться на сообщения\\r\\n *  EventBus\\r\\n *      .sub(\"messageType1\", (message, data)=>{})\\r\\n *      .sub(\"messageType2\", (message, data)=>{})\\r\\n *      .sub(\"messageType3\", (message, data)=>{});\\r\\n *\\r\\n *  сообщить\\r\\n *  EventBus.emit(\"messageType1\", data?:any);\\r\\n *\\r\\n *  для использования в конкретных играх - уместно объявить класс-потомкс уникальным именем\\r\\n *  типа MyGameEvents\\r\\n *  и использовать именно MyGameEvents\\r\\n */\\r\\nvar EventBus = /** @class */ (function () {\\r\\n    function EventBus() {\\r\\n        this.listeners = {};\\r\\n    }\\r\\n    EventBus.prototype.getListeners = function (message) {\\r\\n        return this.listeners[message];\\r\\n    };\\r\\n    EventBus.prototype.initListeners = function (message) {\\r\\n        this.listeners[message] = [];\\r\\n        return this.listeners[message];\\r\\n    };\\r\\n    EventBus.getInstance = function () {\\r\\n        if (EventBus.instance == null)\\r\\n            EventBus.instance = new EventBus();\\r\\n        return EventBus.instance;\\r\\n    };\\r\\n    EventBus.addListener = function (message, listener) {\\r\\n        var listeners = EventBus.getInstance().getListeners(message)\\r\\n            || EventBus.getInstance().initListeners(message);\\r\\n        listeners.push(listener);\\r\\n    };\\r\\n    EventBus.prototype.sub = function (message, listener) {\\r\\n        var listeners = this.getListeners(message) || this.initListeners(message);\\r\\n        listeners.push(listener);\\r\\n        return this;\\r\\n    };\\r\\n    EventBus.prototype.unsub = function (message, listener) {\\r\\n        var listeners = this.getListeners(message);\\r\\n        if (listeners == null)\\r\\n            return;\\r\\n        ArrayUtils_1.ArrayUtils.removeChild(listeners, listener);\\r\\n        return this;\\r\\n    };\\r\\n    EventBus.emit = function (message, data) {\\r\\n        var listeners = EventBus.getInstance().getListeners(message);\\r\\n        if (listeners)\\r\\n            listeners.forEach(function (listener) {\\r\\n                /**\\r\\n                 * каждый листенер исполняется в свою очередь в EventLoop\\r\\n                 * - поэтому ошибка в одном листенере не будет ломать стек с другими\\r\\n                 *  - поэтому ошибка 1 листенера не будет ломать остальные\\r\\n                 */\\r\\n                Task_1.Task.order(function () {\\r\\n                    listener(message, data);\\r\\n                });\\r\\n            });\\r\\n    };\\r\\n    return EventBus;\\r\\n}());\\r\\nexports.EventBus = EventBus;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/app-core/EventBus.ts?')},\"./wonder-format/ts/app-core/Task.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar orderTask = requestAnimationFrame\\r\\n    ? function (fn) { return requestAnimationFrame(fn); }\\r\\n    : function (fn) { return setTimeout(fn, 0); };\\r\\nexports.Task = {\\r\\n    order: orderTask // заказать выполнение функции на следующий цикл EventLoop\\r\\n};\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/app-core/Task.ts?')},\"./wonder-format/ts/parser/FormatTwinePassageAsHTML.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar Constants_1 = __webpack_require__(/*! ../Constants */ \\\"./wonder-format/ts/Constants.ts\\\");\\r\\nfunction formatTwinePassageAsHTML(content, template) {\\r\\n    var MARKER = Constants_1.WONDER.template;\\r\\n    // 1. вынимаем из шаблона шаблон линков\\r\\n    var linkTemplate = innerTexts(template, MARKER.choiceStart, MARKER.choiceEnd)[0];\\r\\n    template = template\\r\\n        .replace(linkTemplate, MARKER.choiceText)\\r\\n        .replace(MARKER.choiceStart, '')\\r\\n        .replace(MARKER.choiceEnd, '');\\r\\n    // 2. традиционные линки\\r\\n    content = content.replace(Constants_1.REGEXP.twineLink, function (match, catched) {\\r\\n        catched = catched.trim();\\r\\n        // линки могут быть встроенные или с новой строки\\r\\n        var isInline = catched[0] == Constants_1.WONDER.inlineStart;\\r\\n        if (isInline) {\\r\\n            catched = catched.substring(1);\\r\\n        }\\r\\n        var TEMPLATE = isInline ? Constants_1.LINK_INLINE_TEMPLATE : Constants_1.LINK_TEMPLATE;\\r\\n        var link = buildLink(catched);\\r\\n        return getLinkHtml(link, TEMPLATE); // чистим\\r\\n    })\\r\\n        .trim();\\r\\n    // переводы строк в br\\r\\n    content = content.replace(/(?:\\\\r\\\\n|\\\\r|\\\\n)/g, '<br>');\\r\\n    // 99. вставляем текст\\r\\n    var code = template;\\r\\n    code = code.replace(MARKER.text, content.trim());\\r\\n    return code;\\r\\n}\\r\\nexports.formatTwinePassageAsHTML = formatTwinePassageAsHTML;\\r\\n/**\\r\\n * @param source - строка вида Зайти в лавку гоблина|goblin\\r\\n */\\r\\nfunction buildLink(source) {\\r\\n    var parts = source.split(\\\"|\\\");\\r\\n    parts[0] = parts[0].trim();\\r\\n    if (parts[1] == undefined)\\r\\n        parts[1] = parts[0];\\r\\n    return new Link(parts[0], parts[1]);\\r\\n}\\r\\nfunction getLinkHtml(link, linkTemplate) {\\r\\n    var code = linkTemplate\\r\\n        .replace(Constants_1.WONDER.template.choiceId, link.id)\\r\\n        .replace(Constants_1.WONDER.template.choiceText, link.text);\\r\\n    return code;\\r\\n}\\r\\nvar Link = /** @class */ (function () {\\r\\n    function Link(text, id) {\\r\\n        this.text = text;\\r\\n        this.id = id;\\r\\n    }\\r\\n    return Link;\\r\\n}());\\r\\n/**\\r\\n * Вернуть массив строк, которые находятся между двумя тегами/кусками текста\\r\\n * @method innerTexts\\r\\n * @param {string} str  исходная строка\\r\\n * @param {string} startTag\\r\\n * @param {string} endTag\\r\\n * @return {Array}\\r\\n */\\r\\nfunction innerTexts(str, startTag, endTag) {\\r\\n    var subStrings = [];\\r\\n    var offset = 0;\\r\\n    var startIndex, endIndex;\\r\\n    while (offset < str.length) {\\r\\n        startIndex = str.indexOf(startTag, offset);\\r\\n        if (startIndex === -1)\\r\\n            return subStrings;\\r\\n        endIndex = str.indexOf(endTag, startIndex);\\r\\n        if (endIndex === -1)\\r\\n            endIndex = undefined;\\r\\n        subStrings.push(str.substring(startIndex + startTag.length, endIndex));\\r\\n        offset = endIndex + endTag.length;\\r\\n    }\\r\\n    return subStrings;\\r\\n}\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/parser/FormatTwinePassageAsHTML.ts?\")},\"./wonder-format/ts/parser/TwineParser.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nfunction parseTwineData() {\\r\\n    var storyEl = document.body.querySelector('tw-storydata');\\r\\n    var story = elAttributesToObject(storyEl);\\r\\n    story.style = getTwineStoryStyle();\\r\\n    story.script = document.querySelector('#twine-user-script').innerHTML.trim();\\r\\n    var passageArray = Array.prototype.slice.call(storyEl.querySelectorAll('tw-passagedata'));\\r\\n    story.passageHash = {};\\r\\n    story.passages = passageArray.map(function (passageEl) {\\r\\n        var passage = elAttributesToObject(passageEl);\\r\\n        if (story.passageHash[passage.pid]) {\\r\\n            console.warn(\\\"duplicate passage id \\\" + passage.pid);\\r\\n        }\\r\\n        story.passageHash[passage.name] = passage;\\r\\n        if (story.startnode == passage.pid) {\\r\\n            story.startPassageName = passage.name;\\r\\n        }\\r\\n        passage.content = htmlDecode(passageEl.innerHTML.trim());\\r\\n        return passage;\\r\\n    });\\r\\n    return story;\\r\\n}\\r\\nexports.parseTwineData = parseTwineData;\\r\\nfunction getTwineStoryStyle() {\\r\\n    return document.querySelector('#twine-user-stylesheet').innerHTML.trim();\\r\\n}\\r\\nexports.getTwineStoryStyle = getTwineStoryStyle;\\r\\nfunction htmlDecode(input) {\\r\\n    var e = document.createElement('textarea');\\r\\n    e.innerHTML = input;\\r\\n    return e.childNodes.length === 0 ? \\\"\\\" : e.childNodes[0].nodeValue;\\r\\n}\\r\\n// convert attributes to fields\\r\\nfunction elAttributesToObject(el) {\\r\\n    var obj = {};\\r\\n    for (var i = 0, attrs = el.attributes, n = attrs.length; i < n; i++) {\\r\\n        obj[kebabToCamel(attrs[i].name)] = attrs[i].value;\\r\\n    }\\r\\n    return obj;\\r\\n}\\r\\nfunction kebabToCamel(str) {\\r\\n    var arr = str.split('-');\\r\\n    var capital = arr.map(function (item, index) { return index ? item.charAt(0).toUpperCase() + item.slice(1).toLowerCase() : item; });\\r\\n    // ^-- change here.\\r\\n    var capitalString = capital.join(\\\"\\\");\\r\\n    return capitalString;\\r\\n}\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/parser/TwineParser.ts?\")},\"./wonder-format/ts/twine-game/AppState.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar AppState = /** @class */ (function () {\\r\\n    function AppState() {\\r\\n        this.gameVars = {};\\r\\n        this.history = {\\r\\n            pagesHash: {},\\r\\n            pages: []\\r\\n        };\\r\\n    }\\r\\n    return AppState;\\r\\n}());\\r\\nexports.AppState = AppState;\\r\\nvar UserState = /** @class */ (function () {\\r\\n    function UserState() {\\r\\n        this.collectionMap = {};\\r\\n    }\\r\\n    return UserState;\\r\\n}());\\r\\nexports.UserState = UserState;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/AppState.ts?')},\"./wonder-format/ts/twine-game/GameEvents.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nvar __extends = (this && this.__extends) || (function () {\\r\\n    var extendStatics = function (d, b) {\\r\\n        extendStatics = Object.setPrototypeOf ||\\r\\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\\r\\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\\r\\n        return extendStatics(d, b);\\r\\n    };\\r\\n    return function (d, b) {\\r\\n        extendStatics(d, b);\\r\\n        function __() { this.constructor = d; }\\r\\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\\r\\n    };\\r\\n})();\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar Constants_1 = __webpack_require__(/*! ../Constants */ \\\"./wonder-format/ts/Constants.ts\\\");\\r\\nvar PageViewData = /** @class */ (function () {\\r\\n    function PageViewData(passage, gameVars, config, canGoBack, visitedPagesMap, pagesMap) {\\r\\n        this.passage = passage;\\r\\n        this.gameVars = gameVars;\\r\\n        this.config = config;\\r\\n        this.canGoBack = canGoBack;\\r\\n        this.visitedPagesMap = visitedPagesMap;\\r\\n        this.pagesMap = pagesMap;\\r\\n    }\\r\\n    return PageViewData;\\r\\n}());\\r\\nexports.PageViewData = PageViewData;\\r\\nvar PreloadPassage = {\\r\\n    pid: Constants_1.WONDER.preloadId,\\r\\n    position: '',\\r\\n    name: Constants_1.WONDER.preloadId,\\r\\n    tags: Constants_1.WONDER.preloadId,\\r\\n    size: '',\\r\\n    content: Constants_1.PRELOAD_PAGE_TEMPLATE\\r\\n};\\r\\nvar PreloadPageViewData = /** @class */ (function (_super) {\\r\\n    __extends(PreloadPageViewData, _super);\\r\\n    function PreloadPageViewData() {\\r\\n        return _super.call(this, PreloadPassage, {}, { uiParams: [] }, false, {}, {}) || this;\\r\\n    }\\r\\n    return PreloadPageViewData;\\r\\n}(PageViewData));\\r\\nexports.PreloadPageViewData = PreloadPageViewData;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/GameEvents.ts?\")},\"./wonder-format/ts/twine-game/GameLogic.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nvar __assign = (this && this.__assign) || function () {\\r\\n    __assign = Object.assign || function(t) {\\r\\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\\r\\n            s = arguments[i];\\r\\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\\r\\n                t[p] = s[p];\\r\\n        }\\r\\n        return t;\\r\\n    };\\r\\n    return __assign.apply(this, arguments);\\r\\n};\\r\\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\\r\\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\\r\\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\\r\\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\\r\\n            r[k] = a[j];\\r\\n    return r;\\r\\n};\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar EventBus_1 = __webpack_require__(/*! ../app-core/EventBus */ \"./wonder-format/ts/app-core/EventBus.ts\");\\r\\nvar GameEvents_1 = __webpack_require__(/*! ./GameEvents */ \"./wonder-format/ts/twine-game/GameEvents.ts\");\\r\\nvar Constants_1 = __webpack_require__(/*! ../Constants */ \"./wonder-format/ts/Constants.ts\");\\r\\nvar GameConfig_1 = __webpack_require__(/*! ./logic/GameConfig */ \"./wonder-format/ts/twine-game/logic/GameConfig.ts\");\\r\\nvar UserScriptApi_1 = __webpack_require__(/*! ./logic/userscript/UserScriptApi */ \"./wonder-format/ts/twine-game/logic/userscript/UserScriptApi.ts\");\\r\\nvar WonderHistory_1 = __webpack_require__(/*! ./logic/WonderHistory */ \"./wonder-format/ts/twine-game/logic/WonderHistory.ts\");\\r\\nvar AppState_1 = __webpack_require__(/*! ./AppState */ \"./wonder-format/ts/twine-game/AppState.ts\");\\r\\nvar Stores_1 = __webpack_require__(/*! ./Stores */ \"./wonder-format/ts/twine-game/Stores.ts\");\\r\\nvar TwineParser_1 = __webpack_require__(/*! ../parser/TwineParser */ \"./wonder-format/ts/parser/TwineParser.ts\");\\r\\nvar StateRepository_1 = __webpack_require__(/*! ./logic/repository/StateRepository */ \"./wonder-format/ts/twine-game/logic/repository/StateRepository.ts\");\\r\\nvar Collections_1 = __webpack_require__(/*! ./logic/collections/Collections */ \"./wonder-format/ts/twine-game/logic/collections/Collections.ts\");\\r\\nvar AudioPlayer_1 = __webpack_require__(/*! ./logic/AudioPlayer */ \"./wonder-format/ts/twine-game/logic/AudioPlayer.ts\");\\r\\nvar Preprocessor_1 = __webpack_require__(/*! ./logic/preprocessor/Preprocessor */ \"./wonder-format/ts/twine-game/logic/preprocessor/Preprocessor.ts\");\\r\\nvar PostMessageApi_1 = __webpack_require__(/*! ./logic/PostMessageApi */ \"./wonder-format/ts/twine-game/logic/PostMessageApi.ts\");\\r\\nvar LogicConstants_1 = __webpack_require__(/*! ./logic/LogicConstants */ \"./wonder-format/ts/twine-game/logic/LogicConstants.ts\");\\r\\nvar StartScreen_1 = __webpack_require__(/*! ./logic/start/StartScreen */ \"./wonder-format/ts/twine-game/logic/start/StartScreen.ts\");\\r\\nvar GameMenu_1 = __webpack_require__(/*! ./logic/collections/menu/GameMenu */ \"./wonder-format/ts/twine-game/logic/collections/menu/GameMenu.ts\");\\r\\nvar GameMenuConstants_1 = __webpack_require__(/*! ./logic/collections/menu/GameMenuConstants */ \"./wonder-format/ts/twine-game/logic/collections/menu/GameMenuConstants.ts\");\\r\\nvar GameLogic = /** @class */ (function () {\\r\\n    function GameLogic() {\\r\\n        var _this = this;\\r\\n        this.defaultGameVars = {}; // дефолтные переменные в начале игры, после загрузки истории и выполнения её скрипта\\r\\n        this.isUserSaveDisabledFlag = false; // запрет на сейвы\\r\\n        this.isLoading = false; // заказана загрузка\\r\\n        this.gameSaveName = LogicConstants_1.SaveNameDefault;\\r\\n        this.isDesktop = false;\\r\\n        console.log(\\'GameLogic constructor.....\\');\\r\\n        this.gameConfig = new GameConfig_1.GameConfig();\\r\\n        this.startScreen = new StartScreen_1.StartScreen();\\r\\n        this.gameMenu = new GameMenu_1.GameMenu();\\r\\n        this.history = new WonderHistory_1.WonderHistory();\\r\\n        this.collections = new Collections_1.Collections();\\r\\n        this.preprocessor = new Preprocessor_1.Preprocessor();\\r\\n        this.postMessageApi = new PostMessageApi_1.PostMessageApi();\\r\\n        this.stateRepo = new StateRepository_1.StateRepository(this.postMessageApi);\\r\\n        this.audioPlayer = new AudioPlayer_1.AudioPlayer();\\r\\n        this.userScriptApi = new UserScriptApi_1.UserScriptApi(this.postMessageApi);\\r\\n        this.gameMenuButtons = GameMenuConstants_1.BrowserMenuButtons;\\r\\n        // @ts-ignore\\r\\n        window.w = this.userScriptApi;\\r\\n        // @ts-ignore\\r\\n        window.Wonder = window.w;\\r\\n        Stores_1.STORE.state = null;\\r\\n        Stores_1.STORE.user = null;\\r\\n        Stores_1.STORY_STORE.story = null;\\r\\n        EventBus_1.EventBus.getInstance()\\r\\n            .sub(\"onPassagePrepared\" /* onPassagePrepared */, function (message, passage) { return _this.onPassagePrepared(passage); })\\r\\n            .sub(\"onLinkClick\" /* onLinkClick */, function (message, id) { return _this.onClick(id); })\\r\\n            .sub(\"onBackClick\" /* onBackClick */, function (message) { return _this.onBackClick(); })\\r\\n            .sub(\"onButtonClick\" /* onButtonClick */, function (message, dataset) { return _this.onButtonClick(dataset); });\\r\\n    }\\r\\n    GameLogic.prototype.start = function (name) {\\r\\n        var _this = this;\\r\\n        this.showPreloader()\\r\\n            .then(function (preloadPassage) { return _this.startParsing(preloadPassage); })\\r\\n            .then(function (story) { return _this.onStoryLoad(story); })\\r\\n            .then(function () { return _this.preloadUserState(); })\\r\\n            .then(function (userState) { return _this.initUserState(userState); })\\r\\n            .then(function () { return _this.preloadGameState(); })\\r\\n            .then(function (gameState) { return _this.initGameState(gameState); })\\r\\n            .then(function () { return _this.showStartScreen(); });\\r\\n    };\\r\\n    GameLogic.prototype.showPreloader = function () {\\r\\n        var _this = this;\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'preloading...\\');\\r\\n            _this.isUserSaveDisabledFlag = true;\\r\\n            var preloadViewData = new GameEvents_1.PreloadPageViewData();\\r\\n            _this.screenType = \"preload\" /* preload */;\\r\\n            _this.onScreenPrepareCallback = resolve;\\r\\n            _this.startPage(preloadViewData);\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.startParsing = function (preloadPassage) {\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'startParsing...\\', preloadPassage);\\r\\n            var story = TwineParser_1.parseTwineData();\\r\\n            resolve(story);\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.onStoryLoad = function (story) {\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'onStoryLoad...\\', story);\\r\\n            Stores_1.STORY_STORE.story = story;\\r\\n            resolve();\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.preloadUserState = function () {\\r\\n        var _this = this;\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'preloadUserState...\\');\\r\\n            Stores_1.STORE.user = new AppState_1.UserState(); // создаем пустую юзердату\\r\\n            _this.execStoryScript(); // исп\\r\\n            _this.stateRepo.load(_this.getUserDataSaveName(), function (data) { return resolve(data); }, function (e) {\\r\\n                console.warn(\\'preloadUserState error \\' + e);\\r\\n                resolve(null);\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.initUserState = function (state) {\\r\\n        var _this = this;\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'initUserState...\\', state);\\r\\n            if (state != null) {\\r\\n                Stores_1.STORE.user = __assign(__assign({}, Stores_1.STORE.user), state);\\r\\n            }\\r\\n            console.log(\\'initUserState...  STORE.user\\', Stores_1.STORE.user);\\r\\n            _this.collections.onUserStateReady();\\r\\n            resolve();\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.preloadGameState = function () {\\r\\n        var _this = this;\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            console.log(\\'preloadGameState...\\');\\r\\n            _this.stateRepo.load(_this.getGameAutoSaveName(), function (state) { return resolve(state); }, function (message) {\\r\\n                console.warn(\\'preloadGameState error\\' + message);\\r\\n                resolve(null);\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.initGameState = function (state) {\\r\\n        var _this = this;\\r\\n        return new Promise(function (resolve, reject) {\\r\\n            var hasSave = state != null;\\r\\n            Stores_1.RUNTIME_STORE.hasSave = hasSave;\\r\\n            _this.startScreen.onGameStateLoaded(hasSave);\\r\\n            Stores_1.STORE.state = new AppState_1.AppState();\\r\\n            Stores_1.STORE.state.gameVars = JSON.parse(JSON.stringify(_this.defaultGameVars));\\r\\n            resolve();\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.updateGameState = function (state) {\\r\\n        if (state == null)\\r\\n            return;\\r\\n        Stores_1.STORE.state = state;\\r\\n        this.collections.onStateUpdate();\\r\\n    };\\r\\n    GameLogic.prototype.onGameStateLoad = function (state) {\\r\\n        console.log(\\'onGameStateLoad...\\', state);\\r\\n        this.updateGameState(state);\\r\\n        this.startTwineGame();\\r\\n    };\\r\\n    GameLogic.prototype.execStoryScript = function () {\\r\\n        this.preprocessor.beforeInitUserScript();\\r\\n        this.collections.beforeInitUserScript();\\r\\n        this.exeScript(Stores_1.STORY_STORE.story.script, this.defaultGameVars);\\r\\n        this.execUserScriptCommands();\\r\\n    };\\r\\n    /***********************\\r\\n     * Show Start Screen\\r\\n     ***********************/\\r\\n    GameLogic.prototype.showStartScreen = function () {\\r\\n        var _this = this;\\r\\n        console.log(\\'start screen..........\\');\\r\\n        this.screenType = \"startScreen\" /* startScreen */;\\r\\n        this.startPage({\\r\\n            passage: this.startScreen.getPassage(),\\r\\n            canGoBack: false,\\r\\n            config: this.gameConfig,\\r\\n            gameVars: Stores_1.STORE.state.gameVars,\\r\\n            visitedPagesMap: {},\\r\\n            pagesMap: {}\\r\\n        });\\r\\n        setTimeout(function () {\\r\\n            _this.gameMenu.setup({\\r\\n                windowOptions: _this.getMenuOptions()\\r\\n            });\\r\\n        }, LogicConstants_1.GameMenuButtonDelay);\\r\\n    };\\r\\n    /***********************\\r\\n     * Start Twine Game\\r\\n     ***********************/\\r\\n    GameLogic.prototype.getStartPage = function (story, state) {\\r\\n        var hPages = state.history.pages;\\r\\n        var lastPage = hPages[hPages.length - 1];\\r\\n        return lastPage != null ? lastPage : story.startPassageName;\\r\\n    };\\r\\n    GameLogic.prototype.startTwineGame = function (name) {\\r\\n        this.screenType = \"game\" /* game */;\\r\\n        var startName = name != null ? name : this.getStartPage(Stores_1.STORY_STORE.story, Stores_1.STORE.state);\\r\\n        this.isUserSaveDisabledFlag = false;\\r\\n        this.onClick(startName);\\r\\n    };\\r\\n    GameLogic.prototype.startPage = function (pageViewData) {\\r\\n        EventBus_1.EventBus.emit(\"preparePassage\" /* preparePassage */, pageViewData);\\r\\n    };\\r\\n    /******************************\\r\\n     *  Страница готова к показу\\r\\n     ****************************/\\r\\n    GameLogic.prototype.onPassagePrepared = function (passage) {\\r\\n        console.log(\".................................... \" + passage.name + \" ...prepared\");\\r\\n        var SCREEN = this.screenType;\\r\\n        switch (SCREEN) {\\r\\n            case \"preload\" /* preload */:\\r\\n                this.onScreenPrepareCallback(passage);\\r\\n                break;\\r\\n            case \"startScreen\" /* startScreen */:\\r\\n                //\\r\\n                break;\\r\\n            case \"game\" /* game */:\\r\\n                this.onGameScreenPrepareCallback(passage);\\r\\n                break;\\r\\n            default:\\r\\n                console.warn(\\'unknown screenType \\' + SCREEN);\\r\\n        }\\r\\n        EventBus_1.EventBus.emit(\"showPassage\" /* showPassage */, passage);\\r\\n    };\\r\\n    GameLogic.prototype.onGameScreenPrepareCallback = function (passage) {\\r\\n        this.autoSave(); // обязательно тут, чтобы проверять флаги лоадинга и сейва\\r\\n        this.audioPlayer.musicCheck(passage.name);\\r\\n    };\\r\\n    /******************************\\r\\n     *  Реакция на клик пользователя\\r\\n     ****************************/\\r\\n    GameLogic.prototype.onClick = function (name) {\\r\\n        console.log(\\'onClick\\', name);\\r\\n        // копия для иммутабельности\\r\\n        var passage = JSON.parse(JSON.stringify(Stores_1.STORY_STORE.story.passageHash[name]));\\r\\n        this.collections.onPassage(passage);\\r\\n        this.history.add(name); // текущий узел идёт в историю\\r\\n        this.preprocessor.exec(passage);\\r\\n        // тут могут быть вызваны команды\\r\\n        // - load\\r\\n        // - restart\\r\\n        var viewData = this.execPassage(passage);\\r\\n        this.startPage(viewData);\\r\\n    };\\r\\n    GameLogic.prototype.onBackClick = function () {\\r\\n        this.history.pop(); // текущий узел уходит из истории\\r\\n        var name = this.history.getLast();\\r\\n        this.onClick(name);\\r\\n    };\\r\\n    GameLogic.prototype.onButtonClick = function (dataset) {\\r\\n        console.log(\\'onButtonClick \\', dataset);\\r\\n        var COMMAND = dataset.command;\\r\\n        if (COMMAND == \"newGame\" /* newGame */) {\\r\\n            this.startTwineGame();\\r\\n            return;\\r\\n        }\\r\\n        if (COMMAND == \"continue\" /* continue */) {\\r\\n            this.loadGameState(this.getGameAutoSaveName());\\r\\n            return;\\r\\n        }\\r\\n        if (COMMAND == \"restart\" /* restart */) {\\r\\n            this.restartAsync(dataset.name, dataset.delay);\\r\\n            return;\\r\\n        }\\r\\n    };\\r\\n    /*********\\r\\n     * helpers\\r\\n     *********/\\r\\n    // выполнить скрипт, забинденный на game\\r\\n    GameLogic.prototype.exeScript = function (script, context) {\\r\\n        var result = null;\\r\\n        try {\\r\\n            var func = new Function(script).bind(context); // создаю функцию из строки\\r\\n            result = func(); // исполняю функцию\\r\\n        }\\r\\n        catch (e) {\\r\\n            console.warn(\\' Wonder - UserScript error:\\' + e);\\r\\n        }\\r\\n        return result;\\r\\n    };\\r\\n    /**\\r\\n     * Формирует viewPassage для отображения\\r\\n     * + исполняет логику\\r\\n     * @param name\\r\\n     */\\r\\n    GameLogic.prototype.execPassage = function (passage) {\\r\\n        this.execScripts(passage);\\r\\n        this.execUserScriptCommands();\\r\\n        return new GameEvents_1.PageViewData(passage, Stores_1.STORE.state.gameVars, this.gameConfig, this.history.canGoBack(passage.name), Stores_1.STORE.state.history.pagesHash, Stores_1.STORY_STORE.story.passageHash);\\r\\n    };\\r\\n    /**\\r\\n     * Исполнить скрипты и вывести их результат, если нужно\\r\\n     * @param viewPassage\\r\\n     */\\r\\n    GameLogic.prototype.execScripts = function (viewPassage) {\\r\\n        var _this = this;\\r\\n        console.log(viewPassage.name + \" execScripts........\");\\r\\n        var context = Stores_1.STORE.state.gameVars;\\r\\n        this.clearRunTimeTextBuffer(); // очищаем буффер рантаймовых текстов\\r\\n        // ищем строки, которые должны исполняться\\r\\n        viewPassage.content = viewPassage.content\\r\\n            .replace(Constants_1.REGEXP.exeScript, function (match, catched) {\\r\\n            var command = catched.trim();\\r\\n            var isInline = command[0] == Constants_1.WONDER.inlineStart;\\r\\n            if (isInline)\\r\\n                command = \"return \" + command.substring(1);\\r\\n            var result = _this.exeScript(command, context);\\r\\n            var textBuffer = _this.getRunTimeTextsFromBuffer();\\r\\n            var render = isInline ? result : textBuffer;\\r\\n            return render;\\r\\n        });\\r\\n        console.log(\"....... /execScripts\");\\r\\n    };\\r\\n    /********************\\r\\n     *  STATE MANAGEMENT\\r\\n     *******************/\\r\\n    /********\\r\\n     *  inline texts\\r\\n     *********/\\r\\n    GameLogic.prototype.getRunTimeTextsFromBuffer = function () {\\r\\n        var textBuffer = Stores_1.RUNTIME_STORE.textBuffer;\\r\\n        var texts = \\'\\';\\r\\n        while (textBuffer.length > 0) {\\r\\n            texts += textBuffer.shift();\\r\\n        }\\r\\n        return texts;\\r\\n    };\\r\\n    GameLogic.prototype.clearRunTimeTextBuffer = function () {\\r\\n        Stores_1.RUNTIME_STORE.textBuffer = [];\\r\\n    };\\r\\n    /**************************\\r\\n     *  userScriptApi commands\\r\\n     *********************/\\r\\n    GameLogic.prototype.execUserScriptCommands = function () {\\r\\n        console.log(\\'execUserScriptCommands...\\');\\r\\n        var commands = Stores_1.RUNTIME_STORE.commands;\\r\\n        while (commands.length > 0) {\\r\\n            this.execSingleUserCommand(commands.shift());\\r\\n        }\\r\\n    };\\r\\n    GameLogic.prototype.execSingleUserCommand = function (command) {\\r\\n        console.log(\\'...command\\', command.name);\\r\\n        switch (command.name) {\\r\\n            case \"enableExternalApi\" /* enableExternalApi */:\\r\\n                this.isDesktop = command.data == true;\\r\\n                this.stateRepo.enableExternalApi(command.data);\\r\\n                break;\\r\\n            case \"saveSlot\" /* saveSlot */:\\r\\n                var saveName = command.data != null ? command.data : \\'_default\\';\\r\\n                this.saveName(saveName);\\r\\n                break;\\r\\n            case \"save\" /* save */:\\r\\n                if (this.isUserSaveDisabled())\\r\\n                    return;\\r\\n                else\\r\\n                    this.saveGameState(command.data);\\r\\n                break;\\r\\n            case \"load\" /* load */:\\r\\n                // todo make button\\r\\n                /*if (this.isStatePreloading()) return;\\r\\n                else {\\r\\n                    this.isLoading = true;\\r\\n                    this.loadGameState();\\r\\n                }*/\\r\\n                break;\\r\\n            case \"collectionRule\" /* collectionRule */:\\r\\n                this.collections.addRule(command.data);\\r\\n                break;\\r\\n            case \"music\" /* music */:\\r\\n                this.audioPlayer.music(command.data.url, command.data.volume);\\r\\n                break;\\r\\n            case \"musicFor\" /* musicFor */:\\r\\n                this.audioPlayer.musicFor(command.data.hashName, command.data.url, command.data.volume);\\r\\n                break;\\r\\n            case \"sound\" /* sound */:\\r\\n                this.audioPlayer.sound(command.data.url, command.data.volume);\\r\\n                break;\\r\\n            case \"musicStop\" /* musicStop */:\\r\\n                this.audioPlayer.stop();\\r\\n                break;\\r\\n            case \"start\" /* start */:\\r\\n                this.restartAsync(command.data.name, command.data.delay);\\r\\n                break;\\r\\n            case \"pageAdd\" /* pageAdd */:\\r\\n                this.preprocessor.addRule({\\r\\n                    tag: command.data.tag,\\r\\n                    text: command.data.text,\\r\\n                    text2: \\'\\',\\r\\n                    position: \"end\" /* end */\\r\\n                });\\r\\n                break;\\r\\n            case \"pageBefore\" /* pageBefore */:\\r\\n                this.preprocessor.addRule({\\r\\n                    tag: command.data.tag,\\r\\n                    text: command.data.text,\\r\\n                    text2: \\'\\',\\r\\n                    position: \"start\" /* start */\\r\\n                });\\r\\n                break;\\r\\n            case \"pageWrap\" /* pageWrap */:\\r\\n                this.preprocessor.addRule({\\r\\n                    tag: command.data.tag,\\r\\n                    text: command.data.text,\\r\\n                    text2: command.data.text2,\\r\\n                    position: \"around\" /* around */\\r\\n                });\\r\\n                break;\\r\\n            case \"startPage\" /* startPage */:\\r\\n                this.startScreen.userOptions(command.data);\\r\\n                break;\\r\\n            default:\\r\\n                console.warn(\\'unhandled userScriptApi command:: \\', command.name, command.data);\\r\\n        }\\r\\n    };\\r\\n    GameLogic.prototype.isUserSaveDisabled = function () {\\r\\n        return this.isUserSaveDisabledFlag;\\r\\n    };\\r\\n    /**************************\\r\\n     *  save/load functions\\r\\n     *********************/\\r\\n    GameLogic.prototype.saveName = function (saveName) {\\r\\n        if (saveName != null)\\r\\n            this.gameSaveName = saveName;\\r\\n        console.log(\\'saveName \\' + saveName);\\r\\n    };\\r\\n    GameLogic.prototype.saveGameState = function (saveName) {\\r\\n        if (saveName == null)\\r\\n            saveName = this.getGameSaveName();\\r\\n        this.stateRepo.save(saveName, Stores_1.STORE.state, messageHandler, messageHandler);\\r\\n    };\\r\\n    GameLogic.prototype.saveUserState = function () {\\r\\n        console.log(\\'--------- saveUserState on\\', this.history.getLast());\\r\\n        this.stateRepo.save(this.getUserDataSaveName(), Stores_1.STORE.user, messageHandler, messageHandler);\\r\\n    };\\r\\n    GameLogic.prototype.loadGameState = function (saveName) {\\r\\n        var _this = this;\\r\\n        this.isLoading = true;\\r\\n        this.stateRepo.load(saveName, function (state) {\\r\\n            _this.isLoading = false;\\r\\n            _this.onGameStateLoad(state);\\r\\n        }, function (e) {\\r\\n            _this.isLoading = false;\\r\\n            console.warn(\\'loadGameState error ::\\' + e);\\r\\n        });\\r\\n    };\\r\\n    GameLogic.prototype.getGameName = function () {\\r\\n        return Stores_1.STORY_STORE.story.name;\\r\\n    };\\r\\n    GameLogic.prototype.getGameSaveName = function () {\\r\\n        return LogicConstants_1.SavePrefixGame + this.getGameName() + \\'-\\' + this.gameSaveName;\\r\\n    };\\r\\n    GameLogic.prototype.getGameAutoSaveName = function () {\\r\\n        return LogicConstants_1.SavePrefixGameAuto + this.getGameName() + \\'-\\' + LogicConstants_1.SaveNameAuto;\\r\\n    };\\r\\n    GameLogic.prototype.getUserDataSaveName = function () {\\r\\n        return LogicConstants_1.SavePrefixUser + this.getGameName() + \\'-\\' + LogicConstants_1.SaveNameDefault;\\r\\n    };\\r\\n    GameLogic.prototype.autoSave = function () {\\r\\n        if (this.isLoading)\\r\\n            return;\\r\\n        console.log(\\'auto saving.......\\', this.history.getLast(), Stores_1.STORE.state, Stores_1.STORE.user);\\r\\n        var autoSaveName = this.getGameAutoSaveName();\\r\\n        this.saveGameState(autoSaveName);\\r\\n        this.saveUserState();\\r\\n    };\\r\\n    /**************************\\r\\n     *  restart\\r\\n     *********************/\\r\\n    GameLogic.prototype.restartAsync = function (name, delay) {\\r\\n        var _this = this;\\r\\n        var DELAY = delay != null ? parseInt(delay) : 0;\\r\\n        setTimeout(function () { return _this.restart(name); }, DELAY);\\r\\n    };\\r\\n    GameLogic.prototype.restart = function (name) {\\r\\n        Stores_1.STORE.state.gameVars = JSON.parse(JSON.stringify(this.defaultGameVars));\\r\\n        Stores_1.STORE.state.history.pages = [];\\r\\n        Stores_1.STORE.state.history.pagesHash = {};\\r\\n        this.startTwineGame(name);\\r\\n    };\\r\\n    /**************************\\r\\n     *  GameMenu\\r\\n     *********************/\\r\\n    GameLogic.prototype.getMenuOptions = function () {\\r\\n        if (this.isDesktop)\\r\\n            return this.getDesktopMenuOptions();\\r\\n        else\\r\\n            return this.getBrowserMenuOptions();\\r\\n    };\\r\\n    GameLogic.prototype.getMenuCommonOptions = function () {\\r\\n        return {\\r\\n            addClass: \\'game-menu-window\\',\\r\\n            title: \"\\\\u041C\\\\u0435\\\\u043D\\\\u044E \\\\u0438\\\\u0433\\\\u0440\\\\u044B\" /* settingsTitle */\\r\\n        };\\r\\n    };\\r\\n    GameLogic.prototype.getBrowserMenuOptions = function () {\\r\\n        var _this = this;\\r\\n        return __assign(__assign({}, this.getMenuCommonOptions()), { buttons: [\\r\\n                {\\r\\n                    text: \"\\\\u041F\\\\u0440\\\\u043E\\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u0438\\\\u0442\\\\u044C \\\\u0438\\\\u0433\\\\u0440\\\\u0443\" /* settingsContinue */,\\r\\n                    callback: function () {\\r\\n                        console.log(\"click \" + \"\\\\u041F\\\\u0440\\\\u043E\\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u0438\\\\u0442\\\\u044C \\\\u0438\\\\u0433\\\\u0440\\\\u0443\" /* settingsContinue */);\\r\\n                    },\\r\\n                },\\r\\n                {\\r\\n                    text: \"\\\\u041D\\\\u0430\\\\u0447\\\\u0430\\\\u0442\\\\u044C \\\\u0438\\\\u0433\\\\u0440\\\\u0443 \\\\u0437\\\\u0430\\\\u043D\\\\u043E\\\\u0432\\\\u043E\" /* settingsRestart */,\\r\\n                    callback: function () {\\r\\n                        console.log(\"click \" + \"\\\\u041D\\\\u0430\\\\u0447\\\\u0430\\\\u0442\\\\u044C \\\\u0438\\\\u0433\\\\u0440\\\\u0443 \\\\u0437\\\\u0430\\\\u043D\\\\u043E\\\\u0432\\\\u043E\" /* settingsRestart */);\\r\\n                        _this.restartAsync(null, \\'\\' + 0);\\r\\n                    },\\r\\n                    warning: \"\\\\u0412\\\\u044B \\\\u0443\\\\u0432\\\\u0435\\\\u0440\\\\u0435\\\\u043D\\\\u044B?\" /* settingsRestartWarning */\\r\\n                }\\r\\n            ] });\\r\\n    };\\r\\n    GameLogic.prototype.getDesktopMenuOptions = function () {\\r\\n        var _this = this;\\r\\n        var options = this.getBrowserMenuOptions();\\r\\n        var desktopButtons = [\\r\\n            {\\r\\n                text: \"\\\\u0412\\\\u043E \\\\u0432\\\\u0435\\\\u0441\\\\u044C \\\\u044D\\\\u043A\\\\u0440\\\\u0430\\\\u043D / \\\\u043E\\\\u043A\\\\u043D\\\\u043E\" /* settingsFullScreen */,\\r\\n                callback: function () {\\r\\n                    console.log(\"click \" + \"\\\\u0412\\\\u043E \\\\u0432\\\\u0435\\\\u0441\\\\u044C \\\\u044D\\\\u043A\\\\u0440\\\\u0430\\\\u043D / \\\\u043E\\\\u043A\\\\u043D\\\\u043E\" /* settingsFullScreen */);\\r\\n                    _this.postMessageApi.send(\"fullScreen\" /* fullScreen */, null);\\r\\n                }\\r\\n            },\\r\\n            {\\r\\n                text: \"\\\\u0412\\\\u044B\\\\u0439\\\\u0442\\\\u0438\" /* settingsExit */,\\r\\n                callback: function () {\\r\\n                    console.log(\"click \" + \"\\\\u0412\\\\u044B\\\\u0439\\\\u0442\\\\u0438\" /* settingsExit */);\\r\\n                    _this.postMessageApi.send(\"close\" /* close */, null);\\r\\n                },\\r\\n                warning: \"\\\\u0412\\\\u044B \\\\u0443\\\\u0432\\\\u0435\\\\u0440\\\\u0435\\\\u043D\\\\u044B?\" /* settingsExitWarning */\\r\\n            }\\r\\n        ];\\r\\n        options.buttons = __spreadArrays(options.buttons, desktopButtons);\\r\\n        return options;\\r\\n    };\\r\\n    GameLogic.prototype.handleGameMenuButton = function (dataset) {\\r\\n        if (dataset.command == \"restart\" /* restart */) {\\r\\n            // todo dialog\\r\\n            this.restartAsync(dataset.name, dataset.delay);\\r\\n            return;\\r\\n        }\\r\\n        if (dataset.command == \"newGame\" /* newGame */) {\\r\\n            // todo dialog\\r\\n            this.restartAsync(dataset.name, \\'0\\');\\r\\n            return;\\r\\n        }\\r\\n        if (dataset.command == \"fullScreen\" /* fullScreen */) {\\r\\n            // todo dialog\\r\\n            this.postMessageApi.send(\"fullScreen\" /* fullScreen */);\\r\\n            return;\\r\\n        }\\r\\n        if (dataset.command == \"close\" /* close */) {\\r\\n            // todo dialog\\r\\n            this.postMessageApi.send(\"close\" /* close */);\\r\\n            return;\\r\\n        }\\r\\n    };\\r\\n    return GameLogic;\\r\\n}());\\r\\nexports.GameLogic = GameLogic;\\r\\nfunction messageHandler(message) {\\r\\n    console.log(message);\\r\\n}\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/GameLogic.ts?')},\"./wonder-format/ts/twine-game/GameView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar EventBus_1 = __webpack_require__(/*! ../app-core/EventBus */ \"./wonder-format/ts/app-core/EventBus.ts\");\\r\\nvar Constants_1 = __webpack_require__(/*! ../Constants */ \"./wonder-format/ts/Constants.ts\");\\r\\nvar WonderPageView_1 = __webpack_require__(/*! ./view/WonderPageView */ \"./wonder-format/ts/twine-game/view/WonderPageView.ts\");\\r\\nvar DomUtils_1 = __webpack_require__(/*! ../app-core/DomUtils */ \"./wonder-format/ts/app-core/DomUtils.ts\");\\r\\nvar GameView = /** @class */ (function () {\\r\\n    function GameView(storyStyle) {\\r\\n        var _this = this;\\r\\n        this.injectStyle(Constants_1.DEFAULT_STYLE);\\r\\n        this.injectStyle(storyStyle);\\r\\n        this.el = document.createElement(\"div\");\\r\\n        this.el.id = Constants_1.WONDER.contentId;\\r\\n        document.body.appendChild(this.el);\\r\\n        this.el.addEventListener(\"click\", this);\\r\\n        this.pageView = new WonderPageView_1.WonderPageView(this.el);\\r\\n        EventBus_1.EventBus.getInstance()\\r\\n            .sub(\"onStoryLoaded\" /* onStoryLoaded */, function (message, data) { return _this.onStoryLoad(data); })\\r\\n            .sub(\"preparePassage\" /* preparePassage */, function (message, data) { return _this.preparePassage(data); })\\r\\n            .sub(\"showPassage\" /* showPassage */, function (message, data) { return _this.showPassage(data); });\\r\\n    }\\r\\n    GameView.prototype.injectStyle = function (style) {\\r\\n        if (style.length == 0)\\r\\n            return;\\r\\n        var styleElement = document.createElement(\\'style\\');\\r\\n        styleElement.innerHTML = style;\\r\\n        document.getElementsByTagName(\\'head\\')[0].appendChild(styleElement);\\r\\n    };\\r\\n    /**********************\\r\\n     *  user event listeners\\r\\n     *********************/\\r\\n    GameView.prototype.handleEvent = function (e) {\\r\\n        if (this.checkLinkClick(e))\\r\\n            return;\\r\\n        if (this.checkBackClick(e))\\r\\n            return;\\r\\n        if (this.checkButtonClick(e))\\r\\n            return;\\r\\n    };\\r\\n    GameView.prototype.checkClick = function (e, selector, callback) {\\r\\n        var linkElement = DomUtils_1.DomUtils.closest(e.target, selector);\\r\\n        // нашли элемент?\\r\\n        var hasElement = linkElement != null;\\r\\n        if (!hasElement)\\r\\n            return false;\\r\\n        // защита от двойных кликов\\r\\n        var notPressedYet = !linkElement.classList.contains(Constants_1.WONDER.pressedClass);\\r\\n        if (notPressedYet) {\\r\\n            linkElement.classList.add(Constants_1.WONDER.pressedClass);\\r\\n            callback(linkElement, e);\\r\\n        }\\r\\n        return notPressedYet;\\r\\n    };\\r\\n    GameView.prototype.checkLinkClick = function (e) {\\r\\n        return this.checkClick(e, \".\" + Constants_1.WONDER.linkClass, function (el, e1) {\\r\\n            var id = el.dataset[\"id\"];\\r\\n            EventBus_1.EventBus.emit(\"onLinkClick\" /* onLinkClick */, id);\\r\\n        });\\r\\n    };\\r\\n    GameView.prototype.checkBackClick = function (e) {\\r\\n        return this.checkClick(e, \".\" + Constants_1.WONDER.backClass, function (el, e1) {\\r\\n            EventBus_1.EventBus.emit(\"onBackClick\" /* onBackClick */, null);\\r\\n        });\\r\\n    };\\r\\n    GameView.prototype.checkButtonClick = function (e) {\\r\\n        return this.checkClick(e, \".\" + Constants_1.WONDER.buttonClass, function (el, e1) {\\r\\n            var data = JSON.parse(JSON.stringify(el.dataset));\\r\\n            EventBus_1.EventBus.emit(\"onButtonClick\" /* onButtonClick */, data);\\r\\n        });\\r\\n    };\\r\\n    /**********************\\r\\n     *   events\\r\\n     *********************/\\r\\n    GameView.prototype.onStoryLoad = function (story) {\\r\\n    };\\r\\n    GameView.prototype.preparePassage = function (pageViewData) {\\r\\n        var passage = pageViewData.passage;\\r\\n        var page = this.pageView.addNextPage(passage);\\r\\n        this.setBody(passage);\\r\\n        this.markVisitedLinks(page, pageViewData.visitedPagesMap, pageViewData.pagesMap);\\r\\n        this.showBackLink(page, pageViewData.canGoBack, passage);\\r\\n        // страница добавлена, но еще не видима, можно менять DOM\\r\\n        this.injectParams(page, pageViewData.config.uiParams, pageViewData.gameVars);\\r\\n        EventBus_1.EventBus.emit(\"onPassagePrepared\" /* onPassagePrepared */, passage);\\r\\n    };\\r\\n    GameView.prototype.setBody = function (passage) {\\r\\n        document.body.id = passage.name;\\r\\n        document.body.className = passage.tags;\\r\\n    };\\r\\n    GameView.prototype.showPassage = function (passage) {\\r\\n        this.pageView.showNextPage();\\r\\n    };\\r\\n    GameView.prototype.injectParams = function (page, uiParams, state) {\\r\\n        uiParams.forEach(function (uP) {\\r\\n            var paramName = uP.name;\\r\\n            var paramValue = state[uP.name];\\r\\n            var el = page.querySelector(uP.name);\\r\\n            if (el) {\\r\\n                el.innerHTML = paramName + \":\" + paramValue;\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    GameView.prototype.markVisitedLinks = function (page, visited, passageMap) {\\r\\n        var links = page.querySelectorAll(\".\" + Constants_1.WONDER.linkClass);\\r\\n        var next, nextLinkName;\\r\\n        for (var i = 0; i < links.length; i++) {\\r\\n            next = links[i];\\r\\n            nextLinkName = next.dataset[\"id\"];\\r\\n            if (visited[nextLinkName]) {\\r\\n                next.classList.add(Constants_1.WONDER.visitedClass);\\r\\n            }\\r\\n            // теги пассажей\\r\\n            var linkPassage = passageMap[nextLinkName];\\r\\n            if (linkPassage && linkPassage.tags) {\\r\\n                next.className = next.className + \\' \\' + linkPassage.tags;\\r\\n            }\\r\\n        }\\r\\n    };\\r\\n    GameView.prototype.showBackLink = function (page, canGoBack, passage) {\\r\\n        var backButton = page.querySelector(\".\" + Constants_1.WONDER.backClass);\\r\\n        if (backButton == null)\\r\\n            return;\\r\\n        if (canGoBack)\\r\\n            backButton.classList.remove(Constants_1.WONDER.invisibleClass);\\r\\n        else\\r\\n            backButton.classList.add(Constants_1.WONDER.invisibleClass);\\r\\n    };\\r\\n    return GameView;\\r\\n}());\\r\\nexports.GameView = GameView;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/GameView.ts?')},\"./wonder-format/ts/twine-game/Stores.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar StoryStore = /** @class */ (function () {\\r\\n    function StoryStore() {\\r\\n    }\\r\\n    return StoryStore;\\r\\n}());\\r\\nexports.STORY_STORE = new StoryStore();\\r\\nvar AppStore = /** @class */ (function () {\\r\\n    function AppStore() {\\r\\n    }\\r\\n    return AppStore;\\r\\n}());\\r\\nexports.STORE = new AppStore();\\r\\nvar RunTimeStore = /** @class */ (function () {\\r\\n    function RunTimeStore() {\\r\\n        this.hasSave = false;\\r\\n        this.textBuffer = [];\\r\\n        this.commands = [];\\r\\n    }\\r\\n    return RunTimeStore;\\r\\n}());\\r\\nexports.RUNTIME_STORE = new RunTimeStore();\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/Stores.ts?')},\"./wonder-format/ts/twine-game/logic/AudioPlayer.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\n/*************\\r\\n *  Audio\\r\\n ***********/\\r\\nvar AudioPlayer = /** @class */ (function () {\\r\\n    function AudioPlayer() {\\r\\n        this.musicHash = {};\\r\\n        this.audioElement = new Audio();\\r\\n    }\\r\\n    AudioPlayer.prototype.music = function (url, volume) {\\r\\n        this.audioElement.loop = true;\\r\\n        this.play(url, volume);\\r\\n    };\\r\\n    AudioPlayer.prototype.sound = function (url, volume) {\\r\\n        this.audioElement.loop = false;\\r\\n        this.play(url, volume);\\r\\n    };\\r\\n    AudioPlayer.prototype.musicFor = function (hashName, url, volume) {\\r\\n        this.musicHash[hashName] = { url: url, volume: volume };\\r\\n    };\\r\\n    AudioPlayer.prototype.musicCheck = function (hashName) {\\r\\n        var sound = this.musicHash[hashName];\\r\\n        if (sound == null)\\r\\n            return;\\r\\n        this.music(sound.url, sound.volume);\\r\\n    };\\r\\n    AudioPlayer.prototype.play = function (url, volume) {\\r\\n        var soundUrl = url.trim();\\r\\n        this.lastUrl = soundUrl;\\r\\n        this.audioElement.src = this.lastUrl;\\r\\n        this.audioElement.volume = volume;\\r\\n        if (!this.audioElement.paused && soundUrl == this.lastUrl)\\r\\n            return;\\r\\n        this.audioElement.play().then(function (value) { return console.log('play Then', value); });\\r\\n    };\\r\\n    AudioPlayer.prototype.stop = function () {\\r\\n        this.audioElement.pause();\\r\\n    };\\r\\n    return AudioPlayer;\\r\\n}());\\r\\nexports.AudioPlayer = AudioPlayer;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/AudioPlayer.ts?\")},\"./wonder-format/ts/twine-game/logic/GameConfig.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar GameState = /** @class */ (function () {\\r\\n    function GameState() {\\r\\n    }\\r\\n    return GameState;\\r\\n}());\\r\\nexports.GameState = GameState;\\r\\nvar GameConfig = /** @class */ (function () {\\r\\n    function GameConfig() {\\r\\n        this.uiParams = [];\\r\\n    }\\r\\n    return GameConfig;\\r\\n}());\\r\\nexports.GameConfig = GameConfig;\\r\\nvar VisibleParameter = /** @class */ (function () {\\r\\n    function VisibleParameter(name, // имя переменной - оно же id переменной\\r\\n    label // что видит пользовател\\r\\n    ) {\\r\\n        this.name = name;\\r\\n        this.label = label;\\r\\n    }\\r\\n    return VisibleParameter;\\r\\n}());\\r\\nexports.VisibleParameter = VisibleParameter;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/GameConfig.ts?')},\"./wonder-format/ts/twine-game/logic/LogicConstants.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nexports.SavePrefixGame = 'w-game-custom-';\\r\\nexports.SavePrefixGameAuto = 'w-game-auto-';\\r\\nexports.SavePrefixUser = 'w-user-';\\r\\nexports.SaveNameDefault = 'data';\\r\\nexports.SaveNameAuto = 'save';\\r\\nexports.GameMenuButtonDelay = 2500;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/LogicConstants.ts?\")},\"./wonder-format/ts/twine-game/logic/PostMessageApi.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar PostMessageApi = /** @class */ (function () {\\r\\n    function PostMessageApi(parent, targetOrigin) {\\r\\n        var _this = this;\\r\\n        if (parent === void 0) { parent = null; }\\r\\n        if (targetOrigin === void 0) { targetOrigin = \\\"*\\\"; }\\r\\n        this.listenerMap = {};\\r\\n        this.parent = parent;\\r\\n        if (this.parent == null) {\\r\\n            this.parent = window.parent;\\r\\n        }\\r\\n        this.targetOrigin = targetOrigin;\\r\\n        window.addEventListener('message', function (e) { return _this.onMessage(e); });\\r\\n    }\\r\\n    PostMessageApi.prototype.send = function (messageName, data) {\\r\\n        var postMessage = {\\r\\n            name: messageName,\\r\\n            data: data\\r\\n        };\\r\\n        if (this.parent) {\\r\\n            this.parent.postMessage(postMessage, this.targetOrigin);\\r\\n        }\\r\\n        else {\\r\\n            console.warn('PostMessageAPI.send:  no window parent');\\r\\n        }\\r\\n    };\\r\\n    PostMessageApi.prototype.on = function (messageName, listener) {\\r\\n        if (this.listenerMap[messageName] == null) {\\r\\n            this.listenerMap[messageName] = [];\\r\\n        }\\r\\n        this.listenerMap[messageName].push(listener);\\r\\n    };\\r\\n    PostMessageApi.prototype.onMessage = function (e) {\\r\\n        var postMessage = e.data;\\r\\n        if (postMessage.name == undefined)\\r\\n            return;\\r\\n        var listeners = this.listenerMap[postMessage.name];\\r\\n        if (listeners) {\\r\\n            listeners.forEach(function (listener) { return listener(postMessage.data); });\\r\\n        }\\r\\n        else {\\r\\n            console.warn('PostMessageAPI.onMessage:  no listeners for', postMessage.name);\\r\\n            console.warn('MessageEvent: ', e);\\r\\n        }\\r\\n    };\\r\\n    return PostMessageApi;\\r\\n}());\\r\\nexports.PostMessageApi = PostMessageApi;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/PostMessageApi.ts?\")},\"./wonder-format/ts/twine-game/logic/WonderHistory.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar Stores_1 = __webpack_require__(/*! ../Stores */ \"./wonder-format/ts/twine-game/Stores.ts\");\\r\\nvar WonderHistory = /** @class */ (function () {\\r\\n    function WonderHistory() {\\r\\n    }\\r\\n    WonderHistory.prototype.getState = function () {\\r\\n        return Stores_1.STORE.state.history;\\r\\n    };\\r\\n    WonderHistory.prototype.add = function (name) {\\r\\n        if (name == null)\\r\\n            return;\\r\\n        if (this.getLast() == name)\\r\\n            return; // защита от повторов\\r\\n        this.getState().pages.push(name);\\r\\n        this.getState().pagesHash[name] = true;\\r\\n    };\\r\\n    WonderHistory.prototype.isVisited = function (name) {\\r\\n        return this.getState().pagesHash[name] == true;\\r\\n    };\\r\\n    WonderHistory.prototype.pop = function () {\\r\\n        return this.getState().pages.pop();\\r\\n    };\\r\\n    WonderHistory.prototype.canGoBack = function (name) {\\r\\n        var PAGES = this.getState().pages;\\r\\n        var hasHistory = PAGES.length > 0;\\r\\n        if (!hasHistory)\\r\\n            return false;\\r\\n        var hasSinglePage = PAGES.length == 1;\\r\\n        var hasSameFirstPage = PAGES[0] && PAGES[0] == name;\\r\\n        return !(hasSinglePage && hasSameFirstPage);\\r\\n    };\\r\\n    WonderHistory.prototype.getLast = function () {\\r\\n        var PAGES = this.getState().pages;\\r\\n        return PAGES[PAGES.length - 1];\\r\\n    };\\r\\n    return WonderHistory;\\r\\n}());\\r\\nexports.WonderHistory = WonderHistory;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/WonderHistory.ts?')},\"./wonder-format/ts/twine-game/logic/collections/Collections.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar CollectionsView_1 = __webpack_require__(/*! ./CollectionsView */ \\\"./wonder-format/ts/twine-game/logic/collections/CollectionsView.ts\\\");\\r\\nvar Stores_1 = __webpack_require__(/*! ../../Stores */ \\\"./wonder-format/ts/twine-game/Stores.ts\\\");\\r\\n/*************\\r\\n *  Collectables\\r\\n ***********/\\r\\nvar Collections = /** @class */ (function () {\\r\\n    function Collections() {\\r\\n        this.collectionsView = new CollectionsView_1.CollectionsView();\\r\\n    }\\r\\n    Collections.prototype.getUserData = function () {\\r\\n        return Stores_1.STORE.user;\\r\\n    };\\r\\n    Collections.prototype.getCollectionMap = function () {\\r\\n        return this.getUserData().collectionMap;\\r\\n    };\\r\\n    Collections.prototype.getCollection = function (name) {\\r\\n        return this.getUserData().collectionMap[name];\\r\\n    };\\r\\n    Collections.prototype.beforeInitUserScript = function () {\\r\\n        this.rulesMap = {};\\r\\n    };\\r\\n    Collections.prototype.onUserStateReady = function () {\\r\\n        var _this = this;\\r\\n        this.initCollections();\\r\\n        setTimeout(function () {\\r\\n            _this.collectionsView.createButtons(_this.getCollectionMap());\\r\\n        }, 500);\\r\\n    };\\r\\n    Collections.prototype.onStateUpdate = function () {\\r\\n        this.collectionsView.updateButtons(this.getCollectionMap());\\r\\n    };\\r\\n    // следует добавлять только в пользовательском скрипте или раньше\\r\\n    Collections.prototype.addRule = function (rule) {\\r\\n        var _this = this;\\r\\n        console.log('Collections.addRule for ', rule.tags);\\r\\n        rule.tags.forEach(function (tag) {\\r\\n            if (_this.rulesMap[tag] == null) {\\r\\n                _this.rulesMap[tag] = [];\\r\\n            }\\r\\n            _this.rulesMap[tag].push(rule);\\r\\n        });\\r\\n        this.addCollection(rule);\\r\\n    };\\r\\n    Collections.prototype.onPassage = function (passage) {\\r\\n        var _this = this;\\r\\n        var pTags = this.getTags(passage);\\r\\n        pTags.forEach(function (tag) { return _this.collectTag(tag, passage); });\\r\\n        this.onStateUpdate();\\r\\n    };\\r\\n    /**************\\r\\n     * private\\r\\n     *************/\\r\\n    Collections.prototype.collectTag = function (passageTag, passage) {\\r\\n        var _this = this;\\r\\n        var rules = this.rulesMap[passageTag];\\r\\n        if (rules == null || rules.length < 1)\\r\\n            return;\\r\\n        rules.forEach(function (rule) { return _this.collectByRule(rule, passage); });\\r\\n    };\\r\\n    Collections.prototype.collectByRule = function (rule, passage) {\\r\\n        var collection = this.getCollectionMap()[rule.collection];\\r\\n        if (collection.collected.indexOf(passage.name) < 0) {\\r\\n            collection.collected.push(passage.name);\\r\\n            this.onPassageCollected(passage, collection);\\r\\n        }\\r\\n    };\\r\\n    Collections.prototype.onPassageCollected = function (passage, collection) {\\r\\n        this.collectionsView.updateButton(collection);\\r\\n    };\\r\\n    Collections.prototype.addCollection = function (rule) {\\r\\n        if (this.getCollection(rule.collection) != null) {\\r\\n            console.warn('addCollection with same name ', rule.collection);\\r\\n            return;\\r\\n        }\\r\\n        this.getCollectionMap()[rule.collection] = {\\r\\n            name: rule.collection,\\r\\n            title: rule.title,\\r\\n            collected: [],\\r\\n            maxAmount: 0\\r\\n        };\\r\\n    };\\r\\n    Collections.prototype.initCollections = function () {\\r\\n        var _this = this;\\r\\n        var story = Stores_1.STORY_STORE.story;\\r\\n        // защита от загрузки\\r\\n        Object.keys(this.getCollectionMap()).forEach(function (cName) {\\r\\n            _this.getCollection(cName).maxAmount = 0;\\r\\n        });\\r\\n        story.passages.forEach(function (passage) {\\r\\n            var pTags = _this.getTags(passage);\\r\\n            pTags.forEach(function (tag) {\\r\\n                var rules = _this.rulesMap[tag];\\r\\n                if (rules == null)\\r\\n                    return;\\r\\n                rules.forEach(function (rule) {\\r\\n                    var collection = _this.getCollection(rule.collection);\\r\\n                    if (collection == null) {\\r\\n                        console.warn('collection==null for', rule.collection);\\r\\n                        return;\\r\\n                    }\\r\\n                    // есть rule, подходящее под tag текущего пассажа?\\r\\n                    // добавляем +1 к счетчик коллекции\\r\\n                    collection.maxAmount++;\\r\\n                });\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    Collections.prototype.getTags = function (passage) {\\r\\n        return passage.tags.split(' ');\\r\\n    };\\r\\n    return Collections;\\r\\n}());\\r\\nexports.Collections = Collections;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/collections/Collections.ts?\")},\"./wonder-format/ts/twine-game/logic/collections/CollectionsView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar SingleCollectionView_1 = __webpack_require__(/*! ./SingleCollectionView */ \\\"./wonder-format/ts/twine-game/logic/collections/SingleCollectionView.ts\\\");\\r\\nvar DomUtils_1 = __webpack_require__(/*! ../../../app-core/DomUtils */ \\\"./wonder-format/ts/app-core/DomUtils.ts\\\");\\r\\nvar Constants_1 = __webpack_require__(/*! ../../../Constants */ \\\"./wonder-format/ts/Constants.ts\\\");\\r\\nvar CollectionsView = /** @class */ (function () {\\r\\n    function CollectionsView() {\\r\\n        var _this = this;\\r\\n        this.isViewCreated = false;\\r\\n        this.viewMap = {};\\r\\n        this.buttonWrapper = document.createElement('div');\\r\\n        this.buttonWrapper.id = \\\"c-wrapper\\\" /* wrapperId */;\\r\\n        this.buttonWrapper.addEventListener('mouseup', function (event) { return _this.findButton(event); });\\r\\n        this.shadow = document.createElement('div');\\r\\n        this.shadow.id = \\\"c-shadow\\\" /* shadowId */;\\r\\n        this.shadow.style.display = 'none';\\r\\n        this.shadow.className = Constants_1.WONDER.shadowScreenClass;\\r\\n        this.shadow.addEventListener('mouseup', function (event) { return _this.closeAll(); });\\r\\n        document.body.appendChild(this.shadow);\\r\\n    }\\r\\n    CollectionsView.prototype.createButtons = function (collectionMap) {\\r\\n        var _this = this;\\r\\n        this.buttonWrapper.innerHTML = ''; // clear\\r\\n        Object.keys(collectionMap).forEach(function (collectionName) {\\r\\n            var collection = collectionMap[collectionName];\\r\\n            var view = new SingleCollectionView_1.SingleCollectionView();\\r\\n            _this.viewMap[collectionName] = view;\\r\\n            view.update(collection);\\r\\n            view.onCollectionShow(function (collectionName) { return _this.onCollectionShow(collectionName); });\\r\\n            view.attach(_this.buttonWrapper);\\r\\n        });\\r\\n        this.isViewCreated = true;\\r\\n        document.body.appendChild(this.buttonWrapper);\\r\\n    };\\r\\n    CollectionsView.prototype.updateButtons = function (collectionMap) {\\r\\n        var _this = this;\\r\\n        Object.keys(collectionMap).forEach(function (collectionName) {\\r\\n            var collection = collectionMap[collectionName];\\r\\n            _this.updateButton(collection);\\r\\n        });\\r\\n    };\\r\\n    CollectionsView.prototype.updateButton = function (collection) {\\r\\n        if (!this.isViewCreated)\\r\\n            return;\\r\\n        var view = this.viewMap[collection.name];\\r\\n        if (view == null) {\\r\\n            console.warn('CollectionsView.updateButton: cannot find ', collection.name);\\r\\n            return;\\r\\n        }\\r\\n        view.update(collection);\\r\\n    };\\r\\n    /**\\r\\n     *  PRIVATE\\r\\n     */\\r\\n    CollectionsView.prototype.onCollectionShow = function (collectionName) {\\r\\n        var _this = this;\\r\\n        Object.keys(this.viewMap).forEach(function (nextCollectionName) {\\r\\n            if (collectionName != nextCollectionName) {\\r\\n                _this.viewMap[nextCollectionName].closeCollection();\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    CollectionsView.prototype.findButton = function (e) {\\r\\n        var _this = this;\\r\\n        var button = DomUtils_1.DomUtils.closest(e.target, \\\".\\\" + \\\"c-button\\\" /* button */);\\r\\n        if (button) {\\r\\n            var collectionName_1 = button.dataset.collection;\\r\\n            console.log('findButton ', collectionName_1);\\r\\n            Object.keys(this.viewMap).forEach(function (name) {\\r\\n                var view = _this.viewMap[name];\\r\\n                if (view == null) {\\r\\n                    console.warn('Collections.findButton - null view', collectionName_1);\\r\\n                    return;\\r\\n                }\\r\\n                if (name == collectionName_1) {\\r\\n                    _this.shadow.style.display = 'block';\\r\\n                    view.showCollection();\\r\\n                }\\r\\n                else\\r\\n                    view.closeCollection();\\r\\n            });\\r\\n        }\\r\\n    };\\r\\n    CollectionsView.prototype.closeAll = function () {\\r\\n        var _this = this;\\r\\n        Object.keys(this.viewMap).forEach(function (name) {\\r\\n            _this.viewMap[name].closeCollection();\\r\\n        });\\r\\n        this.shadow.style.display = 'none';\\r\\n    };\\r\\n    return CollectionsView;\\r\\n}());\\r\\nexports.CollectionsView = CollectionsView;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/collections/CollectionsView.ts?\")},\"./wonder-format/ts/twine-game/logic/collections/SingleCollectionView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar Stores_1 = __webpack_require__(/*! ../../Stores */ \"./wonder-format/ts/twine-game/Stores.ts\");\\r\\nvar FormatTwinePassageAsHTML_1 = __webpack_require__(/*! ../../../parser/FormatTwinePassageAsHTML */ \"./wonder-format/ts/parser/FormatTwinePassageAsHTML.ts\");\\r\\nvar Constants_1 = __webpack_require__(/*! ../../../Constants */ \"./wonder-format/ts/Constants.ts\");\\r\\nvar DomUtils_1 = __webpack_require__(/*! ../../../app-core/DomUtils */ \"./wonder-format/ts/app-core/DomUtils.ts\");\\r\\nvar SingleCollectionView = /** @class */ (function () {\\r\\n    function SingleCollectionView(buttonClass, listClass, pageClass) {\\r\\n        if (buttonClass === void 0) { buttonClass = \"c-button\" /* button */; }\\r\\n        if (listClass === void 0) { listClass = \"c-list\" /* list */; }\\r\\n        if (pageClass === void 0) { pageClass = \"c-page\" /* page */; }\\r\\n        this.buttonClass = buttonClass;\\r\\n        this.listClass = listClass;\\r\\n        this.pageClass = pageClass;\\r\\n        this.buttonEl = this.createButton(buttonClass);\\r\\n        this.listEl = this.createList(listClass);\\r\\n        this.pageEl = this.createPage(pageClass);\\r\\n    }\\r\\n    SingleCollectionView.prototype.attach = function (el) {\\r\\n        el = el || document.body;\\r\\n        document.body.appendChild(this.listEl);\\r\\n        document.body.appendChild(this.pageEl);\\r\\n        el.appendChild(this.buttonEl);\\r\\n    };\\r\\n    SingleCollectionView.prototype.update = function (collection) {\\r\\n        this.updateButton(collection);\\r\\n        this.updateListTitle(collection);\\r\\n        this.updateList(collection);\\r\\n    };\\r\\n    SingleCollectionView.prototype.onCollectionShow = function (callback) {\\r\\n        this.onButtonClickCallback = callback;\\r\\n    };\\r\\n    /********************\\r\\n     *  create elements\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.createButton = function (className) {\\r\\n        var bt = this.createDiv(className);\\r\\n        this.buttonTitleEl = this.createDiv(\"c-bt-title\" /* buttonTitle */);\\r\\n        this.buttonContentEl = this.createDiv(\"c-bt-content\" /* buttonContent */);\\r\\n        bt.appendChild(this.buttonTitleEl);\\r\\n        bt.appendChild(this.buttonContentEl);\\r\\n        return bt;\\r\\n    };\\r\\n    SingleCollectionView.prototype.createList = function (className) {\\r\\n        var _this = this;\\r\\n        var list = this.createDiv(className);\\r\\n        list.addEventListener(\\'click\\', function (e) { return _this.findItem(e); });\\r\\n        //list.addEventListener(\\'mouseup\\', () => this.closeCollection());\\r\\n        this.listTitleEl = this.createDiv(\"c-list-title\" /* listTitle */);\\r\\n        this.listContentEl = this.createDiv(\"c-list-content\" /* listContent */);\\r\\n        list.appendChild(this.listTitleEl);\\r\\n        list.appendChild(this.listContentEl);\\r\\n        return list;\\r\\n    };\\r\\n    SingleCollectionView.prototype.createPage = function (className) {\\r\\n        var _this = this;\\r\\n        var page = this.createDiv(className);\\r\\n        page.addEventListener(\\'mouseup\\', function () { return _this.closePage(); });\\r\\n        return page;\\r\\n    };\\r\\n    /********************\\r\\n     *  UPDATE COLLECTION\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.updateButton = function (collection) {\\r\\n        var BT = this.buttonEl;\\r\\n        var TITLE = this.buttonTitleEl;\\r\\n        var CONTENT = this.buttonContentEl;\\r\\n        this.collectionName = collection.name;\\r\\n        var collected = collection.collected.length;\\r\\n        var total = collection.maxAmount;\\r\\n        var title = collection.title;\\r\\n        BT.dataset.collection = this.collectionName;\\r\\n        // content\\r\\n        TITLE.innerHTML = \"\" + title;\\r\\n        CONTENT.innerHTML = collected + \"/\" + total;\\r\\n        // class\\r\\n        var isCompleted = collected == total;\\r\\n        var completedClass = isCompleted\\r\\n            ? \"c-button-completed\" /* buttonCompleted */\\r\\n            : \\'\\';\\r\\n        BT.className = \"c-button\" /* button */ +\\r\\n            \\' \\' + this.collectionName +\\r\\n            \\' \\' + completedClass;\\r\\n    };\\r\\n    SingleCollectionView.prototype.updateListTitle = function (collection) {\\r\\n        this.listTitleEl.innerHTML = collection.title;\\r\\n    };\\r\\n    SingleCollectionView.prototype.updateList = function (collection) {\\r\\n        var _this = this;\\r\\n        var LIST = this.listEl;\\r\\n        var LIST_CONTENT = this.listContentEl;\\r\\n        // clear list\\r\\n        LIST_CONTENT.innerHTML = \\'\\';\\r\\n        // create code\\r\\n        var passageMap = Stores_1.STORY_STORE.story.passageHash;\\r\\n        var newList = \\'\\';\\r\\n        collection.collected.forEach(function (name) {\\r\\n            var passage = passageMap[name];\\r\\n            var title = _this.getPageTitle(passage.content);\\r\\n            var itemTemplate = _this.getItemTemplate(title, name);\\r\\n            newList += itemTemplate;\\r\\n        });\\r\\n        // fill list\\r\\n        LIST_CONTENT.innerHTML = newList;\\r\\n        // list classes\\r\\n        LIST.className = \"c-list\" /* list */ + \\' \\' + this.collectionName;\\r\\n    };\\r\\n    SingleCollectionView.prototype.updatePage = function (passage) {\\r\\n        var PAGE = this.pageEl;\\r\\n        // clear\\r\\n        PAGE.innerHTML = \\'\\';\\r\\n        // parse content\\r\\n        // чистим контент от возможных скриптов\\r\\n        var cleanedContent = passage.content.replace(Constants_1.REGEXP.exeScript, \\'\\');\\r\\n        var PAGE_TEMPLATE = Constants_1.PASSAGE_TEMPLATE;\\r\\n        var html = FormatTwinePassageAsHTML_1.formatTwinePassageAsHTML(cleanedContent, PAGE_TEMPLATE);\\r\\n        console.log(\\'updatePage\\', html, passage);\\r\\n        // fill list\\r\\n        PAGE.innerHTML = html;\\r\\n    };\\r\\n    /********************\\r\\n     *  SHOW LIST\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.showCollection = function () {\\r\\n        this.listEl.classList.add(\"c-list-show\" /* listShow */);\\r\\n        if (this.onCollectionShow)\\r\\n            this.onButtonClickCallback(this.collectionName);\\r\\n    };\\r\\n    SingleCollectionView.prototype.closeCollection = function () {\\r\\n        this.listEl.classList.remove(\"c-list-show\" /* listShow */);\\r\\n        this.closePage(); // если была открыта страница - убираем и её\\r\\n    };\\r\\n    /********************\\r\\n     *  FIND PAGE\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.findItem = function (e) {\\r\\n        var item = DomUtils_1.DomUtils.closest(e.target, \".\" + \"c-item\" /* listItem */);\\r\\n        if (item)\\r\\n            this.onItemClick(item.dataset.name);\\r\\n    };\\r\\n    SingleCollectionView.prototype.onItemClick = function (name) {\\r\\n        var passage = Stores_1.STORY_STORE.story.passageHash[name];\\r\\n        if (passage == null) {\\r\\n            console.warn(\\'SingleCollectionView.onItemClick: cannot find\\' + name);\\r\\n            return;\\r\\n        }\\r\\n        this.updatePage(passage);\\r\\n        this.showPage();\\r\\n    };\\r\\n    /********************\\r\\n     *  PARSE PAGE\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.getPageTitle = function (passageContent) {\\r\\n        var title = innerText(passageContent, \\'<h1>\\', \\'</h1>\\');\\r\\n        if (title == null || title.length == 0) {\\r\\n            title = getFirstLine(passageContent);\\r\\n        }\\r\\n        return title;\\r\\n    };\\r\\n    /********************\\r\\n     *  SHOW PAGE\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.showPage = function () {\\r\\n        this.pageEl.classList.add(\"c-page-show\" /* pageShow */);\\r\\n    };\\r\\n    SingleCollectionView.prototype.closePage = function () {\\r\\n        this.pageEl.classList.remove(\"c-page-show\" /* pageShow */);\\r\\n    };\\r\\n    /********************\\r\\n     *  TEMPLATES\\r\\n     *******************/\\r\\n    SingleCollectionView.prototype.createDiv = function (className) {\\r\\n        var div = document.createElement(\\'div\\');\\r\\n        div.className = className;\\r\\n        return div;\\r\\n    };\\r\\n    SingleCollectionView.prototype.getItemTemplate = function (title, name) {\\r\\n        return \"<div class=\" + \"c-item\" /* listItem */ + \" data-name=\\\\\"\" + name + \"\\\\\">\" + title + \"</div>\";\\r\\n    };\\r\\n    return SingleCollectionView;\\r\\n}());\\r\\nexports.SingleCollectionView = SingleCollectionView;\\r\\n/**\\r\\n * Вернуть первую строку между двумя тегами/кусками текста\\r\\n * @method innerText\\r\\n * @param {string} str  исходная строка\\r\\n * @param {string} startTag\\r\\n * @param {string} endTag\\r\\n * @return {string}\\r\\n */\\r\\nfunction innerText(str, startTag, endTag, withTags) {\\r\\n    if (withTags === void 0) { withTags = false; }\\r\\n    var startIndex = str.indexOf(startTag);\\r\\n    if (startIndex < 0)\\r\\n        return \\'\\';\\r\\n    var endIndex = str.indexOf(endTag, startIndex);\\r\\n    var startOffset = withTags ? 0 : startTag.length;\\r\\n    var endOffset = withTags ? endTag.length : 0;\\r\\n    return str.substring(startIndex + startOffset, endIndex + endOffset);\\r\\n}\\r\\nfunction getFirstLine(str) {\\r\\n    var breakIndex = str.indexOf(\"\\\\n\");\\r\\n    // consider that there can be line without a break\\r\\n    if (breakIndex === -1) {\\r\\n        return str;\\r\\n    }\\r\\n    return str.substr(0, breakIndex);\\r\\n}\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/collections/SingleCollectionView.ts?')},\"./wonder-format/ts/twine-game/logic/collections/menu/GameMenu.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar ConstantsSvg_1 = __webpack_require__(/*! ../../../../ConstantsSvg */ \\\"./wonder-format/ts/ConstantsSvg.ts\\\");\\r\\nvar GameMenu = /** @class */ (function () {\\r\\n    function GameMenu() {\\r\\n        var _this = this;\\r\\n        console.log('GameMenu constructor....');\\r\\n        this.parent = document.body;\\r\\n        this.buttonEl = this.createButton(\\\"menu-main-button\\\" /* mainButtonClass */);\\r\\n        this.buttonEl.addEventListener('click', function (e) { return _this.onMainButtonClick(e); });\\r\\n        this.parent.appendChild(this.buttonEl);\\r\\n    }\\r\\n    GameMenu.prototype.setup = function (options) {\\r\\n        console.log('GameMenu setup....');\\r\\n        this.windowOptions = options.windowOptions;\\r\\n        this.showMainButton();\\r\\n    };\\r\\n    /********************\\r\\n     *  click\\r\\n     *******************/\\r\\n    GameMenu.prototype.onMainButtonClick = function (e) {\\r\\n        var Kvisaz = window['Kvisaz'];\\r\\n        Kvisaz.dialog(this.windowOptions);\\r\\n    };\\r\\n    /********************\\r\\n     *  create elements\\r\\n     *******************/\\r\\n    GameMenu.prototype.createDiv = function (className) {\\r\\n        var div = document.createElement('div');\\r\\n        div.className = className;\\r\\n        return div;\\r\\n    };\\r\\n    GameMenu.prototype.createButton = function (className) {\\r\\n        var el = this.createDiv(className);\\r\\n        el.innerHTML = ConstantsSvg_1.IcSvgSettings;\\r\\n        return el;\\r\\n    };\\r\\n    /********************\\r\\n     *  visibility\\r\\n     *******************/\\r\\n    GameMenu.prototype.showMainButton = function () {\\r\\n        this.buttonEl.classList.add(\\\"menu-main-button-visible\\\" /* mainButtonVisibleClass */);\\r\\n    };\\r\\n    return GameMenu;\\r\\n}());\\r\\nexports.GameMenu = GameMenu;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/collections/menu/GameMenu.ts?\")},\"./wonder-format/ts/twine-game/logic/collections/menu/GameMenuConstants.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\\r\\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\\r\\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\\r\\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\\r\\n            r[k] = a[j];\\r\\n    return r;\\r\\n};\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nexports.MenuGameButtonLabel = 'Настройки';\\r\\nexports.MenuGamTitleLabel = 'Настройки';\\r\\nexports.BrowserMenuButtons = [\\r\\n    {\\r\\n        command: \\\"restart\\\" /* restart */,\\r\\n        label: 'Новая игра',\\r\\n        hint: 'Начать с первой локации'\\r\\n    }\\r\\n];\\r\\nexports.DesktopMenuButtons = __spreadArrays([\\r\\n    {\\r\\n        command: \\\"close\\\" /* close */,\\r\\n        label: 'Закрыть игру',\\r\\n        hint: 'Alt + F4 : Выйти'\\r\\n    },\\r\\n    {\\r\\n        command: \\\"fullScreen\\\" /* fullScreen */,\\r\\n        label: 'Полный экран/окно',\\r\\n        hint: 'F11: Переключить'\\r\\n    }\\r\\n], exports.BrowserMenuButtons);\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/collections/menu/GameMenuConstants.ts?\")},\"./wonder-format/ts/twine-game/logic/preprocessor/Preprocessor.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar Preprocessor = /** @class */ (function () {\\r\\n    function Preprocessor() {\\r\\n    }\\r\\n    // начало истории - обнуляем скрипты\\r\\n    Preprocessor.prototype.beforeInitUserScript = function () {\\r\\n        this.rulesMap = {};\\r\\n    };\\r\\n    Preprocessor.prototype.addRule = function (rule) {\\r\\n        this.getRules(rule.tag).push(rule);\\r\\n    };\\r\\n    // контент модифицируется, поэтому обязательно брать копию\\r\\n    Preprocessor.prototype.exec = function (passageCopy) {\\r\\n        var _this = this;\\r\\n        console.log('preprocessing....');\\r\\n        var tags = this.getTags(passageCopy);\\r\\n        tags.forEach(function (tag) {\\r\\n            var rules = _this.getRules(tag);\\r\\n            rules.forEach(function (rule) { return _this.useRule(passageCopy, rule); });\\r\\n        });\\r\\n    };\\r\\n    Preprocessor.prototype.initTag = function (tag) {\\r\\n        if (this.rulesMap[tag] == null) {\\r\\n            this.rulesMap[tag] = [];\\r\\n        }\\r\\n    };\\r\\n    Preprocessor.prototype.getRules = function (tag) {\\r\\n        this.initTag(tag);\\r\\n        return this.rulesMap[tag];\\r\\n    };\\r\\n    Preprocessor.prototype.getTags = function (passage) {\\r\\n        return passage.tags.split(' ');\\r\\n    };\\r\\n    Preprocessor.prototype.useRule = function (passage, rule) {\\r\\n        var text2 = rule.text2 != null ? rule.text2 : '';\\r\\n        switch (rule.position) {\\r\\n            case \\\"start\\\" /* start */:\\r\\n                passage.content = rule.text + passage.content;\\r\\n                break;\\r\\n            case \\\"end\\\" /* end */:\\r\\n                passage.content = passage.content + rule.text;\\r\\n                break;\\r\\n            case \\\"around\\\" /* around */:\\r\\n                passage.content = rule.text + passage.content + text2;\\r\\n                break;\\r\\n            default:\\r\\n                console.warn('unknown PreprocessPosition - ' + rule.position);\\r\\n        }\\r\\n    };\\r\\n    return Preprocessor;\\r\\n}());\\r\\nexports.Preprocessor = Preprocessor;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/preprocessor/Preprocessor.ts?\")},\"./wonder-format/ts/twine-game/logic/repository/LocalRepository.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar LocalRepository = /** @class */ (function () {\\r\\n    function LocalRepository() {\\r\\n    }\\r\\n    LocalRepository.prototype.save = function (saveName, state, resolve, reject) {\\r\\n        console.log('local repo save....', saveName);\\r\\n        try {\\r\\n            var json = JSON.stringify(state);\\r\\n            localStorage.setItem(saveName, json);\\r\\n            resolve('success');\\r\\n        }\\r\\n        catch (e) {\\r\\n            reject(\\\"localRepository saveError for key [\\\" + saveName + \\\"] :: \\\" + e);\\r\\n        }\\r\\n    };\\r\\n    LocalRepository.prototype.load = function (saveName, resolve, reject) {\\r\\n        console.log('local repo load...', saveName);\\r\\n        try {\\r\\n            console.log('local try...');\\r\\n            var json = localStorage.getItem(saveName);\\r\\n            var state = JSON.parse(json);\\r\\n            resolve(state);\\r\\n        }\\r\\n        catch (e) {\\r\\n            console.log('local catch...');\\r\\n            reject(\\\"localRepository loadError for key [\\\" + saveName + \\\"] :: \\\" + e);\\r\\n        }\\r\\n    };\\r\\n    return LocalRepository;\\r\\n}());\\r\\nexports.LocalRepository = LocalRepository;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/repository/LocalRepository.ts?\")},\"./wonder-format/ts/twine-game/logic/repository/PostMessageRepository.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar PostMessageRepository = /** @class */ (function () {\\r\\n    function PostMessageRepository(postMessageApi) {\\r\\n        this.postMessageApi = postMessageApi;\\r\\n        this.callbacks = {};\\r\\n        this.setHandlers();\\r\\n    }\\r\\n    PostMessageRepository.prototype.save = function (saveName, data, resolve, reject) {\\r\\n        console.log(\\'postMessage repo save....\\', saveName, data);\\r\\n        try {\\r\\n            var json = JSON.stringify(data);\\r\\n            this.callbacks[\"save\" /* save */] = resolve;\\r\\n            this.callbacks[\"saveError\" /* saveError */] = reject;\\r\\n            this.postMessageApi.send(\"save\" /* save */, {\\r\\n                saveName: saveName,\\r\\n                data: json\\r\\n            });\\r\\n        }\\r\\n        catch (e) {\\r\\n            reject(\"postMessageRepository save Error for slotName [\" + saveName + \" :: \" + e);\\r\\n        }\\r\\n    };\\r\\n    PostMessageRepository.prototype.load = function (saveName, resolve, reject) {\\r\\n        console.log(\\'postMessage repo load....\\', saveName);\\r\\n        this.callbacks[\"load\" /* load */] = resolve;\\r\\n        this.callbacks[\"loadError\" /* loadError */] = reject;\\r\\n        console.log(\\'callbacks....\\', this.callbacks);\\r\\n        this.postMessageApi.send(\"load\" /* load */, {\\r\\n            saveName: saveName\\r\\n        });\\r\\n    };\\r\\n    PostMessageRepository.prototype.setHandlers = function () {\\r\\n        var _this = this;\\r\\n        this.setMessageHandler(\"save\" /* save */);\\r\\n        this.setMessageHandler(\"saveError\" /* saveError */);\\r\\n        this.setMessageHandler(\"loadError\" /* loadError */);\\r\\n        this.postMessageApi.on(\"load\" /* load */, function (loadMessage) { return _this.onLoad(loadMessage); });\\r\\n    };\\r\\n    PostMessageRepository.prototype.setMessageHandler = function (messageName) {\\r\\n        var _this = this;\\r\\n        this.postMessageApi.on(messageName, function (data) {\\r\\n            console.log(\\' this.postMessageApi.on \\', messageName, data);\\r\\n            var message = data.saveName + \\' \\' + data.data;\\r\\n            _this.callbacks[messageName](\"PostMessages.\" + messageName + \" :: \" + message);\\r\\n        });\\r\\n    };\\r\\n    PostMessageRepository.prototype.onLoad = function (loadMessage) {\\r\\n        var saveName = loadMessage.saveName;\\r\\n        var data = loadMessage.data;\\r\\n        console.log(\\'onPostMessageLoad....\\', this.callbacks);\\r\\n        console.log(\\' onPostMessageLoad \\', saveName, data);\\r\\n        try {\\r\\n            var resolve = this.callbacks[\"load\" /* load */];\\r\\n            var reject = this.callbacks[\"loadError\" /* loadError */];\\r\\n            if (data == null) {\\r\\n                reject(\"PostMessages.loadError :: null save for \" + saveName);\\r\\n            }\\r\\n            else {\\r\\n                var state = JSON.parse(data);\\r\\n                resolve(state);\\r\\n            }\\r\\n        }\\r\\n        catch (e) {\\r\\n            var messageName = \"loadError\" /* loadError */;\\r\\n            var reject = this.callbacks[messageName];\\r\\n            reject(\"PostMessages.\" + messageName + \" :: \" + e + \"  for \" + saveName);\\r\\n        }\\r\\n    };\\r\\n    return PostMessageRepository;\\r\\n}());\\r\\nexports.PostMessageRepository = PostMessageRepository;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/repository/PostMessageRepository.ts?')},\"./wonder-format/ts/twine-game/logic/repository/StateRepository.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar LocalRepository_1 = __webpack_require__(/*! ./LocalRepository */ \\\"./wonder-format/ts/twine-game/logic/repository/LocalRepository.ts\\\");\\r\\nvar PostMessageRepository_1 = __webpack_require__(/*! ./PostMessageRepository */ \\\"./wonder-format/ts/twine-game/logic/repository/PostMessageRepository.ts\\\");\\r\\nvar StateRepository = /** @class */ (function () {\\r\\n    function StateRepository(postMessageApi) {\\r\\n        // защита от циклических перезагрузок и перезаписей\\r\\n        this.loadTimes = {};\\r\\n        this.saveTimes = {};\\r\\n        this.operationDelta = 150;\\r\\n        this.localRepo = new LocalRepository_1.LocalRepository();\\r\\n        this.postMessageRepo = new PostMessageRepository_1.PostMessageRepository(postMessageApi);\\r\\n        this.repo = this.localRepo;\\r\\n    }\\r\\n    StateRepository.prototype.enableExternalApi = function (enable) {\\r\\n        console.log('enableExternalApi....', enable);\\r\\n        this.repo = enable ? this.postMessageRepo : this.localRepo;\\r\\n    };\\r\\n    StateRepository.prototype.load = function (saveName, resolve, reject) {\\r\\n        var now = Date.now();\\r\\n        var lastTime = this.loadTimes[saveName] || 0;\\r\\n        if (now - lastTime < this.operationDelta) {\\r\\n            console.warn('too much loading...');\\r\\n            return;\\r\\n        }\\r\\n        this.loadTimes[saveName] = now;\\r\\n        this.repo.load(saveName, resolve, reject);\\r\\n    };\\r\\n    StateRepository.prototype.save = function (saveName, data, resolve, reject) {\\r\\n        var now = Date.now();\\r\\n        var lastTime = this.saveTimes[saveName] || 0;\\r\\n        if (now - lastTime < this.operationDelta) {\\r\\n            console.warn('too much saving...');\\r\\n            return;\\r\\n        }\\r\\n        this.saveTimes[saveName] = now;\\r\\n        this.repo.save(saveName, data, resolve, reject);\\r\\n    };\\r\\n    return StateRepository;\\r\\n}());\\r\\nexports.StateRepository = StateRepository;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/repository/StateRepository.ts?\")},\"./wonder-format/ts/twine-game/logic/start/StartScreen.ts\":function(module,exports,__webpack_require__){\"use strict\";eval(\"\\r\\nvar __assign = (this && this.__assign) || function () {\\r\\n    __assign = Object.assign || function(t) {\\r\\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\\r\\n            s = arguments[i];\\r\\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\\r\\n                t[p] = s[p];\\r\\n        }\\r\\n        return t;\\r\\n    };\\r\\n    return __assign.apply(this, arguments);\\r\\n};\\r\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\r\\nvar Constants_1 = __webpack_require__(/*! ../../../Constants */ \\\"./wonder-format/ts/Constants.ts\\\");\\r\\nvar defaultStartScreenOptions = {\\r\\n    newGame: 'New Game',\\r\\n    continue: 'Continue',\\r\\n    continueOff: false,\\r\\n    title: 'Welcome to game',\\r\\n    text: 'Choice your destiny:'\\r\\n};\\r\\nvar StartScreen = /** @class */ (function () {\\r\\n    function StartScreen() {\\r\\n        this.passage = {\\r\\n            pid: Constants_1.WONDER.startScreenId,\\r\\n            position: '',\\r\\n            name: Constants_1.WONDER.startScreenId,\\r\\n            tags: Constants_1.WONDER.startScreenId,\\r\\n            size: '',\\r\\n            content: Constants_1.PRELOAD_PAGE_TEMPLATE\\r\\n        };\\r\\n        this.options = __assign({}, defaultStartScreenOptions);\\r\\n    }\\r\\n    StartScreen.prototype.userOptions = function (options) {\\r\\n        console.log('StartScreen userOptions....');\\r\\n        this.options = __assign(__assign({}, defaultStartScreenOptions), options);\\r\\n    };\\r\\n    StartScreen.prototype.onGameStateLoaded = function (hasPreviousSave) {\\r\\n        console.log('StartScreen onGameStateLoaded....');\\r\\n        var previousContinueOff = this.options.continueOff == true;\\r\\n        var continueOff = previousContinueOff || !hasPreviousSave;\\r\\n        this.options = __assign(__assign({}, this.options), { continueOff: continueOff });\\r\\n        this.setup(this.options);\\r\\n    };\\r\\n    StartScreen.prototype.setup = function (options) {\\r\\n        console.log('StartScreen setup....');\\r\\n        this.passage.content = this.createContent(options);\\r\\n    };\\r\\n    StartScreen.prototype.getPassage = function () {\\r\\n        return this.passage;\\r\\n    };\\r\\n    /****************\\r\\n     * PRIVATE\\r\\n     ***************/\\r\\n    StartScreen.prototype.createContent = function (options) {\\r\\n        var title = this.getTitleCode(options);\\r\\n        var text = this.getTextCode(options);\\r\\n        var buttonNewGame = this.getNewGameButtonCode(options);\\r\\n        var buttonContinue = options.continueOff == true ? '' : this.getContinueButtonCode(options);\\r\\n        return title + text + buttonContinue + buttonNewGame;\\r\\n    };\\r\\n    StartScreen.prototype.getString = function (str, def) {\\r\\n        return str == null ? def.trim() : str;\\r\\n    };\\r\\n    StartScreen.prototype.getButtonCode = function (title, id, command) {\\r\\n        return \\\"<div id=\\\\\\\"\\\" + id + \\\"\\\\\\\" class=\\\\\\\"\\\" + Constants_1.WONDER.buttonClass + \\\"\\\\\\\" data-command=\\\\\\\"\\\" + command + \\\"\\\\\\\">\\\" + title + \\\"</div>\\\";\\r\\n    };\\r\\n    StartScreen.prototype.getNewGameButtonCode = function (options) {\\r\\n        var text = this.getString(options.newGame, 'New Game');\\r\\n        return this.getButtonCode(text, Constants_1.WONDER.newGameBtId, \\\"newGame\\\" /* newGame */);\\r\\n    };\\r\\n    StartScreen.prototype.getContinueButtonCode = function (options) {\\r\\n        var text = this.getString(options.continue, 'Continue');\\r\\n        return this.getButtonCode(text, Constants_1.WONDER.continueBtId, \\\"continue\\\" /* continue */);\\r\\n    };\\r\\n    StartScreen.prototype.getTitleCode = function (options) {\\r\\n        var text = this.getString(options.title, '');\\r\\n        if (text.length == 0)\\r\\n            return '';\\r\\n        else\\r\\n            return \\\"<h1>\\\" + text + \\\"</h1>\\\";\\r\\n    };\\r\\n    StartScreen.prototype.getTextCode = function (options) {\\r\\n        var text = this.getString(options.text, '');\\r\\n        if (text.length == 0)\\r\\n            return '';\\r\\n        else\\r\\n            return \\\"<p>\\\" + text + \\\"</p>\\\";\\r\\n    };\\r\\n    return StartScreen;\\r\\n}());\\r\\nexports.StartScreen = StartScreen;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/start/StartScreen.ts?\")},\"./wonder-format/ts/twine-game/logic/userscript/UserScriptApi.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar Stores_1 = __webpack_require__(/*! ../../Stores */ \"./wonder-format/ts/twine-game/Stores.ts\");\\r\\nvar UserScriptApi = /** @class */ (function () {\\r\\n    function UserScriptApi(postMessageApi) {\\r\\n        this.autoload = this.autoLoad;\\r\\n        this.autosave = this.autoSave;\\r\\n        this.postMessageApi = postMessageApi;\\r\\n        this.includedScripts = {};\\r\\n        this.includedStyles = {};\\r\\n    }\\r\\n    /***********\\r\\n     *  Стили, дизайн\\r\\n     **********/\\r\\n    /************\\r\\n     *  Подключить стиль\\r\\n     ***********/\\r\\n    UserScriptApi.prototype.styleUrl = function (styleUrl) {\\r\\n        if (this.includedStyles[styleUrl])\\r\\n            return;\\r\\n        this.includedStyles[styleUrl] = true;\\r\\n        var styleEl = document.createElement(\\'link\\');\\r\\n        styleEl.setAttribute(\\'rel\\', \\'stylesheet\\');\\r\\n        styleEl.setAttribute(\\'href\\', styleUrl);\\r\\n        document.head.appendChild(styleEl);\\r\\n    };\\r\\n    /************\\r\\n     *  Подключить js\\r\\n     ***********/\\r\\n    UserScriptApi.prototype.jsUrl = function (jsUrl, callback) {\\r\\n        if (this.includedScripts[jsUrl])\\r\\n            return;\\r\\n        this.includedScripts[jsUrl] = true;\\r\\n        var script = document.createElement(\"script\");\\r\\n        script.type = \"text/javascript\";\\r\\n        if (callback) {\\r\\n            script.onload = function () {\\r\\n                callback();\\r\\n            };\\r\\n        }\\r\\n        script.src = jsUrl;\\r\\n        document.head.appendChild(script);\\r\\n    };\\r\\n    /********************\\r\\n     *  Collectibles\\r\\n     *******************/\\r\\n    UserScriptApi.prototype.collect = function (rule) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"collectionRule\" /* collectionRule */,\\r\\n            data: rule\\r\\n        });\\r\\n    };\\r\\n    /***********\\r\\n     *  Sounds\\r\\n     **********/\\r\\n    UserScriptApi.prototype.music = function (url, volume) {\\r\\n        if (volume === void 0) { volume = 1; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"music\" /* music */,\\r\\n            data: {\\r\\n                url: url,\\r\\n                volume: volume\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.musicFor = function (hashName, url, volume) {\\r\\n        if (volume === void 0) { volume = 1; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"musicFor\" /* musicFor */,\\r\\n            data: {\\r\\n                url: url,\\r\\n                volume: volume,\\r\\n                hashName: hashName\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.sound = function (url, volume) {\\r\\n        if (volume === void 0) { volume = 1; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"sound\" /* sound */,\\r\\n            data: {\\r\\n                url: url,\\r\\n                volume: volume,\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.musicStop = function () {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"musicStop\" /* musicStop */,\\r\\n            data: null\\r\\n        });\\r\\n    };\\r\\n    /********************\\r\\n     *  postMessageApi\\r\\n     *******************/\\r\\n    UserScriptApi.prototype.parentApi = function () {\\r\\n        return this.postMessageApi;\\r\\n    };\\r\\n    /********************\\r\\n     *  save/load\\r\\n     *******************/\\r\\n    // для отключения, если работаем с внешним API, к примеру\\r\\n    UserScriptApi.prototype.disableLocalSave = function (disable) {\\r\\n        if (disable === void 0) { disable = true; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"enableExternalApi\" /* enableExternalApi */,\\r\\n            data: !disable\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.enableExternalApi = function (enable) {\\r\\n        if (enable === void 0) { enable = true; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"enableExternalApi\" /* enableExternalApi */,\\r\\n            data: enable\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.hasSave = function () {\\r\\n        return Stores_1.RUNTIME_STORE.hasSave;\\r\\n    };\\r\\n    UserScriptApi.prototype.autoLoad = function (enabled) {\\r\\n        if (enabled === void 0) { enabled = true; }\\r\\n        // disabled\\r\\n    };\\r\\n    UserScriptApi.prototype.autoSave = function (enabled) {\\r\\n        if (enabled === void 0) { enabled = true; }\\r\\n        // disabled\\r\\n    };\\r\\n    UserScriptApi.prototype.saveSlot = function (saveName) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"saveSlot\" /* saveSlot */,\\r\\n            data: saveName\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.save = function (saveName) {\\r\\n        if (saveName != null)\\r\\n            this.saveSlot(saveName);\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"save\" /* save */,\\r\\n            data: saveName\\r\\n        });\\r\\n    };\\r\\n    UserScriptApi.prototype.load = function (saveName) {\\r\\n        if (saveName != null)\\r\\n            this.saveSlot(saveName);\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"load\" /* load */,\\r\\n            data: saveName\\r\\n        });\\r\\n    };\\r\\n    /****************\\r\\n     *  Настройка стартовой страницы\\r\\n     *********/\\r\\n    UserScriptApi.prototype.startPage = function (options) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"startPage\" /* startPage */,\\r\\n            data: options\\r\\n        });\\r\\n    };\\r\\n    /****************\\r\\n     *  restart и переходы\\r\\n     *********/\\r\\n    /**\\r\\n     * @param delay - задержка в ms\\r\\n     * @param name - с какого параграфа начать\\r\\n     */\\r\\n    UserScriptApi.prototype.start = function (delay, name) {\\r\\n        if (delay === void 0) { delay = 0; }\\r\\n        if (name === void 0) { name = null; }\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"start\" /* start */,\\r\\n            data: {\\r\\n                delay: delay,\\r\\n                name: name\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    /****************\\r\\n     *  show text в месте вызова\\r\\n     *********/\\r\\n    UserScriptApi.prototype.showText = function (text) {\\r\\n        // рантайм просто запихивает тексты в буффер\\r\\n        // оттуда их забирает логика\\r\\n        Stores_1.RUNTIME_STORE.textBuffer.push(text);\\r\\n    };\\r\\n    /********\\r\\n     *  добавить текст к странице\\r\\n     */\\r\\n    // добавить text/html в конец  всех страниц с тегом tag\\r\\n    UserScriptApi.prototype.pageAdd = function (tag, text) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"pageAdd\" /* pageAdd */,\\r\\n            data: {\\r\\n                tag: tag,\\r\\n                text: text\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    // добавить text/html в начало  всех страниц с тегом tag\\r\\n    UserScriptApi.prototype.pageBefore = function (tag, text) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"pageBefore\" /* pageBefore */,\\r\\n            data: {\\r\\n                tag: tag,\\r\\n                text: text\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    // добавить text/html вокруг  всех страниц с тегом tag\\r\\n    UserScriptApi.prototype.pageWrap = function (tag, text, text2) {\\r\\n        Stores_1.RUNTIME_STORE.commands.push({\\r\\n            name: \"pageWrap\" /* pageWrap */,\\r\\n            data: {\\r\\n                tag: tag,\\r\\n                text: text,\\r\\n                text2: text2\\r\\n            }\\r\\n        });\\r\\n    };\\r\\n    return UserScriptApi;\\r\\n}());\\r\\nexports.UserScriptApi = UserScriptApi;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/logic/userscript/UserScriptApi.ts?')},\"./wonder-format/ts/twine-game/view/PageAnimator.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar Constants_1 = __webpack_require__(/*! ../../Constants */ \"./wonder-format/ts/Constants.ts\");\\r\\nvar PageAnimator = /** @class */ (function () {\\r\\n    function PageAnimator() {\\r\\n    }\\r\\n    PageAnimator.prototype.show = function (el, duration) {\\r\\n        if (duration === void 0) { duration = 0; }\\r\\n        // console.log(`show el`, el);\\r\\n        el.classList.remove(Constants_1.COMMON_CSS.displayNone);\\r\\n    };\\r\\n    PageAnimator.prototype.hide = function (el, duration) {\\r\\n        if (duration === void 0) { duration = 0; }\\r\\n        //   console.log(`hide el`, el);\\r\\n        el.classList.add(Constants_1.COMMON_CSS.displayNone);\\r\\n    };\\r\\n    return PageAnimator;\\r\\n}());\\r\\nexports.PageAnimator = PageAnimator;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/view/PageAnimator.ts?')},\"./wonder-format/ts/twine-game/view/PagePairView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nvar __extends = (this && this.__extends) || (function () {\\r\\n    var extendStatics = function (d, b) {\\r\\n        extendStatics = Object.setPrototypeOf ||\\r\\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\\r\\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\\r\\n        return extendStatics(d, b);\\r\\n    };\\r\\n    return function (d, b) {\\r\\n        extendStatics(d, b);\\r\\n        function __() { this.constructor = d; }\\r\\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\\r\\n    };\\r\\n})();\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar PageView_1 = __webpack_require__(/*! ./PageView */ \"./wonder-format/ts/twine-game/view/PageView.ts\");\\r\\n/**\\r\\n *  Очередь страниц с ограниченной емкостью\\r\\n *  при добавлении страницы - первая выбрасывается\\r\\n */\\r\\nvar PagePairView = /** @class */ (function (_super) {\\r\\n    __extends(PagePairView, _super);\\r\\n    function PagePairView() {\\r\\n        var _this = _super !== null && _super.apply(this, arguments) || this;\\r\\n        _this.limit = 2;\\r\\n        return _this;\\r\\n    }\\r\\n    PagePairView.prototype.addPage = function (el) {\\r\\n        _super.prototype.addPage.call(this, el);\\r\\n        if (this.pages.length > this.limit) {\\r\\n            this.currentPage--; // так как массив сдвигается в начало\\r\\n            this.dropPage(0);\\r\\n        }\\r\\n    };\\r\\n    return PagePairView;\\r\\n}(PageView_1.PageView));\\r\\nexports.PagePairView = PagePairView;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/view/PagePairView.ts?')},\"./wonder-format/ts/twine-game/view/PageView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\n/**\\r\\n *  Содержит несколько страниц, может их менять\\r\\n */\\r\\nvar PageAnimator_1 = __webpack_require__(/*! ./PageAnimator */ \"./wonder-format/ts/twine-game/view/PageAnimator.ts\");\\r\\nvar ArrayUtils_1 = __webpack_require__(/*! ../../app-core/ArrayUtils */ \"./wonder-format/ts/app-core/ArrayUtils.ts\");\\r\\nvar DomUtils_1 = __webpack_require__(/*! ../../app-core/DomUtils */ \"./wonder-format/ts/app-core/DomUtils.ts\");\\r\\nvar PageView = /** @class */ (function () {\\r\\n    function PageView() {\\r\\n        this.pages = [];\\r\\n        this.currentPage = -1;\\r\\n        this.animator = new PageAnimator_1.PageAnimator();\\r\\n    }\\r\\n    PageView.prototype.setAnimator = function (animator) {\\r\\n        this.animator = animator;\\r\\n    };\\r\\n    PageView.prototype.addPage = function (el) {\\r\\n        this.pages.push(el);\\r\\n    };\\r\\n    /**\\r\\n     * Показать следующую страницу\\r\\n     */\\r\\n    PageView.prototype.next = function () {\\r\\n        var PREV = this.getCurrent();\\r\\n        this.currentPage++;\\r\\n        this.setCurrent(this.currentPage);\\r\\n        var NEXT = this.getCurrent();\\r\\n        this.switch(PREV, NEXT);\\r\\n    };\\r\\n    /**\\r\\n     *  Показать предыдущую страницы\\r\\n     */\\r\\n    PageView.prototype.previous = function () {\\r\\n        var PREV = this.getCurrent();\\r\\n        this.currentPage--;\\r\\n        this.setCurrent(this.currentPage);\\r\\n        var NEXT = this.getCurrent();\\r\\n        this.switch(PREV, NEXT);\\r\\n    };\\r\\n    /*********\\r\\n     *  PRIVATE\\r\\n     ********/\\r\\n    PageView.prototype.switch = function (from, to) {\\r\\n        if (from)\\r\\n            this.animator.hide(from);\\r\\n        this.animator.show(to);\\r\\n    };\\r\\n    PageView.prototype.getCurrent = function () {\\r\\n        return this.pages[this.currentPage];\\r\\n    };\\r\\n    /**\\r\\n     * Циклически идет по кругу,\\r\\n     * переключает на конец или начало, если выходит за рамки\\r\\n     * @param n\\r\\n     */\\r\\n    PageView.prototype.setCurrent = function (n) {\\r\\n        if (this.pages.length == 0) {\\r\\n            throw \"setCurrent error - void pages\";\\r\\n        }\\r\\n        var max = this.pages.length - 1;\\r\\n        if (n > max)\\r\\n            n = 0;\\r\\n        else if (n < 0)\\r\\n            n = max;\\r\\n        this.currentPage = n;\\r\\n    };\\r\\n    PageView.prototype.dropPage = function (index) {\\r\\n        var removed = ArrayUtils_1.ArrayUtils.remove(this.pages, index);\\r\\n        if (removed == null) {\\r\\n            console.warn(\"dropPage: try to remove undefined page\");\\r\\n            return;\\r\\n        }\\r\\n        DomUtils_1.DomUtils.remove(removed);\\r\\n    };\\r\\n    return PageView;\\r\\n}());\\r\\nexports.PageView = PageView;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/view/PageView.ts?')},\"./wonder-format/ts/twine-game/view/ViewBuilder.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar DomUtils_1 = __webpack_require__(/*! ../../app-core/DomUtils */ \"./wonder-format/ts/app-core/DomUtils.ts\");\\r\\n/**\\r\\n *  Универсальный форматтер\\r\\n *  - устанавливает выбранный шаблон\\r\\n */\\r\\nvar ViewBuilder = /** @class */ (function () {\\r\\n    function ViewBuilder(template) {\\r\\n        this.template = template;\\r\\n        this.contentFormatter = function (str, template) { return template; };\\r\\n    }\\r\\n    ViewBuilder.prototype.setTemplate = function (template) {\\r\\n        this.template = template;\\r\\n    };\\r\\n    ViewBuilder.prototype.setContentFormatter = function (formatter) {\\r\\n        this.contentFormatter = formatter;\\r\\n    };\\r\\n    ViewBuilder.prototype.build = function (content) {\\r\\n        if (content === void 0) { content = \"\"; }\\r\\n        var formatted = this.contentFormatter(content, this.template);\\r\\n        var pageEl = DomUtils_1.DomUtils.elementFromTemplate(formatted);\\r\\n        return pageEl;\\r\\n    };\\r\\n    return ViewBuilder;\\r\\n}());\\r\\nexports.ViewBuilder = ViewBuilder;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/view/ViewBuilder.ts?')},\"./wonder-format/ts/twine-game/view/WonderPageView.ts\":function(module,exports,__webpack_require__){\"use strict\";eval('\\r\\nObject.defineProperty(exports, \"__esModule\", { value: true });\\r\\nvar PagePairView_1 = __webpack_require__(/*! ./PagePairView */ \"./wonder-format/ts/twine-game/view/PagePairView.ts\");\\r\\nvar EventBus_1 = __webpack_require__(/*! ../../app-core/EventBus */ \"./wonder-format/ts/app-core/EventBus.ts\");\\r\\nvar ViewBuilder_1 = __webpack_require__(/*! ./ViewBuilder */ \"./wonder-format/ts/twine-game/view/ViewBuilder.ts\");\\r\\nvar Constants_1 = __webpack_require__(/*! ../../Constants */ \"./wonder-format/ts/Constants.ts\");\\r\\nvar FormatTwinePassageAsHTML_1 = __webpack_require__(/*! ../../parser/FormatTwinePassageAsHTML */ \"./wonder-format/ts/parser/FormatTwinePassageAsHTML.ts\");\\r\\nvar WonderPageView = /** @class */ (function () {\\r\\n    function WonderPageView(parent) {\\r\\n        var _this = this;\\r\\n        this.parent = parent;\\r\\n        this.pageView = new PagePairView_1.PagePairView();\\r\\n        this.pageBuilder = new ViewBuilder_1.ViewBuilder(Constants_1.PAGE_TEMPLATE);\\r\\n        this.contentBuilder = new ViewBuilder_1.ViewBuilder(Constants_1.PASSAGE_TEMPLATE);\\r\\n        this.contentBuilder.setContentFormatter(FormatTwinePassageAsHTML_1.formatTwinePassageAsHTML);\\r\\n        EventBus_1.EventBus.getInstance()\\r\\n            .sub(\"onPageFormatLoaded\" /* onPageFormatLoaded */, function (message, format) { return _this.pageBuilder.setTemplate(format); })\\r\\n            .sub(\"onPassageFormatLoaded\" /* onContentFormatLoaded */, function (message, format) { return _this.contentBuilder.setTemplate(format); });\\r\\n    }\\r\\n    WonderPageView.prototype.addNextPage = function (passage) {\\r\\n        var page = this.buildPageView(passage);\\r\\n        this.pageView.addPage(page);\\r\\n        return page;\\r\\n    };\\r\\n    WonderPageView.prototype.showNextPage = function () {\\r\\n        this.pageView.next();\\r\\n    };\\r\\n    /**********************\\r\\n     *   show page\\r\\n     *********************/\\r\\n    WonderPageView.prototype.buildPageView = function (passage) {\\r\\n        var SOURCE = passage.content;\\r\\n        var passageView = this.contentBuilder.build(SOURCE);\\r\\n        var pageView = this.pageBuilder.build();\\r\\n        pageView.classList.add(Constants_1.COMMON_CSS.displayNone);\\r\\n        pageView.appendChild(passageView);\\r\\n        this.parent.appendChild(pageView);\\r\\n        return pageView;\\r\\n    };\\r\\n    return WonderPageView;\\r\\n}());\\r\\nexports.WonderPageView = WonderPageView;\\r\\n\\n\\n//# sourceURL=webpack:///./wonder-format/ts/twine-game/view/WonderPageView.ts?')}});"+ '</script>' +
    '        </body>\n' +
    '    </html>';


window.storyFormat({
    name: 'twine-wonder',
    version: '0.6.22',
    author: 'Kvisaz [Sergey Tokarev]',
    description: 'Twine Wonder Format',
    proofing: false,
    url: 'https://github.com/Kvisaz/twine-wonder',
    image: 'icon.svg',
    source: SOURCE,
});
