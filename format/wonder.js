window.storyFormat({
    name: 'twine-wonder',
    version: '0.0.1',
    author: 'Kvisaz [Sergey Tokarev]',
    description: 'Twine Wonder Format',
    proofing: false,
    url: 'https://github.com',
    image: 'icon.svg',
    source: SOURCE,
});


var SOURCE = '<!DOCTYPE html>\n' +
    '    <html>\n' +
    '        <head>\n' +
    '            <meta name="viewport" content="width=device-width, initial-scale=1">\n' +
    '            <meta charset="utf-8">\n' +
    '            <title>{{STORY_NAME}}</title>\n' +
    '            <style></style>\n' +
    '        </head>\n' +
    '        <body>\n' +
    '            <tw-story tags></tw-story>\n' +
    '            {{STORY_DATA}}\n' +
    '            <script>' + "!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=7)}([function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.STORY_SELECTOR=\"tw-storydata\",t.PASSAGE_SELECTOR=\"tw-passagedata\",t.WONDER={contentId:\"wonder-content\",pageClass:\"page\",textClass:\"text\",choiceClass:\"choice\",linkClass:\"link\",linkInlineClass:\"inline\",noSelectClass:\"noselect\",selectClass:\"select\",template:{text:\"<text/>\",choices:\"<choices/>\",choiceStart:\"<choice>\",choiceEnd:\"</choice>\",choiceText:\"<choice-text/>\",choiceId:\"<choice-id/>\"},passages:{config:\"wonder.config\",pageFormat:\"wonder.format.page\",choiceFormat:\"wonder.format.choice\",textFormat:\"wonder.format.text\"},markLang:{varStart:\"var\",commandSplitter:\":\"},inlineStart:\"=\"},t.REGEXP={exeScript:new RegExp(\"<w>({{\\\\s\\\\S}}*?)</w>\",\"g\"),twineLink:new RegExp(\"\\\\[\\\\[(.*?)\\\\]\\\\]\",\"g\")},t.PAGE_TEMPLATE='<div class=\"'+t.WONDER.noSelectClass+\" \"+t.WONDER.pageClass+'\"></div>',t.LINK_TEMPLATE='<div class=\"'+t.WONDER.linkClass+'\" data-id=\"'+t.WONDER.template.choiceId+'\">'+t.WONDER.template.choiceText+\"</div>\",t.LINK_INLINE_TEMPLATE='<span class=\"'+t.WONDER.linkClass+\" \"+t.WONDER.linkInlineClass+'\" data-id=\"'+t.WONDER.template.choiceId+'\">'+t.WONDER.template.choiceText+\"</span>\",t.PASSAGE_TEMPLATE='<div>\\n<div class=\"params\" > \\n<div id=\"gold\"></div>\\n</div>\\n<div class=\"'+t.WONDER.selectClass+\" \"+t.WONDER.textClass+'\"><text/></div>\\n</div>',t.DEFAULT_STYLE='\\n\\n    .noselect {\\n    -webkit-touch-callout: none; /* iOS Safari */\\n        -webkit-user-select: none; /* Safari */\\n        -khtml-user-select: none; /* Konqueror HTML */\\n        -moz-user-select: none; /* Old versions of Firefox */\\n            -ms-user-select: none; /* Internet Explorer/Edge */\\n                user-select: none; /* Non-prefixed version, currently\\n                                  supported by Chrome, Opera and Firefox */\\n    }\\n    \\n    .select {\\n        -webkit-touch-callout: default; /* iOS Safari */\\n        -webkit-user-select: text; /* Safari */\\n        -khtml-user-select: text; /* Konqueror HTML */\\n        -moz-user-select: text; /* Old versions of Firefox */\\n            -ms-user-select: text; /* Internet Explorer/Edge */\\n                user-select: text; /* Non-prefixed version, currently\\n                                  supported by Chrome, Opera and Firefox */\\n    }\\n    \\n    ul, li {\\n        margin: 0;\\n        padding: 0;\\n        list-style: none;\\n    }\\n    \\n    body {\\n        margin: 0;\\n        padding: 0;\\n        background: #ceceb7;\\n        font-family: \"Verdana\", \"Roboto\", \"Open Sans\", sans-serif;\\n    }\\n    \\n    .'+t.WONDER.pageClass+\" {\\n          width: 800px;\\n          margin: 15px auto;\\n          padding: 12px;  \\n          background: beige;\\n          border-radius: 8px;\\n        }\\n        \\n        \\n    .\"+t.WONDER.textClass+\" {\\n        margin-bottom: 24px;\\n        margin-top: 48px;\\n        font-size: 18px;\\n        line-height: 1.2em;\\n    }\\n    \\n    .\"+t.WONDER.linkClass+\"{\\n        cursor: pointer;\\n        margin: 16px 0;\\n        text-decoration: underline;\\n    }\\n        \\n    .\"+t.WONDER.linkClass+\":hover{\\n        color: #313298;\\n    }\\n\"},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(10),o=n(4),i=function(){function e(){this.listeners={}}return e.prototype.getListeners=function(e){return this.listeners[e]},e.prototype.initListeners=function(e){return this.listeners[e]=[],this.listeners[e]},e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.addListener=function(t,n){(e.getInstance().getListeners(t)||e.getInstance().initListeners(t)).push(n)},e.prototype.sub=function(e,t){return(this.getListeners(e)||this.initListeners(e)).push(t),this},e.prototype.unsub=function(e,t){var n=this.getListeners(e);if(null!=n)return o.ArrayUtils.removeChild(n,t),this},e.emit=function(t,n){var o=e.getInstance().getListeners(t);o&&o.forEach((function(e){r.Task.order((function(){e(t,n)}))}))},e}();t.EventBus=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),function(e){e.onStoryLoaded=\"onStoryLoaded\",e.onPageFormatLoaded=\"onPageFormatLoaded\",e.onContentFormatLoaded=\"onPassageFormatLoaded\",e.onCssLoaded=\"onCssLoaded\",e.preparePassage=\"preparePassage\",e.onPassagePrepared=\"onPassagePrepared\",e.showPassage=\"showPassage\",e.onLinkClick=\"onLinkClick\"}(t.GameEvents||(t.GameEvents={}));var r=function(e,t,n){this.passage=e,this.state=t,this.config=n};t.PageViewData=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(){function e(){}return e.elementFromTemplate=function(e){var t=document.createElement(\"div\");return t.innerHTML=e,t.firstChild},e.addChildBefore=function(e,t,n){var r,o=!0,i=e.children;if(null!=n&&0!=n.length){for(var a=0;a<i.length;a++)if((r=i[a]).id==n)return e.insertBefore(t,r),void(o=!1);o&&e.appendChild(t)}else e.appendChild(t)},e.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},e.addChildIfNot=function(e,t){t.parentNode!=e&&e.appendChild(t)},e.bringToTop=function(e){e.parentNode&&e.parentNode.appendChild(e)},e.matches=function(e,t){return o.call(e,t)},e.copyToClipboard=function(e){var t=document.createElement(\"textarea\");t.value=e,document.body.appendChild(t),t.select(),document.execCommand(\"copy\"),document.body.removeChild(t)},e.getBlobURL=function(e,t){var n=new Blob([e],{type:t});return URL.createObjectURL(n)},e.getHtmlBlobUrl=function(t){return e.getBlobURL(t,\"text/html\")},e.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.getTextMetrics=function(t,n){null==e.canvas&&(e.canvas=document.createElement(\"canvas\"));var r=e.canvas.getContext(\"2d\");return r.font=n,r.measureText(t)},e.getTextWidth=function(t,n){return e.getTextMetrics(t,n).width},e.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},e.closest=function(t,n){var r=t,o=0;do{if(null==r)return null;if(e.matches(r,n))return r;r=r.parentElement}while(o++<1e4);console.warn(\" \"+o+\" loops - check code for errors!\")},e.prepend=function(e,t){e.insertBefore(t,e.firstChild)},e}();t.DomUtils=r;var o=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r,o=function(){function e(){}return e.getRandom=function(e,t){void 0===t&&(t=1);var n=new Array(t),r=e.length,o=new Array(r);if(t>r)throw new RangeError(\"getRandom: more elements taken than available\");for(;t--;){var i=Math.floor(Math.random()*r);n[t]=e[i in o?o[i]:i],o[i]=--r in o?o[r]:r}return n},e.pushUnique=function(e,t){return e.indexOf(t)<0&&e.push(t),e},e.removeChild=function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},e.remove=function(e,t){return t>-1?e.splice(t,1)[0]:null},e.removeLast=function(e,t){for(;t-- >0;)e.pop()},e.shuffleWithSeed=function(e,t){var n,r;void 0===t&&(t=17);var o,i=e.length;for(n=0;n<i;n++)r=e[o=(t*n+31)%i],e[o]=e[n],e[n]=r;return e},e.shuffle=function(t,n){switch(void 0===n&&(n=r.random),n){case r.same:return t;case r.chaos:return t.sort((function(e,t){return Math.random()-.5}));case r.random:return e.shuffleWithSeed(t,13)}},e.updateArray=function(e,t,n,r){var o,i;(void 0===r&&(r=!0),null!=e&&null!=t&&0!=t.length)&&e.forEach((function(e,r){o=r<t.length?t[r]:i,n(e,o),i=o}))},e}();t.ArrayUtils=o,function(e){e.random=\"random\",e.same=\"same\",e.chaos=\"chaos\"}(r=t.ArrayShuffleOrder||(t.ArrayShuffleOrder={}))},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(){};t.GameState=r;var o=function(){this.uiParams=[]};t.GameConfig=o;var i=function(e,t){this.name=e,this.selector=t};t.VisibleParameter=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(17);t.COMMON_CSS={displayNone:\"displayNone\",pointerOver:\"pointerOver\"};var o=[\".\"+t.COMMON_CSS.displayNone+\" {display: none}\",\".\"+t.COMMON_CSS.pointerOver+\" {cursor: pointer}\"];r.StyleInjector.bindStyles(o)},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(8),o=n(9),i=n(12),a=n(0);console.log(\"..............................\"),console.log(\"Twine Wonder parser game version 0.0.1\"),console.log(\"..............................\");var s=r.parseTwineData();console.log(\"story parsed = \",s);var c=new o.GameLogic,u=new i.GameView;u.injectStyle(a.DEFAULT_STYLE),u.injectStyle(s.style),c.exeScript(s.script),c.loadStory(s)},function(e,t,n){\"use strict\";function r(e){for(var t,n,r,o,i={},a=0,s=e.attributes,c=s.length;a<c;a++)i[(t=s[a].name,n=void 0,r=void 0,o=void 0,n=t.split(\"-\"),r=n.map((function(e,t){return t?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e})),o=r.join(\"\"),o)]=s[a].value;return i}Object.defineProperty(t,\"__esModule\",{value:!0}),t.parseTwineData=function(){var e=document.body.querySelector(\"tw-storydata\"),t=r(e);t.style=document.querySelector(\"#twine-user-stylesheet\").innerHTML.trim(),t.script=document.querySelector(\"#twine-user-script\").innerHTML.trim();var n=Array.prototype.slice.call(e.querySelectorAll(\"tw-passagedata\"));return t.passageHash={},t.passages=n.map((function(e){var n,o,i=r(e);return t.passageHash[i.pid]&&console.warn(\"duplicate passage id \"+i.pid),t.passageHash[i.name]=i,t.startnode==i.pid&&(t.startPassageName=i.name),i.content=(n=e.innerHTML.trim(),(o=document.createElement(\"textarea\")).innerHTML=n,0===o.childNodes.length?\"\":o.childNodes[0].nodeValue),i})),t}},function(e,t,n){\"use strict\";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0});var o=n(1),i=n(2),a=n(0),s=n(5),c=n(11),u=function(){function e(){var e=this;this.gameConfig=new s.GameConfig,this.gameState={},o.EventBus.getInstance().sub(i.GameEvents.onPassagePrepared,(function(t,n){return e.onPassagePrepared(n)})).sub(i.GameEvents.onLinkClick,(function(t,n){return e.onLinkClick(n)}))}return e.prototype.loadStory=function(e){this.story=e,c.WonderStoryParser.parse(e,this.gameState,this.gameConfig),console.log(\" loadStory \",this.gameState,this.gameConfig),o.EventBus.emit(i.GameEvents.onStoryLoaded,e),o.EventBus.emit(i.GameEvents.preparePassage,this.getViewPassage(this.story.startPassageName))},e.prototype.exeScript=function(e){return new Function(e).bind(this.gameState)()},e.prototype.onPassagePrepared=function(e){console.log(\"onPassagePrepared\",e),this.showPassage(e)},e.prototype.showPassage=function(e){console.log(\"showPassage\",e),o.EventBus.emit(i.GameEvents.showPassage,e)},e.prototype.onLinkClick=function(e){console.log(\"onLinkClick \"+e),o.EventBus.emit(i.GameEvents.preparePassage,this.getViewPassage(e))},e.prototype.getViewPassage=function(e){var t=r({},this.story.passageHash[e]);return this.execScripts(t),new i.PageViewData(t,this.gameState,this.gameConfig)},e.prototype.execScripts=function(e){var t=this;console.log(\"execScripts........\"),console.log(\"viewPassage.content\",e.content),e.content=e.content.replace(a.REGEXP.exeScript,(function(e,n){var r=n.trim(),o=r[0]==a.WONDER.inlineStart;o&&(r=\"return \"+r.substring(1));var i=t.exeScript(r);return o?i:\"\"})),console.log(\"....... /execScripts\")},e}();t.GameLogic=u},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,0)};t.Task={order:r}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(5),o=n(0),i=function(){function e(){}return e.parse=function(e,t,n){!function(e,t,n){if(null==e)return;(i=e.content,i.split(\"\\n\")).forEach((function(e){0!=(e=e.trim()).length&&function(e,t,n){if(0==function(e,t){return 0==e.indexOf(t)}(e,o.WONDER.markLang.varStart))return;console.log(\"has var\",e);var i=e.split(o.WONDER.markLang.commandSplitter),a=i[1].trim(),s=i[2]||\"0\",c=i[3];t[a]=parseFloat(s),c&&n.uiParams.push(new r.VisibleParameter(a,c))}(e,t,n)}));var i}(e.passageHash[o.WONDER.passages.config],t,n)},e}();t.WonderStoryParser=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(1),o=n(2),i=n(0),a=n(13),s=n(3),c=function(){function e(){var e=this;this.el=document.createElement(\"div\"),this.el.id=i.WONDER.contentId,document.body.appendChild(this.el),this.el.addEventListener(\"click\",this),this.pageView=new a.WonderPageView(this.el),r.EventBus.getInstance().sub(o.GameEvents.onStoryLoaded,(function(t,n){return e.onStoryLoaded(n)})).sub(o.GameEvents.preparePassage,(function(t,n){return e.preparePassage(n)})).sub(o.GameEvents.showPassage,(function(t,n){return e.showPassage(n)}))}return e.prototype.handleEvent=function(e){var t=s.DomUtils.closest(e.target,\".\"+i.WONDER.linkClass);if(t){var n=t.dataset.id;r.EventBus.emit(o.GameEvents.onLinkClick,n)}},e.prototype.injectStyle=function(e){if(0!=e.length){var t=document.createElement(\"style\");t.innerHTML=e,document.getElementsByTagName(\"head\")[0].appendChild(t)}},e.prototype.onStoryLoaded=function(e){console.log(\"onStoryLoaded\",e)},e.prototype.preparePassage=function(e){var t=e.passage;console.log(\"preparePassage\",t);var n=this.pageView.addNextPage(t);this.injectParams(n,e.config.uiParams,e.state),r.EventBus.emit(o.GameEvents.onPassagePrepared,t)},e.prototype.showPassage=function(e){console.log(\"showPassage\",e),this.pageView.showNextPage()},e.prototype.injectParams=function(e,t,n){t.forEach((function(t){var r=n[t.name],o=e.querySelector(t.selector);o&&(o.innerHTML=r)}))},e}();t.GameView=c},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(14),o=n(1),i=n(2),a=n(6),s=n(18),c=n(0),u=n(19),l=function(){function e(e){var t=this;this.parent=e,this.pageView=new r.PagePairView,this.pageBuilder=new s.ViewBuilder(c.PAGE_TEMPLATE),this.contentBuilder=new s.ViewBuilder(c.PASSAGE_TEMPLATE),this.contentBuilder.setContentFormatter(u.twinePassageFormatter),o.EventBus.getInstance().sub(i.GameEvents.onPageFormatLoaded,(function(e,n){return t.pageBuilder.setTemplate(n)})).sub(i.GameEvents.onContentFormatLoaded,(function(e,n){return t.contentBuilder.setTemplate(n)}))}return e.prototype.addNextPage=function(e){var t=this.buildPageView(e);return this.pageView.addPage(t),t},e.prototype.showNextPage=function(){this.pageView.next()},e.prototype.buildPageView=function(e){var t=e.content,n=this.contentBuilder.build(t),r=this.pageBuilder.build();return r.classList.add(a.COMMON_CSS.displayNone),r.appendChild(n),this.parent.appendChild(r),r},e}();t.WonderPageView=l},function(e,t,n){\"use strict\";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.limit=2,t}return o(t,e),t.prototype.addPage=function(t){e.prototype.addPage.call(this,t),this.pages.length>this.limit&&(this.currentPage--,this.dropPage(0))},t}(n(15).PageView);t.PagePairView=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(16),o=n(4),i=n(3),a=function(){function e(){this.pages=[],this.currentPage=-1,this.animator=new r.PageAnimator}return e.prototype.setAnimator=function(e){this.animator=e},e.prototype.addPage=function(e){this.pages.push(e)},e.prototype.next=function(){var e=this.getCurrent();this.currentPage++,this.setCurrent(this.currentPage);var t=this.getCurrent();this.switch(e,t)},e.prototype.previous=function(){var e=this.getCurrent();this.currentPage--,this.setCurrent(this.currentPage);var t=this.getCurrent();this.switch(e,t)},e.prototype.switch=function(e,t){e&&this.animator.hide(e),this.animator.show(t)},e.prototype.getCurrent=function(){return this.pages[this.currentPage]},e.prototype.setCurrent=function(e){if(0==this.pages.length)throw\"setCurrent error - void pages\";var t=this.pages.length-1;e>t?e=0:e<0&&(e=t),this.currentPage=e},e.prototype.dropPage=function(e){var t=o.ArrayUtils.remove(this.pages,e);null!=t?i.DomUtils.remove(t):console.warn(\"dropPage: try to remove undefined page\")},e}();t.PageView=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(6),o=function(){function e(){}return e.prototype.show=function(e,t){void 0===t&&(t=0),console.log(\"show el\",e),e.classList.remove(r.COMMON_CSS.displayNone)},e.prototype.hide=function(e,t){void 0===t&&(t=0),console.log(\"hide el\",e),e.classList.add(r.COMMON_CSS.displayNone)},e}();t.PageAnimator=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(){function e(){}return e.bindStyles=function(t){null!=t&&0!=t.length&&(e.checkStyleSheet(),t.forEach(e.addStyleRule))},e.addFontFace=function(t,n,r){void 0===r&&(r=\"ttf\");var o=('\\n        @font-face {\\n            font-family: \"'+t+'\";\\n            src: url(\"'+n+'\") format(\"'+r+'\");\\n        }').trim();null==e.fontFaces[t]?(e.addRule(o),e.fontFaces[t]=o):console.warn(\"try to duplicate font-face: \",t)},e.addStyleRule=function(t){0!=(t=t.trim()).length?e.isUniqueStyleRule(t)?e.addRule(t):console.warn(\"try to duplicate rule: \",t):console.warn(\"addUniqueRule get void rule\")},e.checkStyleSheet=function(){if(!e.styleNode){e.styleNode=document.createElement(\"style\"),document.head.appendChild(e.styleNode);var t=document.createComment(\"app StyleInjector\");e.styleNode.appendChild(t)}},e.addRule=function(t){e.styleNode.appendChild(document.createTextNode(t))},e.isUniqueStyleRule=function(t,n){void 0===n&&(n=e.styleRules);var r=t.split(\"{\").map((function(e){return(e=e.replace(\"}\",\"\")).trim()})),o=r[0],i=r[1],a=null==n[o];return a&&(n[o]=i.replace(\"}\",\"\")),a},e.styleRules={},e.fontFaces={},e}();t.StyleInjector=r},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(3),o=function(){function e(e){this.template=e,this.contentFormatter=function(e,t){return t}}return e.prototype.setTemplate=function(e){this.template=e},e.prototype.setContentFormatter=function(e){this.contentFormatter=e},e.prototype.build=function(e){void 0===e&&(e=\"\");var t=this.contentFormatter(e,this.template);return r.DomUtils.elementFromTemplate(t)},e}();t.ViewBuilder=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=n(0);t.twinePassageFormatter=function(e,t){console.log(\"twinePassageFormatter....\");var n=r.WONDER.template,i=function(e,t,n){var r,o,i=[],a=0;for(;a<e.length;){if(-1===(r=e.indexOf(t,a)))return i;-1===(o=e.indexOf(n,r))&&(o=void 0),i.push(e.substring(r+t.length,o)),a=o+n.length}return i}(t,n.choiceStart,n.choiceEnd)[0];t=t.replace(i,n.choiceText).replace(n.choiceStart,\"\").replace(n.choiceEnd,\"\"),e=e.replace(r.REGEXP.twineLink,(function(e,t){var n=(t=t.trim())[0]==r.WONDER.inlineStart,i=n?r.LINK_INLINE_TEMPLATE:r.LINK_TEMPLATE;return n&&(t=t.substring(1)),function(e,t){return t.replace(r.WONDER.template.choiceId,e.id).replace(r.WONDER.template.choiceText,e.text)}(function(e){var t=e.split(\"|\");t[0]=t[0].trim(),null==t[1]&&(t[1]=t[0]);return new o(t[0],t[1])}(t),i)})).trim();var a=t;return a=a.replace(n.text,e.trim())};var o=function(e,t){this.text=e,this.id=t}}]);"+ '</script>' +
    '        </body>\n' +
    '    </html>';